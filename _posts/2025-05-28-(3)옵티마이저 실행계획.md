---
title: "[27ì¼ì°¨] ì˜µí‹°ë§ˆì´ì € ì‹¤í–‰ ê³„íš"
excerpt: "ì•„ì´í‹°ìœŒ 0528_(3) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-05-28T21:21
---

# OPTIMIZER ì‹¤í–‰ ê³„íš(ë¬¸ì¥ íŠœë‹)

â–¶ï¸ **OPTIMIZER** 

SQLë¬¸ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì‹¤í–‰ ê³„íšì„ ë§Œë“ ë‹¤.

â–¶ï¸ ROWID : ê°€ìƒ ì»¬ëŸ¼, í–‰ì˜ ë¬¼ë¦¬ì  ì£¼ì†Œ

â–¶ï¸ INDEX 

- by index rowid scan ë°©ì‹ì„ ì‚¬ìš©í•´ì„œ ê²€ìƒ‰ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ì„œ ì‚¬ìš©ë˜ëŠ” ê°ì²´
- ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•´ì„œ í–‰ì„ ê²€ìƒ‰í•˜ë©´ I/O(ì…ë ¥/ì¶œë ¥)ì„ ê°œì„ í•  ìˆ˜ ìˆë‹¤.
- ì¸ë±ìŠ¤ëŠ” ì˜¤ë¼í´ì´ ìë™ìœ¼ë¡œ ìœ ì§€ ê´€ë¦¬í•œë‹¤.
- PRIMARY KEY , UNIQUE ì œì•½ì¡°ê±´ì„ ìƒì„±í•˜ë©´ UNIQUE INDEXê°€ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.
- ê·¸ ì™¸ëŠ” ìˆ˜ë™ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.

---

ex) ì±… = í…Œì´ë¸”

       page = block(2k, 4k, 8k, 16k, 32k)

       ë¬¸ì¥ = í–‰(row)

---

**optimizerì˜ ì‹¤í–‰ ê³„íš**

1ï¸âƒ£ ë°ì´í„° ì²˜ë¦¬ ë°©ë²• ê²°ì •

2ï¸âƒ£ ì¡°ì¸ ë°©ë²• ê²°ì •

3ï¸âƒ£ ì¡°ì¸ ìˆœì„œ ê²°ì •

# ë°ì´í„° ì²˜ë¦¬ ë°©ë²• ê²°ì • (data access method)

â–¶ï¸ **by full scan (full table scan)**

![image.png](/assets/20250528/2.png)

- ì²«ë²ˆì§¸ page(block)ì— ìˆëŠ” ë¬¸ì¥(í–‰)ë¶€í„° ë§ˆì§€ë§‰ page(block)ì— ìˆëŠ” ë¬¸ì¥(í–‰)ê¹Œì§€ accessí•˜ëŠ” ë°©ì‹
- í•„í„° ìˆ ì–´ (Filter Predicates) : block ì²˜ìŒë¶€í„° ëê¹Œì§€ í’€ ìŠ¤ìº” (ë°ì´í„° ì–´ë”” ìˆëŠ”ì§€ ëª¨ë¥¼ë•Œ)

â–¶ï¸ by rowid scan  

- by user rowid scan (io : ìµœì†Œ 1ë²ˆ)
    - í–‰ì˜ ë¬¼ë¦¬ì  ì£¼ì†Œë¥¼ ê°€ì§€ê³  ì°¾ëŠ” ë°©ì‹
    - ë°ì´í„° accessë°©ë²• ì¤‘ì— ê°€ì¥ ë¹ ë¥´ë‹¤.

```sql
-- ë°ì´í„° access ì¤‘ ê°€ì¥ ë¹ ë¥¸ ë°©ë²•
-- by user rowid :  AAAE+bAAEAAAAHzAAA -> ì§‘ì£¼ì†Œ ì°¾ì•„ê°„ë‹¤.

SELECT rowid, employee_id FROM hr.emp;
SELECT * FROM hr.emp WHERE rowid = 'AAAE+bAAEAAAAHzAAA';
```

![image.png](/assets/20250528/3.png)

ğŸˆ 'AAAE+bAAEAAAAHzAAA' 

- AAAE+b(6ìë¦¬) : data object id

```sql
SELECT * FROM user_objects WHERE object_name = 'EMP';
```

- AAE(3ìë¦¬) : file id

```sql
SELECT * FROM user_tables WHERE table_name = 'EMP';
SELECT* FROM dba_data_files;
```

- AAAAHz(6ìë¦¬) : block id

```sql
SELECT* FROM user_segments WHERE segment_name = 'EMP';
SELECT * FROM user_extents WHERE segment_name = 'EMP';
```

- AAA(3ìë¦¬) : row slot id. block ì•ˆì— ìˆëŠ” row ìœ„ì¹˜

```sql
-- index : rowid ëŒ€ì‹  ê¸°ì–µí•˜ëŠ” ì—­í• 
SELECT rowid,
    dbms_rowid.rowid_object(rowid) data_object_id,
    dbms_rowid.rowid_relative_fno(rowid) file_id,
    dbms_rowid.rowid_block_number(rowid) block_id,
    dbms_rowid.rowid_block_number(rowid) row_slot,
    employee_id
FROM hr.emp;
```

- by index rowid scan (io: ìµœì†Œ 4ë²ˆ ê±°ì³ì„œ)

ğŸˆ íŠ¸ë¦¬ êµ¬ì¡° 

ROOT - BRANCH - LEAF(id, rowid)  

```sql
-- access ìˆ ì–´ : ë°ì´í„° ì–´ë””ì— ì¡´ì¬í•˜ëŠ”ì§€ ì•ˆë‹¤.
-- primary key(employee_id) ì§€ì •ë˜ì—ˆì„ë•Œ.
SELECT * FROM hr.emp WHERE employee_id = 100;
```

![image.png](/assets/20250528/4.png)

```sql
-- primary key í•´ì œ 
-- ë‹¤ì‹œ filter 
SELECT * FROM hr.emp WHERE employee_id = 100;
```

![image.png](/assets/20250528/5.png)

â–¶ï¸ ìˆ˜ë™ìœ¼ë¡œ unique index ìƒì„±

```sql
-- ìˆ˜ë™ìœ¼ë¡œ UNIQUE INDEX ìƒì„±
CREATE UNIQUE INDEX emp_idx
ON hr.emp(employee_id)
TABLESPACE users;

/*
ì¸ë±ìŠ¤ ìƒì„±ì‹œì— ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ìˆ˜í–‰ëœë‹¤.
SELECT employee_id, rowid
FROM hr.emp
ORDER BY 1;
*/

-- ì¸ë±ìŠ¤ í™•ì¸
SELECT * FROM user_indexes WHERE  table_name = 'EMP';
SELECT * FROM user_ind_columns WHERE table_name = 'EMP';

/*
1.emp_idx ì¸ë±ìŠ¤ì—ì„œ 100ë²ˆ í•´ë‹¹í•˜ëŠ” rowid ì°¾ëŠ”ë‹¤.
	1-1.emp_idx ì¸ë±ìŠ¤ì— root block -> branch block -> leaf block scan í•œë‹¤.
  1-2.leaf blockì•ˆì— 100ë²ˆ rowid ì°¾ëŠ”ë‹¤.
2. 1ì—ì„œ ì°¾ì€ rowidê°€ì§€ê³  emp tableì˜ ì‹¤ì œ blockìœ¼ë¡œ ì°¾ì•„ê°„ë‹¤.
*/
SELECT * FROM hr.emp WHERE employee_id = 100;

```

â–¶ï¸ ìˆ˜ë™ìœ¼ë¡œ non unique index ìƒì„±

```sql
-- ì¸ë±ìŠ¤ ì‚­ì œ
DROP INDEX emp_idx;

-- ìˆ˜ë™ìœ¼ë¡œ NON UNIQUE INDEX ìƒì„±
CREATE INDEX emp_idx
ON hr.emp(employee_id)
TABLESPACE users;
```

ex)

```sql
-- last_nameì€ ì¤‘ë³µì„± ìˆìŒ.
-- non unique index ìƒì„±
SELECT * FROM hr.emp WHERE last_name = 'King';

CREATE INDEX emp_name_idx
ON hr.emp(last_name)
TABLESPACE USERS;

/*
ë‚´ë¶€ì ìœ¼ë¡œ ì•„ë˜ì˜ ê²°ê³¼ ì§‘í•©ì„ ê°€ì§€ê³  ìƒì„±ëœë‹¤
SELECT last_name, rowid
FROM hr.emp
ORDER BY 1;
*/
```

â–¶ï¸ ì¸ë±ìŠ¤ ì‚­ì œ

ì†Œìœ ì. DROP ANY INDEX ì‹œìŠ¤í…œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ” ìœ ì €

```sql
DROP INDEX emp_idx;
```

â–¶ï¸ ì¸ë±ìŠ¤ ì‚­ì œ ì‹œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²½ìš° : primary key ì œì•½ ì¡°ê±´ì„ í•¨ê¼ ê±¸ì—ˆì„ ë•Œ

```sql
-- ì¸ë±ìŠ¤ ì‚­ì œ
DROP INDEX emp_idx;

-- UNIQUE ì¸ë±ìŠ¤ ìƒì„±í•œ í›„ PRIMARY KEY ì œì•½ ì¡°ê±´ ìƒì„±
-- ì‚¬ì›ë²ˆí˜¸ ì¤‘ë³µì„± x
CREATE UNIQUE INDEX emp_idx   
ON hr.emp(employee_id)
TABLESPACE users;

SELECT * FROM user_indexes WHERE table_name = 'EMP';
SELECT * FROM user_ind_columns WHERE table_name = 'EMP';
SELECT * FROM user_constraints WHERE table_name = 'EMP';
SELECT * FROM user_cons_columns WHERE table_name = 'EMP';

ALTER TABLE hr.emp ADD CONSTRAINT emp_id_pk PRIMARY KEY(employee_id);
SELECT * FROM user_constraints WHERE table_name = 'EMP';
SELECT * FROM user_cons_columns WHERE table_name = 'EMP';

-- ì¸ë±ìŠ¤ ì‚­ì œ ì˜¤ë¥˜
-- primary ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸
-- primary í‚¤ ì œì•½ ì¡°ê±´ì„ ë¨¼ì € ì‚­ì œ.
-- 02429. 00000 -  "cannot drop index used for enforcement of unique/primary key"
DROP INDEX emp_idx;
```