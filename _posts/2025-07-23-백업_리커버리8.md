---
title: "[63일차] Backup & Recovery8"
excerpt: "아이티윌 0723"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-23T18:26
---

# 백업 & 리커버리 8

날짜: 2025년 7월 23일
유형: 63일차, archive, 백업리커버리
포트폴리오: 미완료

**다시 한번 일관성 있는 백업 받기**

```sql
shutdown immediate
cd backup/arch/close/20250723
-- close - 오늘 날짜 디렉토리에 모든 파일 백업 받아두기
cp -v /u01/app/oracle/oradata/ORA19C/* .

-- open - 오늘 날짜 디렉토리에 모든 파일 백업 받아두기
cd backup/arch/open/20250723
cp -v /u01/app/oracle/oradata/ORA19C/* .

startup

-- close 백업 받아둔 위치에 pfile 생성
create pfile='home/oracle/backup/arch/close/20250723/initora19,ora' from spfile;

alter database begin backup;
! cp -v /u01/app/oracle/oradata/ORA19C/* home/oracle/backup/arch/close/20250723/
alter database end backup

alter database backup controlfile to 'home/oracle/backup/arch/close/20250723/control01.dbf';

-- 현재 current한 로그 백업
alter system archive log current;

alter system switch logfile;

-- 백업 이후에 리두 정보 확인
-- 아카이브 생성 확인
```

**장애 발생하면** 

✔️ **특정한 데이터 파일이 손실되었을 경우 복구 작업을 수행하기 위해**서 (online backup, 일관성 없는 백업)

```sql
select a.name, a.checkpoint_change#, b.status, b.change#, b.time
from v$datafile a, v$backup b
where a.file# = b.file#;

-- 📌  리두 로그 정보 확인
SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
FROM v$logfile a, v$log b
WHERE a.group# = b.group#
ORDER BY b.group#;

! ls arch*

-- 장애 발생
! rm /u01/app/oracle/oradata/ORA19C/users01.dbf
! rm arch1/* arch2/*
! ls arch*

```

1️⃣ 문제 발생한 데이터 파일을 offline

2️⃣ 백업본을 restore

3️⃣ 백업 이후 리두 적용

4️⃣ 복구 완료된 데이터 파일을 online 

✔️ **백업 이후 리두 정보가 있는 archive log file이 손실되었을 경우는 완전 복구 실패가 된다. 무조건 불완전 복구 수행해야 한다.**

```sql
-- 백업 정보 확인
select a.name, a.checkpoint_change#, b.status, b.change#, b.time
from v$datafile a, v$backup b
where a.file# = b.file#;

-- 📌  리두 로그 정보 확인
SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
FROM v$logfile a, v$log b
WHERE a.group# = b.group#
ORDER BY b.group#;

--  아카이브 로그 정보
select sequence#, name, first_change#, next_change# from v$archived_log;

```

✔️ **불완전 복구 수행**

1️⃣ 데이터베이스 종료

```sql
shutdown abort
```

2️⃣ 모든 백업 데이터 파일 찾아서 restore

```sql
! ls backup/arch/close/20250723/*.dbf 
! cp -v backup/arch/close/20250723/*.dbf /u01/app/oracle/oradata/ORA19C/
```

3️⃣ 데이터베이스 mount까지만 시작

```sql
startup mount 
```

4️⃣ 데이터 파일 백업 이후 문제가 발생한 archive log file 전까지 리두 적용, 불완전복구수행(cancel base recovery)

```sql
recover database until cancel
>cancel

alter database open resetlogs;
```

5️⃣ 백업을 받고 필요 없는 백업본과 archive lof file 삭제,

✔️` 특정한 데이터 파일 손상, 백업 이후 아카이브 손실 (online backup, 일관성 없는 백업

→ 불완전 복구 방식

1️⃣ 데이터베이스 종료

```sql
shutdown abort
```

2️⃣ 모든 백업 데이터 파일 찾아서 restore

3️⃣ 데이터베이스 mount 까지만 시작

4️⃣ 데이터 파일 백업 이후 문제가 발생한 archive log file 전까지 리두 적용, 불완전복구수행(cancel base recovery)

5️⃣ 백업 시점 리두 정보가 없으면 불완전 복구 실패

✔️ 불완전 복구 작업은 실패됐지만 백업 데이터 파일 체크 포인트가 일치가 될 경우 해결방법

```sql
select status from v$instace;
creaate pfile from spfile;
shutdown abort
! vi $ORACLE_HOME/dbs/initora19c.ora
-- _allow_resetlogs_corruption=true 입력

alter database open resetlogs;
```

✔️ 특정한 데이터 파일 손상, 백업 이후 아카이브  손실(offline backup, 일관성있는 백업)

✔️ archive 생성된 후 inactive 상태에 있는 redo log file 삭제 (데이터베이스 운영중인 상태에서는 hang 상태가 된다.