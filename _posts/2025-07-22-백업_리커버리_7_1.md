---
title: "[62일차] Backup & Recovery7_1"
excerpt: "아이티윌 0722"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-22T18:26
---

# 백업 & 리커버리 7-1

날짜: 2025년 7월 22일
유형: 62일차, archive, 백업리커버리
포트폴리오: 미완료

```sql
select sequence#, name, first_change#, next_change# from v$archived_log;

 SEQUENCE# NAME                                               FIRST_CHANGE# NEXT_CHANGE#
---------- -------------------------------------------------- ------------- ------------
        11 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2767692      2849125
        12 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2849125      2849255
        13 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2849255      2857693
        14 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857693      2857696
        15 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857696      2857699
        16 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857699      2958854
```

📍 archive log file이 생성될 위치를 수정

▶️ 아카이브 백그라운드 프로세서

```sql
SYS@ora19c> ! ps -ef | grep arc
oracle   16114     1  0 17:46 ?        00:00:00 ora_arc0_ora19c
oracle   16116     1  0 17:46 ?        00:00:00 ora_arc1_ora19c
oracle   16118     1  0 17:46 ?        00:00:00 ora_arc2_ora19c
oracle   16120     1  0 17:46 ?        00:00:00 ora_arc3_ora19c
oracle   29467 27424  0 19:35 pts/1    00:00:00 /bin/bash -c  ps -ef | grep arc
oracle   29469 29467  0 19:35 pts/1    00:00:00 grep arc
```

▶️ 디렉토리 2개 만들기

```sql
[oracle@oracle ~]$ mkdir  arch1 arch2
---> arch1 안에는 온라인 백업 중 생성된 아카이브 로그 파일 저장될 것 
[oracle@oracle ~]$ ls
arch1  backup                create_control.sql  Documents  Downloads   LINUX.X64_193000_db_home.zip  Music            Pictures  Templates  Videos
arch2  control_20250718.txt  Desktop             dontouch   glogin.sql  login.sql                     new_control.txt  Public    userdata
[oracle@oracle ~]$ exit
exit
```

▶️ 위치 수정

🌳 mandatory : archive 작업이 성공적으로 완료되어야 redo log file 를 겹쳐 사용할 수 있다.

만약에 mandatory로 설정되어 있는 곳에 공간이 부족할 경우

🌳 optional : archive 작업이 성공적으로 완료되지 않은 경우에도 redo log file를 겹쳐 사용할 수 있다.

공간이 부족하면 archive log file 이 생성되지 않는다. 기본값 

```sql
alter system set log_archive_dest_1 = "location=/home/oracle/arch1 mandatory" scope = spfile;
alter system set log_archive_dest_2 = "location=/home/oracle/arch2 mandatory" scope = spfile;
```

▶️ archive log file 이름 포맷

**[필수]**

🌳 %t : THREAD#. instance number

🌳 %s : SEQUENCE#, log sequence number

🌳 %r : Resetlogs ID, 여러 데이터베이스에 걸쳐 아카이브된 로그 파일의 유일한 이름을 나타낸다. (절대 겹져지지 않은 고유한 데이터베이스)

```sql
show parameter log_archive_format

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_format                   string      %t_%s_%r.dbf
```

▶️ archive log file 이름 포맷 수정

📍 /u01/app/oracle/oradata/ORA19C/users01.dbf 손상

```sql
SYS@ora19c> alter system set log_archive_format = 'arch_%t_%s_%r .arc' scope = spfile;

System altered.

SYS@ora19c> shutdown immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SYS@ora19c> startup
ORACLE instance started.

Total System Global Area  713027608 bytes
Fixed Size                  8900632 bytes
Variable Size             507510784 bytes
Database Buffers          188743680 bytes
Redo Buffers                7872512 bytes
Database mounted.
Database opened.

SYS@ora19c> archive log list
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            /home/oracle/arch2
Oldest online log sequence     15

show parameter log

log_archive_format                   string      arch_%t_%s_%r .arc

select destination,binding,status from v$archive_dest where destination is not null;

DESTINATION
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/home/oracle/arch1
/home/oracle/arch2

-- 현재 리두 로그 정보 조회
SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
FROM v$logfile a, v$log b
WHERE a.group# = b.group#
ORDER BY b.group#;

 GROUP#  SEQUENCE# MEMBER
---------- ---------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         1         16 /u01/app/oracle/oradata/ORA19C/redo01.log
         2         17 /u01/app/oracle/oradata/ORA19C/redo02.log
         3         15 /u01/app/oracle/oradata/ORA19C/redo03.log

alter system switch logfile;

SYS@ora19c> select sequence#, name, first_change#, next_change# from v$archived_log;

 SEQUENCE# NAME                                               FIRST_CHANGE# NEXT_CHANGE#
---------- -------------------------------------------------- ------------- ------------
        11 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2767692      2849125
        12 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2849125      2849255
        13 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2849255      2857693
        14 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857693      2857696
        15 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857696      2857699
        16 /u01/app/oracle/fast_recovery_area/ORA19C/archivel       2857699      2958854
        17 /home/oracle/arch1/arch_1_17_1205348976_.arc             2958854      2972348
        17 /home/oracle/arch2/arch_1_17_1205348976_.arc             2958854      2972348
        18 /home/oracle/arch1/arch_1_18_1205348976_.arc             2972348      2972396
        18 /home/oracle/arch2/arch_1_18_1205348976_.arc             2972348      2972396

```

1️⃣ 손상된 파일이 있는 테이블스페이스를 offline으로 설정

```sql
alter tablespace users offline immediate;
```

2️⃣ 최근 백업본 찾아서 restore

```sql
 ! ls /home/oracle/backup/arch/open/users01.dbf
```

3️⃣ 백업 이후 리두 정보 적용

![image.png](/assets/20250722/1.png)

```sql
! ls /home/oracle/arch1
```

![1)](/assets/20250722/2.png)

1)

![2)](/assets/20250722/3.png)

2)

```sql
맨마지막 리두 정보는 auto 입력하면 알아서 적용된다.
```

4️⃣ 복구 완료된 테이블 스페이스 online

```sql
alter tablespace users online;
```