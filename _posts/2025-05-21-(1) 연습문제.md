---
title: "[22ÏùºÏ∞®] Ïó∞ÏäµÎ¨∏Ï†ú"
excerpt: "ÏïÑÏù¥Ìã∞Ïúå 0521_(1) non-equi-join, Ïä§ÏπºÎùº ÏÑúÎ∏å ÏøºÎ¶¨, ROLL UP "
categories:
      - ORACLE11g
tags:
      -  ORACLE11g
      - TIL
last-modified-at: 2025-05-21T21:08
---

# Ïó∞ÏäµÎ¨∏Ï†ú

[Î¨∏Ï†ú41] ÏÇ¨ÏõêÎì§Ïùò employee_id, salary, grade_levelÏùÑ Ï∂úÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.

1) join

```sql
SELECT e.employee_id, e.salary, j.grade_level
FROM hr.employees e, hr.job_grades j
WHERE e.salary >= j.lowest_sal
AND e.salary < j.highest_sal;
```

2) scalar subquery

```sql
SELECT e.employee_id, e.salary, (SELECT grade_level
                                   FROM hr.job_grades 
                                  WHERE e.salary >= lowest_sal
                                    AND e.salary < highest_sal)
FROM hr.employees e;
```

[Î¨∏Ï†ú42] ÏÇ¨ÏõêÎì§Ïùò employee_id, last_nameÏùÑ Ï∂úÎ†•ÌïòÏÑ∏Ïöî.Îã® department_nameÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ïò§Î¶ÑÏ∞®Ïàú Ï†ïÎ†¨Ìï¥Ï£ºÏÑ∏Ïöî.

```sql
SELECT e.employee_id, e.last_name
FROM hr.employees e
ORDER BY (SELECT department_name 
            FROM departments 
           WHERE department_id = e.department_id);
```

![image.png](/assets/20250521/1.png)

‚Üí ÏúÑÏùò Ï°∞Ïù∏Í≥º ÎèôÏùºÌïú Î¨∏Ïû• 

‚Üí query execution cache 

[Î¨∏Ï†ú43] job_idÎ•º ÌïúÎ≤àÏù¥ÎùºÎèÑ Î∞îÍæº ÏÇ¨ÏõêÎì§Ïùò Ï†ïÎ≥¥Î•º Ï∂úÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.

```sql
SELECT *
FROM hr.employees e
WHERE EXISTS (SELECT 'x'  
                FROM hr.job_history
                WHERE employee_id = e.employee_id);
```

üìç ÏïÑÎûò ÏøºÎ¶¨ : ÏïÖÏÑ± ÏΩîÎìú (**INTERSECT** ÏÇ¨Ïö© Î¨∏Ïû•) 

1. sort Ìï®Ïàò ÏÇ¨Ïö© 
2. Í∞ôÏùÄ ÌÖåÏù¥Î∏î Ïó¨Îü¨ Î≤à Ï∞∏Ï°∞
3. INTERSECT ÎßåÎÇòÎ©¥ ÏäµÍ¥ÄÏ†ÅÏúºÎ°ú EXISTS Î°ú ÌäúÎãùÌï¥Î≥¥Ïûê.

![image.png](/assets/20250521/2.png)

[Î¨∏Ï†ú44] job_idÎ•º Î∞îÍæ∏ÏßÄ ÏïäÏùÄ ÏÇ¨ÏõêÎì§Ïùò Ï†ïÎ≥¥Î•º Ï∂úÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.

```sql
SELECT *
FROM hr.employees e
WHERE NOT EXISTS (SELECT 'x'  
                FROM hr.job_history
                WHERE employee_id = e.employee_id);
```

üìç ÏïÑÎûò ÏøºÎ¶¨ : ÏïÖÏÑ± ÏΩîÎìú (MINUSÏÇ¨Ïö© Î¨∏Ïû•) 

1. sort Ìï®Ïàò ÏÇ¨Ïö© 
2. Í∞ôÏùÄ ÌÖåÏù¥Î∏î Ïó¨Îü¨ Î≤à Ï∞∏Ï°∞
3. MINUS ÎßåÎÇòÎ©¥ ÏäµÍ¥ÄÏ†ÅÏúºÎ°ú NOT EXISTS Î°ú ÌäúÎãùÌï¥Î≥¥Ïûê.

![image.png](/assets/20250521/3.png)

[Î¨∏Ï†ú45] UNION ‚Üí UNION ALL + NOT EXISTS ÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Í≤∞Í≥º ÏßëÌï©ÏùÑ Ï∂úÎ†•ÌïòÏÑ∏Ïöî.  

‚ñ∂Ô∏è FULL OUTER JOIN

```sql
SELECT e.employee_id, d.department_name
FROM hr.employees e, hr.departments d
WHERE e.department_id = d.department_id(+)
UNION
SELECT e.employee_id, d.department_name
FROM hr.employees e, hr.departments d
WHERE e.department_id(+) = d.department_id;

-- UNION ALLÎ°ú Î≥ÄÌôòÌïòÎêò, Ï§ëÎ≥µÏùÄ Ï†úÍ±∞
-- ÏÜåÏÜç ÏÇ¨ÏõêÏù¥ ÏóÜÎäî Î∂ÄÏÑúÎûë UNION ALL ÌïòÎ©¥ ÎêúÎã§.

SELECT e.employee_id, d.department_name
FROM hr.employees e, hr.departments d
WHERE e.department_id = d.department_id(+)
UNION
SELECT NULL, department_name
FROM hr.departments d
WHERE NOT EXISTS (SELECT 'x'
                    FROM hr.employees
                    WHERE department_id = d.department_id);
                    
--> Ïù¥Î†áÍ≤å Ìï¥ÎèÑ ÎèôÏùº ÌÖåÏù¥Î∏î Ïó¨Îü¨Î≤à accessÌï®. ÏÑ±Îä• Îñ®Ïñ¥Ïßê
--> ANSI FULL OUTER JOIN ÏÇ¨Ïö© Í∂åÍ≥†                     
```

[Î¨∏Ï†ú46] 

1) department_id, job_id, manager_id Í∏∞Ï§ÄÏúºÎ°ú Ï¥ùÏï° Í∏âÏó¨Î•º Ï∂úÎ†•

```sql
SELECT department_id, job_id,manager_id, sum(salary)
FROM hr.employees
GROUP BY department_id, job_id, manager_id;
```

2) department_id, job_id Í∏∞Ï§ÄÏúºÎ°ú Ï¥ùÏï°Í∏âÏó¨Î•º Ï∂úÎ†•

```sql
SELECT department_id, job_id, sum(salary)
FROM hr.employees
GROUP BY department_id, job_id;
```

3) department_id Í∏∞Ï§ÄÏúºÎ°ú Ï¥ùÏï°Í∏âÏó¨Î•º Ï∂úÎ†•

```sql
SELECT department_id ,sum(salary)
FROM hr.employees
GROUP BY department_id;
```

4) Ï†ÑÏ≤¥ Ï¥ùÏï° Í∏âÏó¨Î•º Ï∂úÎ†•1),2),3),4)Î•º ÌïúÍ∫ºÎ≤àÏóê Ï∂úÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.

```sql
SELECT sum(salary)
FROM hr.employees;
```

1),2),3),4)Î•º ÌïúÍ∫ºÎ≤àÏóê Ï∂úÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.

```sql

-- ÏúÑÏπò Ïûò ÎßûÏ∂∞ÏÑú Ïì∞Í∏∞! 
--> ÎèôÏùºÌïú ÌÖåÏù¥Î∏î 4Î≤à Ï∞∏Ï°∞
--> FULL TABLE SCAN  

SELECT department_id, job_id,manager_id, sum(salary)
FROM hr.employees
GROUP BY department_id, job_id, manager_id
UNION ALL 
SELECT department_id, job_id, null ,sum(salary)
FROM hr.employees
GROUP BY department_id, job_id
UNION ALL                
SELECT department_id,  null,  null, sum(salary)
FROM hr.employees
GROUP BY department_id
UNION ALL   
SELECT null,null, null, sum(salary) 
FROM hr.employees;
```

‚Üí ROLL UP

```sql
SELECT department_id, job_id, manager_id, sum(salary)
FROM hr.employees
GROUP BY ROLLUP(department_id,job_id,manager_id);
```

![image.png](/assets/20250521/4.png)

![image.png](/assets/20250521/5.png)

üìçÏïÑÎûòÏôÄ Í∞ôÏù¥ ÌëúÌòÑÌïòÎ†§Î©¥

![image.png](/assets/20250521/6.png)

```sql
SELECT department_id, job_id, manager_id, sum(salary)
FROM hr.employees
GROUP BY ROLLUP((department_id,job_id),manager_id);
```

ÏïÑÎûò ÌëúÏ≤òÎüº ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî.

![image.png](/assets/20250521/7.png)

```sql
SELECT
    year,
    max(decode(quarter,1, sum_sal)) Q1,
    max(decode(quarter,2, sum_sal)) Q2,
    max(decode(quarter,3, sum_sal)) Q3,
    max(decode(quarter,4, sum_sal)) Q4,
    max(decode(quarter, null,sum_sal)) Ìï©
FROM (SELECT to_char(hire_date, 'yyyy') year , to_char(hire_date, 'q') quarter , sum(salary) sum_sal
        FROM hr.employees
      GROUP BY CUBE(to_char(hire_date, 'yyyy'), to_char(hire_date, 'q')))
GROUP BY year
ORDER BY 1;
```

```sql
--> union allÎ°ú ÌíÄÏóàÏùÑ ÎïåÎ•º ÏÉùÍ∞ÅÌï¥Î≥¥Ïûê.
--> Ìï©ÏπòÎ†§Î©¥ ÌÉÄÏûÖ ÎßûÏ∂∞Ïïº ÌïúÎã§. 0ÏùÄ Ïà´Ïûê.
SELECT
   *
FROM (SELECT to_char(hire_date, 'yyyy') year , nvl(to_char(hire_date, 'q'),0) quarter , sum(salary) sum_sal
        FROM hr.employees
      GROUP BY CUBE(to_char(hire_date, 'yyyy'), to_char(hire_date, 'q')))      
PIVOT(max(sum_sal) FOR quarter IN (1,2,3,4, 0 "Ìï©"))
ORDER BY 1;     
```

```sql
--> Ïù¥Í≤å Ï†ïÎãµ
--> null Ïù∏ Î∂ÄÎ∂Ñ 0ÏúºÎ°ú ÎåÄÏ≤¥ 
SELECT *
FROM(SELECT
   year, nvl(quarter,0) quarter, sum_sal
FROM (SELECT to_char(hire_date, 'yyyy') year , to_char(hire_date, 'q') quarter , sum(salary) sum_sal
        FROM hr.employees
      GROUP BY CUBE(to_char(hire_date, 'yyyy'), to_char(hire_date, 'q'))))
      
PIVOT(max(sum_sal) FOR quarter IN (1,2,3,4, 0 "Ìï©"))
ORDER BY 1;     
```