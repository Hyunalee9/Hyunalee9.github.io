---
title: "[68일차] RMAN 2 "
excerpt: "아이티윌 0731"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-31T21:08
---
# RMAN_2

- 📍 undo
    
    ▶️ 상황
    
    ```sql
    -- HR 세션
    update hr.employees set salary = salary * 1.1 where employee_id = 100;
    
    -- SYS 세션
    select s.username, s.sid, s.serial#, r.name, t.xidusn, t.ubafil, t.ubablk, t.used_ublk
    from v$session s, v$transaction t, v$rollname r
    where s.taddr = t.addr
    and t.xidusn = r.usn;
    
    /*
    HR	284	27395	_SYSSMU3_2421748942$	3	4	4080	1
    */
    ```
    
    ▶️ 장애 발생
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
    ! ls /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
    ```
    
    ▶️ 새로운 HR SESSION
    
    ```sql
    select salary from hr.employees where employee_id = 100;
    update hr.employees set salary = salary * 1.1 where employee_id = 200;
    ```
    
    ▶️ SYS SESSION
    
    ```sql
    select s.username, s.sid, s.serial#, r.name, t.xidusn, t.ubafil, t.ubablk, t.used_ublk
    from v$session s, v$transaction t, v$rollname r
    where s.taddr = t.addr
    and t.xidusn = r.usn;
    
    alter system checkpoint; -- 오류 유발
    ```
    
    ▶️ RMAN
    
    ```sql
    rman target /
    startup   -- mounted status
    list failure
    list 6795 detail
    restore tablespace undotbs1
    restore datafile '/u01/app/oracle/oradata/ORA19C/undotbs01.dbf
    recover tablespace undotbs1 -- redo 적용
    alter database open;
    ```
    
    ▶️ HR SESSION
    
    ```sql
    select salary from hr.employees where employee_id = 100;  -- 이전 값으로 덮어씌워졌다.
    ```
    
    ▶️ TO_DO : 운영 중에 undo 테이블스페이스 손상되었을 때 복구 작업.
    
- 📍 데이터베이스 정상적인 종료 후 control file 손상(백업본 사용) 1
    
    ▶️ startup nomount
    
    ▶️ 백업 컨트롤 파일 restore
    
    ▶️ alter database mount;
    
    ▶️ recover database using backup controlfile >auto
    
    …
    
    🌳 오류 # current redo log file을 archive log file에서 찾기 때문에 오류 발생
    
    🌳 현재 redo log sequence 번호에 해당하는 redo log file을 찾아야 한다.
    
    ```sql
    recover database using backup controlfile 
    > 현재 redo log file 입력
    ```
    
    ▶️ alter database open resetlogs;
    
    ---
    
    **RMAN**
    
    ▶️ 데이터베이스 정상 종료
    
    ```sql
    shutdown immediate;
    ! ls /u01/app/oracle/oradata/ORA19C/control01.ctl
    ! rm /u01/app/oracle/oradata/ORA19C/control01.ctl
    ! ls /u01/app/oracle/oradata/ORA19C/control01.ctl
    ```
    
    ▶️ startup
    
    ```sql
    startup -- 오류 
    ```
    
    ▶️ RMAN 접속
    
    ```sql
    rman target /
    select status from v$instance;
    
    -- rman에서 백업 정보는 컨트롤 파일을 가지고 있다.
    -- 자동 백업 on 해놓아서 백업본은 존재
    
    -- 가장 최근의 백업본 복구
    restore controlfile from autobackup;
    
    -- 혹시 안된다면?
    -- FRA로 이동 -> ORA19C -> autobackup -> 일자별로 안에 backup piece 수동으로 복구
    -- ex) 07월 31일자 : o1_mf_s_1207839801_n8mff95w_.bkp
    restore controlfile from '/u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_30/o1_mf_s_1207839801_n8mff95w_.bkp
    
    -- mount까지 올리기
    alter database mount;
    
    -- recover
    recover database -- 오류가 발생한다면..
    ```
    
  ![image.png](/assets/20250731/1.png)
    
    ```sql
    -- 현재 redo까지 적용하지 못해서 문제가 발생함.
    ```
    
    ▶️ trace 재생성해서 문제를 해결한다. (백업 정보는 사라짐)
    
    ```sql
    alter database backup controlfile to trace as '/home/oracle/control.txt';
    shutdown abort
    startup nomount
    
    CREATE CONTROLFILE REUSE DATABASE "ORA19C" NORESETLOGS ARCHIVELOG
        MAXLOGFILES 16
        MAXLOGMEMBERS 3
        MAXDATAFILES 100
        MAXINSTANCES 8
        MAXLOGHISTORY 292
    LOGFILE
      GROUP 1 '/u01/app/oracle/oradata/ORA19C/redo01.log' SIZE 200M BLOCKSIZE 512,
      GROUP 2 '/u01/app/oracle/oradata/ORA19C/redo02.log' SIZE 200M BLOCKSIZE 512,
      GROUP 3 '/u01/app/oracle/oradata/ORA19C/redo03.log' SIZE 200M BLOCKSIZE 512
    DATAFILE
      '/u01/app/oracle/oradata/ORA19C/system01.dbf',
      '/u01/app/oracle/oradata/ORA19C/sysaux01.dbf',
      '/u01/app/oracle/oradata/ORA19C/undotbs01.dbf',
      '/u01/app/oracle/oradata/ORA19C/users01.dbf'
    CHARACTER SET AL32UTF8
    ;
    
    alter database open;
    
    -- temp 파일 추가
    alter tablespace temp add tempfile '' reuse
    ```
    
- 📍  데이터베이스 정상적인 종료 후 control file 손상(백업본 사용) 2
    - ▶️ 백업
        
        ```sql
        > RMAN
        -- 데이터파일, 컨트롤 파일 백업.
        backup database;
        list backup;
        
        -- 아카이브 정보
        select sequence#, name, first_change#, next_change# from v$archived_log;
        
        /*
        1)
        /home/oracle/arch1/arch_1_40_1205348976_.arc
        /home/oracle/arch2/arch_1_40_1205348976_.arc
        
        2) 두번째 시도 
        /home/oracle/arch1/arch_1_1_1207915685_.arc	4390051	4391614
        /home/oracle/arch2/arch_1_1_1207915685_.arc	4390051	4391614
        */
        
        -- 안전하게 아카이브 로그 받자.
        SYS@ora19c> alter system archive log current;
        
        -- 확인 
        list backup;
        
        ```
        
        ▶️ 스토리지 낭비 예방
        
        ```sql
        report obsolete;
        
        /*
        
        Type                 Key    Completion Time    Filename/Handle
        -------------------- ------ ------------------ --------------------
        Archive Log          41     30-JUL-25          /home/oracle/arch2/arch_1_38_1205348976_.ar                                            c
        Backup Set           4      30-JUL-25
        Backup Piece         4      30-JUL-25          /u01/app/oracle/fast_recovery_area/ORA19C/b                                            ackupset/2025_07_30/o1_mf_nnndf_TAG20250730T110728_n8lzm0jv_.bkp
        Archive Log          40     30-JUL-25          /home/oracle/arch1/arch_1_38_1205348976_.ar                                            c
        Archive Log          43     31-JUL-25          /home/oracle/arch2/arch_1_39_1205348976_.ar                                            c
        Backup Set           7      30-JUL-25
        Backup Piece         7      30-JUL-25          /u01/app/oracle/fast_recovery_area/ORA19C/a                                            utobackup/2025_07_30/o1_mf_s_1207839801_n8mff95w_.bkp
        Archive Log          42     31-JUL-25          /home/oracle/arch1/arch_1_39_1205348976_.ar                                            c
        
        */
        
        delete obsolete;
        
        RMAN> report obsolete;
        
        /*
        RMAN retention policy will be applied to the command
        RMAN retention policy is set to redundancy 1
        no obsolete backups found
        */
        
        ```
        
        ▶️ crosscheck
        
        ```sql
        list expired archivelog all;
        ```
        
    - ▶️ 장애 유발
        
        ```sql
        -- 정상 종료
        shutdown immediate;
        
        -- 장애 유발
        ! rm /u01/app/oracle/oradata/ORA19C/control01.ctl
        ```
        
    - ▶️ RMAN
        
        ```sql
        select status from v$instance;
        restore controlfile from autobackup;
        alter database mount;
        
        RMAN> recover database;
        
        Starting recover at 31-JUL-25
        Starting implicit crosscheck backup at 31-JUL-25
        allocated channel: ORA_DISK_1
        channel ORA_DISK_1: SID=257 device type=DISK
        Crosschecked 3 objects
        Finished implicit crosscheck backup at 31-JUL-25
        
        Starting implicit crosscheck copy at 31-JUL-25
        using channel ORA_DISK_1
        Finished implicit crosscheck copy at 31-JUL-25
        
        searching for all files in the recovery area
        cataloging files...
        cataloging done
        
        List of Cataloged Files
        =======================
        File Name: /u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_31/o1_mf_s_1207913112_n8oo08jt_.bkp
        
        using channel ORA_DISK_1
        
        starting media recovery
        
        archived log for thread 1 with sequence 40 is already on disk as file /u01/app/oracle/oradata/ORA19C/redo01.log
        archived log for thread 1 with sequence 41 is already on disk as file /u01/app/oracle/oradata/ORA19C/redo02.log
        archived log file name=/u01/app/oracle/oradata/ORA19C/redo01.log thread=1 sequence=40
        archived log file name=/u01/app/oracle/oradata/ORA19C/redo02.log thread=1 sequence=41
        media recovery complete, elapsed time: 00:00:01
        Finished recover at 31-JUL-25
        
        alter database open resetlogs;
        
        --> 백업받기
        ```
        
        ▶️ 선생님과 다른 사람들은 오류가 났음. 해결방법
        
        ```sql
        -- autobackup 엉뚱한 컨트롤 파일을 찾아서 올려서 오류가 났음
        shutdown immediate;
        
        -- autobackup 받아놓은 곳으로 이동
        cd $ORACLE_BASE/fast_recovery_area/ORA19C/autobacup/2025_07_31
        
        -- 가장 최근에 받아놓은 백업 피스 확인
        
        restore controlfile from arch_1_40_1205348976_.arc
        
        -- resetlogs 로 open시 그 즉시 백업 정보 받자.
        
        alter database mount;
        recover database;
        alter database open resetlogs;
        ```
        
- 📍  모든 데이터 파일, 컨트롤 파일 손상
    
    ▶️확인
    
    ```sql
    SELECT a.file#, b.name tbs_name, a.name file_name, a.status, a.checkpoint_change#
    FROM v$datafile a, v$tablespace b
    WHERE a.ts# = b.ts#;
    
    select name from v$controlfile;
    ```
    
    ▶️ 장애 발생
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/*.{ctl,dbf}
    alter system checkpoint;
    
    startup
    ORACLE instance started.
    
    Total System Global Area  713027608 bytes
    Fixed Size                  8900632 bytes
    Variable Size             578813952 bytes
    Database Buffers          117440512 bytes
    Redo Buffers                7872512 bytes
    ORA-00205: error in identifying control file, check alert log for more info
    ```
    
    ▶️ RMAN
    
    ```sql
    startup nomount;
    restore controlfile from autobackup;
    alter database mount;
    list backup;
    restore database;
    recover database;
    alter database open resetlogs;
    
    -- 또 백업받아놓아야함.
    ```
    
    ▶️ 백업 다시 받기
    
    ```sql
    -- 아카이브 정보
    -- o1_mf_s_1207926009_n8p1m9qy_.bkp
    
    -- 마지막 체크포인트 지점 
    -- SCN : 4414297
    
    -- redo 
    -- 4414297  #1 - inactive , current :  #2 4414297
    ```
    
- 📍  모든 데이터 파일, 컨트롤 파일 손상2 (current한 리두 로그까지 복구)
    
    ```sql
    -- 로그 스위치 
    alter system switch logfile;
    /
    /
    
    -- redo 정보
    SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
    FROM v$logfile a, v$log b
    WHERE a.group# = b.group#
    ORDER BY b.group#;
    
    /*
    4	/u01/app/oracle/oradata/ORA19C/redo01.log	INACTIVE	4519092	25/07/31	4519095	25/07/31
    5	/u01/app/oracle/oradata/ORA19C/redo02.log	INACTIVE	4519095	25/07/31	4519098	25/07/31
    6	/u01/app/oracle/oradata/ORA19C/redo03.log	CURRENT	4519098	25/07/31	18446744073709551615	
    */
    -- 아카이브 정보 
    select sequence#, name, first_change#, next_change# from v$archived_log;
    
    /*
    /home/oracle/arch1/arch_1_1_1207925799_.arc	4414297	4415752
    /home/oracle/arch2/arch_1_1_1207925799_.arc	4414297	4415752
    /home/oracle/arch1/arch_1_2_1207925799_.arc	4415752	4518329
    /home/oracle/arch2/arch_1_2_1207925799_.arc	4415752	4518329
    /home/oracle/arch1/arch_1_3_1207925799_.arc	4518329	4519092
    /home/oracle/arch2/arch_1_3_1207925799_.arc	4518329	4519092
    /home/oracle/arch1/arch_1_4_1207925799_.arc	4519092	4519095
    /home/oracle/arch2/arch_1_4_1207925799_.arc	4519092	4519095
    /home/oracle/arch1/arch_1_5_1207925799_.arc	4519095	4519098  -- 여기
    /home/oracle/arch2/arch_1_5_1207925799_.arc	4519095	4519098
    
    백업 - 4519098
    */
    ```
    
    ▶️ 장애 발생
    
    ```sql
    ! ls /u01/app/oracle/oradata/ORA19C/*.{ctl,log}
    ! rm /u01/app/oracle/oradata/ORA19C/*.{ctl,log}
    ! ls /u01/app/oracle/oradata/ORA19C/*.{ctl,log}
    
    shutdown abort;
    ```
    
    ▶️ rman
    
    ```sql
    startup nomount;
    -- 컨트롤 파일 restore
    restore controlfile from autobackup; -- 백업 파일은 컨트롤 파일이 가지고 있다.
    alter database mount;
    restore database;
    recover database;
    
    /*
    using channel ORA_DISK_1
    
    starting media recovery
    
    archived log file name=/home/oracle/arch2/arch_1_1_1207925799_.arc thread=1 sequence=1
    archived log file name=/home/oracle/arch2/arch_1_2_1207925799_.arc thread=1 sequence=2
    archived log file name=/home/oracle/arch2/arch_1_3_1207925799_.arc thread=1 sequence=3
    archived log file name=/home/oracle/arch2/arch_1_4_1207925799_.arc thread=1 sequence=4
    archived log file name=/home/oracle/arch2/arch_1_5_1207925799_.arc thread=1 sequence=5
    unable to find archived log
    archived log thread=1 sequence=6
    RMAN-00571: ===========================================================
    RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
    RMAN-00571: ===========================================================
    RMAN-03002: failure of recover command at 07/31/2025 15:23:31
    RMAN-06054: media recovery requesting unknown archived log for thread 1 with sequence 6 and starting SCN of 4519098
    
    */
    ```
    
    ▶️ 문제가 되는 current 한 SCN 번호를 기준으로 불완전 복구
    
    ```sql
    -- rman에서는 cancel 베이스 리커버리가 없음.
    -- 무조건 작업형 모드로 수행해야 함.
    run {
    	set until scn=4519098;
    	restore database;
    	recover database;
    	alter database open resetlogs;
    }
    
    ```
    
    ▶️ 다시 백업
    
    ```sql
    -- 최신 아카이브
    o1_mf_s_1207928098_n8p3nlmk_.bkp
    
    -- 로그 
    /*
    7	/u01/app/oracle/oradata/ORA19C/redo01.log	ACTIVE	4526470
    8	/u01/app/oracle/oradata/ORA19C/redo02.log	CURRENT	4527042
    6	/u01/app/oracle/oradata/ORA19C/redo03.log	INACTIVE	4525212
    
    */
    
    -- 논리 아카이브
    /*
    
    /home/oracle/arch2/arch_1_6_1207927727_.arc	4525205	4525212
    /home/oracle/arch1/arch_1_7_1207927727_.arc	4525212	4526470
    /home/oracle/arch1/arch_1_8_1207927727_.arc	4526470 4527042
    
    -- 마지막 체크포인트 4525212
    
    current : 4527042
    */
    
    ```
    
    ▶️ 아카이브 로그 수동 삭제
    
    ```sql
    SYS@ora19c> ! rm arch1/arch_1_{2,3,4,5}_1207927727_.arc
    
    SYS@ora19c> ! ls arch*
    arch1:
    arch_1_6_1207927727_.arc  arch_1_7_1207927727_.arc  arch_1_8_1207927727_.arc
    
    arch2:
    arch_1_2_1207927727_.arc  arch_1_4_1207927727_.arc  arch_1_6_1207927727_.arc  arch_1_8_1207927727_.arc
    arch_1_3_1207927727_.arc  arch_1_5_1207927727_.arc  arch_1_7_1207927727_.arc
    
    SYS@ora19c> ! rm arch2/arch_1_{2,3,4,5}_1207927727_.arc
    
    SYS@ora19c> ! ls arch*
    arch1:
    arch_1_6_1207927727_.arc  arch_1_7_1207927727_.arc  arch_1_8_1207927727_.arc
    
    arch2:
    arch_1_6_1207927727_.arc  arch_1_7_1207927727_.arc  arch_1_8_1207927727_.arc
    
    ```
    
- 📍  시간을 기준으로 불완전 복구(time base recovery)
    
    ▶️ 확인
    
    ```sql
    
    -- 최신 아카이브
    o1_mf_s_1207928098_n8p3nlmk_.bkp
    
    -- 로그 
    /*
    7	/u01/app/oracle/oradata/ORA19C/redo01.log	ACTIVE	4526470
    8	/u01/app/oracle/oradata/ORA19C/redo02.log	CURRENT	4527042
    6	/u01/app/oracle/oradata/ORA19C/redo03.log	INACTIVE	4525212
    
    */
    
    -- 논리 아카이브
    /*
    
    /home/oracle/arch2/arch_1_6_1207927727_.arc	4525205	4525212
    /home/oracle/arch1/arch_1_7_1207927727_.arc	4525212	4526470
    /home/oracle/arch1/arch_1_8_1207927727_.arc	4526470 4527042
    
    + /home/oracle/arch2/arch_1_9_1207927727_.arc	4527042
    -- 마지막 체크포인트 4525212
    
    current : 4527042
    */
    
    4520749
    
    SELECT a.file#, b.name tbs_name, a.name file_name, a.status, a.checkpoint_change#
    FROM v$datafile a, v$tablespace b
    WHERE a.ts# = b.ts#;
    
    /*
    SYSAUX	/u01/app/oracle/oradata/ORA19C/sysaux01.dbf	ONLINE	4527042
    SYSTEM	/u01/app/oracle/oradata/ORA19C/system01.dbf	SYSTEM	4527042
    UNDOTBS1	/u01/app/oracle/oradata/ORA19C/undotbs01.dbf	ONLINE	4527042
    USERS	/u01/app/oracle/oradata/ORA19C/users01.dbf	ONLINE	4527042
    
    */
    ```
    
    ▶️ 테이블스페이스 생성
    
    ```sql
    create tablespace data_tbs datafile '/u01/app/oracle/oradata/ORA19C/data_tbs01.dbf' size 5m;
    
    SELECT a.file#, b.name tbs_name, a.name file_name, a.status, a.checkpoint_change#
    FROM v$datafile a, v$tablespace b
    WHERE a.ts# = b.ts#;
    
    create table hr.loc_temp tablespace data_tbs as select * from hr.locations;
    
    > rman
    
    RMAN> report schema;
    
    Report of database schema for database with db_unique_name ORA19C
    
    List of Permanent Datafiles
    ===========================
    File Size(MB) Tablespace           RB segs Datafile Name
    ---- -------- -------------------- ------- ------------------------
    1    920      SYSTEM               YES     /u01/app/oracle/oradata/ORA19C/system01.dbf
    3    720      SYSAUX               NO      /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
    4    340      UNDOTBS1             YES     /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
    5    5        DATA_TBS             NO      /u01/app/oracle/oradata/ORA19C/data_tbs01.dbf
    7    5        USERS                NO      /u01/app/oracle/oradata/ORA19C/users01.dbf
    
    List of Temporary Files
    =======================
    File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
    ---- -------- -------------------- ----------- --------------------
    1    20       TEMP                 32767       /u01/app/oracle/oradata/ORA19C/temp01.dbf
    
    ```
    
    ▶️ 백업 받기
    
    ```sql
    RMAN> report need backup;
    
    RMAN retention policy will be applied to the command
    RMAN retention policy is set to redundancy 1
    Report of files with less than 1 redundant backups
    File #bkps Name
    ---- ----- -----------------------------------------------------
    5    0     /u01/app/oracle/oradata/ORA19C/data_tbs01.dbf
    
    RMAN> backup datafile 5;
    
    ```
    
    ▶️ 백업 정보 확인
    
    ```sql
    RMAN> list backup of datafile 5;
    
    -- list backup of datafile '';
    -- list backup of tablespace 이름;
    
    List of Backup Sets
    ===================
    
    BS Key  Type LV Size       Device Type Elapsed Time Completion Time
    ------- ---- -- ---------- ----------- ------------ ---------------
    21      Full    1.09M      DISK        00:00:00     31-JUL-25
            BP Key: 21   Status: AVAILABLE  Compressed: NO  Tag: TAG20250731T163742
            Piece Name: /u01/app/oracle/fast_recovery_area/ORA19C/backupset/2025_07_31/o1_mf_nnndf_TAG20250731T163742_n8p7b6k1_.bkp
            
      List of Datafiles in backup set 21
      File LV Type Ckp SCN    Ckp Time  Abs Fuz SCN Sparse Name
      ---- -- ---- ---------- --------- ----------- ------ ----
      5       Full 4531281    31-JUL-25              NO    /u01/app/oracle/oradata/ORA19C/data_tbs01.dbf
    
    ```
    
    ▶️ 장애 발생
    
    ```sql
    drop tablespace data_tbs including contents and datafiles;
    
    SYS@ora19c> select * from hr.loc_temp;
    select * from hr.loc_temp
                     *
    ERROR at line 1:
    ORA-00942: table or view does not exist
    
    RMAN> report schema;
    
    Report of database schema for database with db_unique_name ORA19C
    
    List of Permanent Datafiles
    ===========================
    File Size(MB) Tablespace           RB segs Datafile Name
    ---- -------- -------------------- ------- ------------------------
    1    920      SYSTEM               YES     /u01/app/oracle/oradata/ORA19C/system01.dbf
    3    730      SYSAUX               NO      /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
    4    340      UNDOTBS1             YES     /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
    7    5        USERS                NO      /u01/app/oracle/oradata/ORA19C/users01.dbf
    
    List of Temporary Files
    =======================
    File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
    ---- -------- -------------------- ----------- --------------------
    1    20       TEMP                 32767       /u01/app/oracle/oradata/ORA19C/temp01.dbf
    
    ```
    
    ▶️ 목표 시간
    
    ```sql
    -- list backup
    
    BS Key  Type LV Size       Device Type Elapsed Time Completion Time
    ------- ---- -- ---------- ----------- ------------ ---------------
    20      Full    10.30M     DISK        00:00:00     31-JUL-25
            BP Key: 20   Status: AVAILABLE  Compressed: NO  Tag: TAG20250731T153458
            Piece Name: **/u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_31/o1_mf_s_1207928098_n8p3nlmk_.bkp**
      SPFILE Included: Modification time: 31-JUL-25
      SPFILE db_unique_name: ORA19C
      Control File Included: Ckp SCN: 4520771      Ckp time: 31-JUL-25
    
    BS Key  Type LV Size       Device Type Elapsed Time Completion Time
    ------- ---- -- ---------- ----------- ------------ ---------------
    21      Full    1.09M      DISK        00:00:00     31-JUL-25
            BP Key: 21   Status: AVAILABLE  Compressed: NO  Tag: TAG20250731T163742
            Piece Name: /u01/app/oracle/fast_recovery_area/ORA19C/backupset/2025_07_31/o1_mf_nnndf_TAG20250731T163742_n8p7b6k1_.bkp
      List of Datafiles in backup set 21
      File LV Type Ckp SCN    Ckp Time  Abs Fuz SCN Sparse Name
      ---- -- ---- ---------- --------- ----------- ------ ----
      5       Full 4531281    31-JUL-25              NO
    
    BS Key  Type LV Size       Device Type Elapsed Time Completion Time
    ------- ---- -- ---------- ----------- ------------ ---------------
    22      Full    10.30M     DISK        00:00:00     31-JUL-25
            BP Key: 22   Status: AVAILABLE  Compressed: NO  Tag: TAG20250731T163743
            Piece Name: /u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_31/o1_mf_s_1207931863_n8p7b7ok_.bkp
      SPFILE Included: Modification time: 31-JUL-25
      SPFILE db_unique_name: ORA19C
      Control File Included: Ckp SCN: 4531290      Ckp time: 31-JUL-25
    
    ```
    
    ▶️ alert.log 확인, 목표 시간 : 2025-07-31 16:42:10
    
    ▶️ DB 내리기
    
    ```sql
    shutdown immediate;
    ```
    
    ▶️ startup
    
    ```sql
    startup nomount;
    ```
    
    ▶️ restore
    
    ```sql
    restore controlfile from '**/u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_31/o1_mf_s_1207928098_n8p3nlmk_.bkp**';
    
      
    ```
    
    ▶️ mount
    
    ```sql
    alter database mount;
    ```
    
    ▶️ 복구
    
    ```sql
    rman;
    alter session set nls_date_format='yyyy-mm-dd hh24:mi:ss';
    select sysdate from dual;
    
    run {
    	set until time '2025-07-31 16:42:10';
    	restore database;
    	recover database;
    	alter database open resetlogs;
    }
    
    report schema;
    ```
    
    ▶️ 결국 불완전 복구했음
    
    ▶️ 백업 완료
    
    ```sql
    -- 아카이브 정보
    /*
    /home/oracle/arch1/arch_1_1_1207934646_.arc	4520750	4521899
    /home/oracle/arch2/arch_1_1_1207934646_.arc	4520750	4521899
    
    마지막 체크포인트 : 4521899
    */
    
    --> 수동으로 아카이브 로그 지울때 멋대로 지우지 말 것.
    ```