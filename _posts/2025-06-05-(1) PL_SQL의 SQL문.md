---
title: "[32ÏùºÏ∞®] PL/SQLÏùò SQLÎ¨∏"
excerpt: "ÏïÑÏù¥Ìã∞Ïúå 0605_(1) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-05T19:18
---


# PL/SQLÏùò SQLÎ¨∏

‚ñ∂Ô∏è **PL/SQLÏùò SQLÎ¨∏**

- SELECT Î¨∏ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê ÏûàÎäî Îç∞Ïù¥ÌÑ∞Î•º Í≤ÄÏÉâÌïúÎã§.
- DMLÎ¨∏ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê ÏûàÎäî Îç∞Ïù¥ÌÑ∞Î•º ÏàòÏ†ï, ÏÇ≠Ï†ú, ÏûÖÎ†•ÌïúÎã§.
- COMMIT, ROLLBACK, SAVEPOINTÎ¨∏ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ìä∏ÎûúÏû≠ÏÖòÏùÑ Ï†úÏñ¥ÌïúÎã§.

‚Üí Dynamic SQL ÏÇ¨Ïö© 

### **SQL CURSOR(Ïª§ÏÑú)**

CURSOR: SQLÎ¨∏ Ïã§Ìñâ Î©îÎ™®Î¶¨ ÏòÅÏó≠ 

(server processÏùò PGA(Program Global Area) ‚Üí UGA(User Global Area) Ïïà Î©îÎ™®Î¶¨ÏïàÏóê Îì§Ïñ¥ÏûàÎã§. parse,bind, execute, fetch )

üå≥ Í∑∏ÎûòÏÑú CURSORÍ∞Ä Î¨¥Ïä® Ïó≠Ìï†ÏùÑ ÌïòÎäîÍ∞Ä?

**SQLÎ¨∏ÏùÑ Î©îÎ™®Î¶¨Ïóê Ïò¨Î†§ÎëêÍ≥†, Ïã§ÌñâÌïòÍ≥†, Í≤∞Í≥ºÎ•º Ï∂îÏ†ÅÌïúÎã§.**

**parse,bind, execute, fetchÎ•º ÏàòÌñâÌïúÎã§.**

üìç `SELECT` Î¨∏ÏùÑ ÎçòÏßÄÎ©¥ user process (SQL Developer - Client Ï™Ω) Í∞Ä server process(SQL Ï≤òÎ¶¨Í∏∞)ÏóêÍ≤å Ïù¥Î•º Ï†ÑÎã¨Ìï¥Ï§ÄÎã§. server processÎäî Ïù¥Î•º Î∞õÏïÑ parse(syntax check, symentic check) ‚Üí  bind (ÏûÖÎ†•Í∞í ÏûÖÎ†•) ‚Üí execute ‚Üí fetch ( Ïã§Ìñâ Ï∞ΩÏóê Î≥¥Ïó¨Ï£ºÍ∏∞) Î•º ÏàòÌñâÌïúÎã§. 

üå≥ **CURSOR Ï¢ÖÎ•ò**

‚û° **implicit cursor(ÏïîÏãúÏ†Å Ïª§ÏÑú)** 

‚û° **explicit cursor(Î™ÖÏãúÏ†Å Ïª§ÏÑú)**

**implicit cursor(ÏïîÏãúÏ†Å Ïª§ÏÑú)** 

üìå  **ÏÜçÏÑ±**

- **sql%rowcount** : **Í∞ÄÏû• ÏµúÍ∑ºÏùò DMLÎ¨∏**Ïóê ÏùòÌï¥ ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏùò ÏàòÎ•º Î¶¨ÌÑ¥ÌïòÎäî ÏÜçÏÑ±, Ï†ïÏàòÍ∞í
- **sql%found** : **Í∞ÄÏû• ÏµúÍ∑ºÏùò DMLÎ¨∏**Ïóê ÏùòÌï¥ ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏù¥ ÏûàÏúºÎ©¥ true ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏù¥ ÏóÜÏúºÎ©¥ falseÎ°ú ÌèâÍ∞ÄÎêòÎäî bool ÏÜçÏÑ±
- **sql%notfound** : **Í∞ÄÏû• ÏµúÍ∑ºÏùò DMLÎ¨∏**Ïóê ÏùòÌï¥ ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏù¥ ÏóÜÏúºÎ©¥ true ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏù¥ ÏûàÏúºÎ©¥ falseÎ°ú ÌèâÍ∞ÄÎêòÎäî bool ÏÜçÏÑ±

‚ñ∂Ô∏è SELECT INTO Ï†àÏóê ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÏùÄ ÏùòÎØ∏ ÏóÜÎäî ÌñâÏúÑÏù¥Îã§.

üå≥ **sql%rowcount**

```sql
-- ÌÖåÏù¥Î∏î ÏÉùÏÑ±
DROP TABLE hr.test PURGE;

CREATE TABLE hr.test(
    id number,
    name varchar2(30),
    day date
)
TABLESPACE USERS;

-- ÏòÅÌñ•ÏùÑ Î∞õÏùÄ ÌñâÏù¥ ÏûàÏúºÎ©¥ Ï∂úÎ†•.
BEGIN
	INSERT INTO hr.test(id, name, day) 
	SELECT employee_id, last_name, hire_date FROM hr.employees;
    dbms_output.put_line(sql%rowcount||'ÌñâÏù¥ ÏûÖÎ†•ÎêòÏóàÏäµÎãàÎã§.');
END;
/

-- 107ÌñâÏù¥ ÏûÖÎ†•ÎêòÏóàÏäµÎãàÎã§.
```

 

üìå **Î¨∏Î≤ï**

- Ïò§ÎùºÌÅ¥ ÏÑúÎ≤ÑÍ∞Ä SQLÎ¨∏(SELECT, DML)  Ï≤òÎ¶¨ÌïòÍ∏∞ ÏúÑÌï¥ ÎÇ¥Î∂ÄÏ†ÅÏúºÎ°ú Ïª§ÏÑúÎ•º ÏÉùÏÑ±ÌïòÍ≥† Í¥ÄÎ¶¨ÌïúÎã§.

```sql
SELECT .. INTO .. 
```

‚ñ∂Ô∏è INTOÏ†àÏùÄ FETCHÏ†àÏù¥Îã§.  PL/ SQLÎ¨∏ÏóêÏÑú SELECT Î¨∏ÏùÑ ÏÇ¨Ïö©Ìï† Îïå INTO Ï†à Ïì∞ÏßÄ ÏïäÏúºÎ©¥ Ïò§Î•òÎÇúÎã§.

```sql
BEGIN    
SELECT last_name, first_name, salary
FROM hr.employees
WHERE employee_id = 100;
END;
/

-- Ïò§Î•ò Î∞úÏÉù
```

‚ñ∂Ô∏è SELECT .. INTO

- INTOÏ†àÏù¥ FETCHÏ†àÏù¥Îã§.
- Î∞òÎìúÏãú 1Í∞ú ÌñâÎßå fetchÌï¥Ïïº ÌïúÎã§.
    - 0Í∞ú : **NO_DATA_FOUND, ORA-01403 : no data found**
    - 2Í∞ú Ïù¥ÏÉÅ : **TOO_MANY_ROWS, ORA-01422: exact fetch returns more than requested number of rows**

```sql
-- ÌîÑÎ°úÍ∑∏Îû® ÏïàÏóêÏÑúÎäî Î≥ÄÏàòÏóê Ï†ÄÏû•ÌïòÏó¨ Î≥¥ÎÇ¥Ïïº ÌïúÎã§.
-- INTO Ï†à: FETCH Ï†à
-- Ïª§ÏÑú ÏÉùÏÑ±ÏùÑ Ïò§ÎùºÌÅ¥Ïù¥ ÏïåÏïÑÏÑú Ìï¥Ï§ò.

DECLARE
    v_lname varchar2(30);
    v_fname varchar2(30);
    v_sal number;
BEGIN
    SELECT last_name, first_name, salary
    INTO **v_lname, v_fname, v_sal**    -- Î≥ÄÏàò ÏÑ†Ïñ∏ ( ÌÖåÏù¥Î∏îÏùò Ïª¨ÎüºÍ≥º ÌÉÄÏûÖ ÏùºÏπòÌï¥Ïïº Ìï®)
    FROM hr.employees
    WHERE employee_id = 100;
    dbms_output.put_line(v_lname||' '||v_fname||' '||v_sal);
END;
/

-- King Steven 24000

-- Ï°∞ÌöåÎêòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ (0) Ïò§Î•ò Î∞úÏÉùÌï®.
DECLARE
    v_lname varchar2(30);
    v_fname varchar2(30);
    v_sal number;
BEGIN
    SELECT last_name, first_name, salary
    INTO v_lname, v_fname, v_sal
    FROM hr.employees
    WHERE department_id = 5;
    dbms_output.put_line(v_lname||' '||v_fname||' '||v_sal);
END;
/

-- Ï°∞ÌöåÎêòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä 2Í∞ú Ïù¥ÏÉÅÏù¥Î©¥ Ïò§Î•ò Î∞úÏÉùÌï®.

DECLARE
    v_lname varchar2(30);
    v_fname varchar2(30);
    v_sal number;
BEGIN
    SELECT last_name, first_name, salary
    INTO v_lname, v_fname, v_sal
    FROM hr.employees
    WHERE department_id = 50;
    dbms_output.put_line(v_lname||' '||v_fname||' '||v_sal);
END;
/

--> Ïù¥Îü¥ Í≤ΩÏö∞ÏóêÎäî Ïñ¥Îñ§ ÏãùÏúºÎ°ú ÏÇ¨Ïö©ÌïòÏó¨Ïïº Ìï†Íπå?
```

üå≥ PL / SQLÏùò SELECTÎ¨∏Ïû•Ïù¥ 0Í∞ú ÌòπÏùÄ 2Í∞ú Ïù¥ÏÉÅÏùò ÌñâÏùÑ Î∞òÌôòÌï† Îïå, Ïò§Î•òÎ•º ÏùºÏúºÌÇ®Îã§.

Ïù¥ Í≤ΩÏö∞ Ìï¥Í≤∞ Î∞©Î≤ïÏùÄ

1Ô∏è‚É£ **EXCEPTION Ï≤òÎ¶¨**

üå≥ `NO_DATA_FOUND`  :  SELECT .. INTO.. Î¨∏ÏóêÏÑú Ï°∞Ìöå Í≤∞Í≥ºÍ∞Ä 0 rowÏùº Îïå Î∞úÏÉùÌïòÎäî ÌëúÏ§Ä ÏòàÏô∏

üå≥ `TOO_MANY_ROWS` :  Ï°∞Ìöå Í≤∞Í≥ºÍ∞Ä 2Í∞ú Ïù¥ÏÉÅÏùò ÌñâÏùÑ Î∞òÌôòÌï† Îïå Î∞úÏÉùÌïòÎäî ÌëúÏ§Ä ÏòàÏô∏

```sql
-- Ïù¥Î†áÍ≤å ÏÇ¨Ïö©ÌïúÎã§.
DECLARE
    v_lname varchar2(30);
    v_fname varchar2(30);
    v_sal number;
BEGIN
    SELECT last_name, first_name, salary
    INTO v_lname, v_fname, v_sal
    FROM hr.employees
    WHERE department_id = 5;
    dbms_output.put_line(v_lname||' '||v_fname||' '||v_sal);
    
EXCEPTION
	WHEN NO_DATA_FOUND THEN 
		dbms_output.put_line('Ï°∞Í±¥Ïóê ÎßûÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
END;
/

-- Ï°∞Í±¥Ïóê ÎßûÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§
```

2Ô∏è‚É£ `CURSOR` ÎòêÎäî `SELECT ... BULK COLLECT` Ïù¥Ïö©

3Ô∏è‚É£ WHERE ROWNUM = 1 Î∂ôÏù¥Îäî Ìé∏Î≤ïÎèÑ ÏûàÎã§Í≥† Ìï®. üò≠

‚ñ∂Ô∏è %type

- ÌÖåÏù¥Î∏îÎ™Ö.Ïª¨ÎüºÏù¥Î¶Ñ%type : ÌÖåÏù¥Î∏î Ïª¨ÎüºÏùò Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖÍ≥º ÏÇ¨Ïù¥Ï¶àÎ•º ÏÇ¨Ïö©ÌïòÍ≤†Îã§.
- Î≥ÄÏàò%type : Î≥ÄÏàòÏùò ÌÉÄÏûÖÍ≥º ÏÇ¨Ïù¥Ï¶àÎ•º ÏÇ¨Ïö©ÌïòÍ≤†Îã§.

```sql
--Ïª¨ÎüºÍ≥º Î≥ÄÏàòÍ∞Ä ÌÉÄÏûÖÏù¥ ÏùºÏπòÌï¥Ïïº ÌïúÎã§.
--ÌÖåÏù¥Î∏îÏóê ÏûàÎäî Ïª¨ÎüºÏùò ÌÉÄÏûÖÍ≥º ÏÇ¨Ïù¥Ï¶àÏóê Îî∞Îùº Î∞îÎÄåÎèÑÎ°ù DECLAREÏ†à Î≥ÄÏàò ÏÑ†Ïñ∏

DECLARE
    v_lname employees.last_name%type;
    v_fname v_lname%type;
    v_sal employees.salary%type;;
BEGIN
    SELECT last_name, first_name, salary
    INTO v_lname, v_fname, v_sal
    FROM hr.employees
    WHERE employee_id = :b_id;
    dbms_output.put_line(v_lname||' '||v_fname||' '||v_sal);
END;
/
```

‚ñ∂Ô∏è Í∑∏Î£π Ìï®Ïàò (PL/SQLÏùò SQLÎ¨∏ÏóêÏÑúÎäî Í∑∏Î£π Ìï®Ïàò ÏÇ¨Ïö© Í∞ÄÎä•)

```sql
DECLARE 
    v_avg number;
BEGIN
    SELECT avg(salary)
    INTO v_avg
    FROM hr.employees;
    dbms_output.put_line('Ï†ÑÏ≤¥ ÏÇ¨ÏõêÏùò ÌèâÍ∑† Í∏âÏó¨ : '||round(v_avg));
END;
/

SELECT *
FROM hr.employees
WHERE salary > v_avg; --Ïò§Î•ò Î∞úÏÉù v_avg Î≥ÄÏàòÎäî local Î≥ÄÏàòÏù¥Í∏∞ ÎïåÎ¨∏Ïóê ÌîÑÎ°úÍ∑∏Îû® Î∞îÍπ•Ï™ΩÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÎã§.

--> ÌîÑÎ°úÍ∑∏Îû® Î∞îÍπ•Ï™ΩÏóêÏÑú Î≥ÄÏàò ÏÇ¨Ïö©ÌïòÎ†§Í≥† ÌïúÎã§Î©¥
--> **SQL PLUS**ÏóêÏÑú Î∞îÏù∏Îìú Î≥ÄÏàò Ï≤òÎ¶¨Ìï¥Ïïº ÌïúÎã§.

var b_avg number

BEGIN
    SELECT avg(salary)
    INTO :b_avg
    FROM hr.employees;
    dbms_output.put_line('Ï†ÑÏ≤¥ ÏÇ¨ÏõêÏùò ÌèâÍ∑† Í∏âÏó¨ : '||round(:b_avg));
END;
/

SELECT *
FROM hr.employees
WHERE salary > v_avg; 
```

‚û° **DML(insert, update, delete, merge)**

‚Üí Ìä∏ÎûúÏû≠ÏÖòÏùÑ Ï†úÏñ¥ÌïòÎäî commit,rollback, savepoint

```sql
-- ÌÖåÏù¥Î∏î Ï†úÍ±∞
DROP TABLE hr.test PURGE;

-- 
CREATE TABLE hr.test(id number,name varchar2(30), day date) TABLESPACE users;

-- 
INSERT INTO hr.test(id,name,day) VALUES(1,'ÌôçÍ∏∏Îèô',sysdate);

SELECT * FROM hr.test;

ROLLBACK;

BEGIN
	INSERT INTO hr.test(id,name,day) VALUES(1,'ÌôçÍ∏∏Îèô', sysdate);
	-- COMMIT;  
	-- ROLLBACK;
	-- Îì± Ìä∏Îû≠Ïû≠ÏÖòÏùÑ Ï†úÏñ¥ÌïòÎäî TCL ÌïÑÏöî
END;
/

SELECT * FROM hr.test;

ROLLBACK;
```

‚ñ∂Ô∏è ÏûÖÎ†• Î≥ÄÏàò Ï≤òÎ¶¨ : bind Î≥ÄÏàò Ï≤òÎ¶¨

```sql
-- SQL DeveloperÏóêÏÑú Ïò§Î•ò
BEGIN
	INSERT INTO hr.test(id,name,day) VALUES(:b_id, :b_name, :b_day);
END;
/
```

```sql
-- SQL PLUS 
SQL> conn hr/hr
Connected.

SQL> set serveroutput on
SQL> var b_id number
SQL> var b_name varchar2(30)
SQL> var b_day varchar2(30);
SQL> execute :b_id := 1
SQL> execute :b_name := 'ÌôçÍ∏∏Îèô'
 execute :b_date := sysdate

SQL>BEGIN
	   INSERT INTO hr.test(id,name,day) VALUES(:b_id, :b_name, :b_day);
    END;
    /    
```

‚ñ∂Ô∏è Î∞îÏù∏Îìú Î≥ÄÏàòÎ°ú ÎÇ†Ïßú ÌÉÄÏûÖ ÏûÖÎ†•ÌïòÎäî Î∞©Î≤ï

```sql
SQL> var b_id number := 1;
SQL> var b_name := 'ÌôçÍ∏∏Îèô';
SQL> var b_day := '2005-06-05');

SQL>BEGIN
	   INSERT INTO hr.test(id,name,day) VALUES(:b_id, :b_name, to_date(:b_day, 'yyyy-mm-dd'));;
    END;
    / 
 
```

‚ñ∂Ô∏è INSERT ÏÑúÎ∏åÏøºÎ¶¨ 

```sql
BEGIN
	INSERT INTO hr.test(id, name, day) 
	SELECT employee_id, last_name, hire_date FROM hr.employees;
END;
/
```

‚ñ∂Ô∏è DELETE 

```sql
BEGIN
    DELETE FROM hr.test WHERE day < to_date('2000-01-01', 'yyyy-mm-dd');
    IF sql%found THEN
        dbms_output.put_line(sql%rowcount||'Í∞ú ÌñâÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    ELSE
        dbms_output.put_line('Îç∞Ïù¥ÌÑ∞Í∞Ä Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
    END IF;
    dbms_output.put_line(sql%rowcount||'Í∞ú ÌñâÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    ROLLBACK;
END;
/
```