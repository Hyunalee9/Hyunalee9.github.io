---
title: "ROLE_ì •ë¦¬(1)"
excerpt: "ì•„ì´í‹°ìœŒ 0707_(3)"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-07T18:01
---


- ê´€ë ¨ì„±ì´ ìžˆëŠ” ê¶Œí•œë“¤ì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬í•˜ëŠ” ê°ì²´ì´ë‹¤.
- ê´€ë¦¬ì˜ íŽ¸ë¦¬ì„±

ex) í”„ë¡œê·¸ëž˜ë¨¸ë“¤ì—ê²Œ ë¶€ì—¬í•  ì‹œìŠ¤í…œ ê¶Œí•œ

```sql
CREATE SESSION
CREATE PROCEDURE
CREATE TRIGGER
CREATE VIEW
```

â–¶ï¸ **role ì‹¤ìŠµ**

```sql
-- ë¡¤ ìƒì„±
CREATE role prog;
SELECT * FROM dba_roles WHERE role = 'PROG';

-- ë¡¤ì— ì‹œìŠ¤í…œ ê¶Œí•œ ë¶€ì—¬
GRANT create session, create procedure, create trigger, create view to prog;
SELECT * FROM dba_sys_privs WHERE GRANTEE = 'PROG';

-- ë¡¤ì— ê°ì²´ ê¶Œí•œ ë¶€ì—¬
GRANT SELECT ON hr.departments TO prog;
SELECT * FROM dba_tab_privs WHERE grantee = 'PROG';

-- ë¡¤ì„ ìœ ì €í•œí…Œ ë¶€ì—¬
GRANT prog TO insa;

-- insaì—ê²Œ ì–´ë–¤ ë¡¤ì´ ë¶€ì—¬ëëŠ”ì§€.
SELECT * FROM dba_role_privs WHERE grantee = 'INSA';

GRAN PRIVILEGE                                ADM COM INH
---- ---------------------------------------- --- --- ---
PROG CREATE VIEW                              NO  NO  NO 
PROG CREATE PROCEDURE                         NO  NO  NO 
PROG CREATE SESSION                           NO  NO  NO 
PROG CREATE TRIGGER                           NO  NO  NO 

â–¶ï¸ insa session
-- ë‹¤ì‹œ ì„¸ì…˜ì— ì ‘ì†í•˜ë©´ ì ìš© 
SELECT * FROM session_roles;

```

â–¶ï¸ **ì‹¤ìŠµ 2**

```sql
â–¶ï¸ sys session
create role mgr;
grant select any table to mgr;
grant mgr to insa;
select * from dba_role_privs where grantee = 'INSA';

â–¶ï¸ insa session
select * from session_roles;
select count(*) from user_tab_privs;

create role mgr;
grant select any table to mgr;
grant mgr to insa;
select * from dba_role_privs where grantee = 'INSA';

alter user insa default role all except mgr;

â–¶ï¸ insa session
select * from user_tab_privs;
select * from role_tab_privs;
select * from session_roles;

â–¶ï¸ sys session
ðŸ“ insa ìœ ì €ì—ê²Œ ë¶€ì—¬í•œ ë¡¤ ì „ë¶€ë¥¼ default roleì—ì„œ ì œì™¸ 

-- insa ìœ ì €ì—ê²Œ ë¶€ì—¬ëœ ëª¨ë“  ë¡¤ì„ progëž€ ë¡¤ë§Œ ë¹¼ê³  ëª¨ë‘ default roleë¡œ ë§Œë“¤ìž.
alter user insa default role all except prog;

â–¶ï¸ insa session
INSA@ora19c> select * from session_roles;

ROLE
--------------------------------------------------------------------------------
MGR

INSA@ora19c> select count(*) from hr.locations;

  COUNT(*)
----------
        23
        
â–¶ï¸ sys session

alter user insa default role all;
select * from dba_role_privs where grantee = 'INSA';        

                                             -------------------- ê°ì²´ ê¶Œí•œë„ í•„
INSA@ora19c> create or replace view emp_view as select * from hr.employees;  
             ------ ë·° ìƒì„±í•˜ë ¤ë©´ CREATE VIEW ê¶Œí•œ í•„ìš”

View created.

INSA@ora19c> select count(*) from emp_view;

  COUNT(*)
----------
       107

â–¶ï¸ sys session

-- mgr ë¡¤ì„ íšŒìˆ˜
revoke mgr from insa;

select * from dba_role_privs WHERE grantee = 'INSA';

â–¶ï¸ insa session
INSA@ora19c> conn insa/oracle -- ìž¬ì ‘ì†
Connected.
INSA@ora19c> select count(*) from hr.locations;
select count(*) from hr.locations
                        *
ERROR at line 1:
ORA-00942: table or view does not exist   -- ê¶Œí•œì„ íšŒìˆ˜í•´ì„œ ì¡°íšŒì•ˆëœë‹¤.

â–¶ï¸ sys session
revoke select on hr.employees from insa;

â–¶ï¸ insa session
INSA@ora19c> select * from emp_view;
select * from emp_view
              *
ERROR at line 1:
ORA-04063: view "INSA.EMP_VIEW" has errors

INSA@ora19c> select text from user_views where view_name = 'EMP_VIEW';

TEXT
--------------------------------------------------------------------------------
select "EMPLOYEE_ID","FIRST_NAME","LAST_NAME","EMAIL","PHONE_NUMBER","HIRE_DATE"

â–¶ï¸ sys session

-- ë‹¤ì‹œ ë¡¤ ë¶€
grant mgr to insa;

select * from dba_role_privs where grantee = 'INSA';

-- ë³¸ì¸ì´ ì†Œìœ í•˜ì§€ ì•Šì€ ê°ì²´ì— ëŒ€í•œ ë³„ë„ì˜ ê°ì²´ ê¶Œí•œì´ í•„ìš”í•˜ë‹¤.
INSA@ora19c> conn insa/oracle
Connected.
INSA@ora19c> select * from emp_view;
select * from emp_view
              *
ERROR at line 1:
ORA-04063: view "INSA.EMP_VIEW" has errors

-- ì§ì ‘ ì¡°íšŒ ê¶Œí•œ ë¶€ì—¬
grant  select on hr.departments to insa;

```

```sql
â–¶ï¸ sys session
revoke mgr from insa;

â–¶ï¸ insa session
select * from user_tab_privs;

â–¶ï¸ sys session

create or replace view dept_new as select * from hr.departments;  

-- ë¡¤ ì§ì ‘ ê¶Œí•œ ë¶€ì—¬
grant select any table to insa;

â–¶ï¸ insa session
select * from user_sys_privs;

â–¶ï¸ sys session
create or replace view dept_new as select * from hr.departments;  

revoke select any table from insa;

grant select on hr.departments to insa;

select * from dba_tab_privs where grantee = 'INSA'
```

ðŸ“view ìƒì„±ì‹œ ì£¼ì˜í•  ì  subqueryì— ëŒ€í•´ì„œëŠ” ì§ì ‘ ê°ì²´ ê¶Œí•œì´ í•„ìš”í•˜ë‹¤.

select any table ì‹œìŠ¤í…œ ê¶Œí•œì„ ì§ì ‘ ë°›ì€ ê¶Œí•œ ìžˆì–´ì•¼ í•œë‹¤.

ë¡¤ì„ í†µí•´ì„œ ë°›ì€ ê°ì²´ ê¶Œí•œì„ ì´ìš©í•  ìˆ˜ëŠ” ì—†ë‹¤.

ë¡¤ì„ í†µí•´ì„œ ë°›ì€ select any table ì‹œìŠ¤í…œ ê¶Œí•œì„ ì´ìš©í•  ìˆ˜ëŠ” ì—†ë‹¤.

- **gptê°€ ì •ë¦¬í•´ì¤€ role**
    
    # ðŸ“Œ ROLE (ë¡¤) ì´ëž€?
    
    ðŸ‘‰ **ROLE = ê¶Œí•œ ë¬¶ìŒ**
    
    ðŸ‘‰ ì—¬ëŸ¬ ê°œì˜ **ê¶Œí•œ(Privileges)** ì„ í•˜ë‚˜ì˜ **ë¬¶ìŒ**ìœ¼ë¡œ ë§Œë“¤ì–´ â†’ ì‚¬ìš©ìžì—ê²Œ ì‰½ê²Œ **ì¼ê´„ ë¶€ì—¬/íšŒìˆ˜**í•  ìˆ˜ ìžˆê²Œ í•´ì£¼ëŠ” ê²ƒ.
    
    ---
    
    ## âœ… 1. ì™œ ROLEì„ ì“¸ê¹Œ? (í•„ìš”ì„±)
    
    | ë°©ë²• | íŠ¹ì§• | ë¬¸ì œì  |
    | --- | --- | --- |
    | ê¶Œí•œì„ ìœ ì €ì— ì§ì ‘ ë¶€ì—¬ | ìœ ì €ë§ˆë‹¤ GRANT | ì—¬ëŸ¬ ëª…ì—ê²Œ ê¶Œí•œ ì¶”ê°€/ì‚­ì œ ì‹œ â†’ ì¼ì¼ì´ ìˆ˜ì •í•´ì•¼ í•¨ |
    | ROLEë¡œ ê¶Œí•œ ë¬¶ê¸° | ROLEì— ê¶Œí•œ GRANT â†’ ROLEë§Œ ì‚¬ìš©ìžì—ê²Œ ë¶€ì—¬ | ìœ ì—°í•˜ê³ , ê´€ë¦¬ê°€ ì‰½ë‹¤ |
    
    ---
    
    ## âœ… 2. ROLE ìƒì„±ê³¼ ì‚¬ìš© íë¦„
    
    ### ðŸ“„ (1) ROLE ìƒì„±
    
    ```sql
    CREATE ROLE prog
    ```
    
    ### ðŸ“„ (2) ROLEì— ê¶Œí•œ ì¶”ê°€
    
    ```sql
    GRANT CREATE SESSION, CREATE TABLE TO prog;
    ```
    
    ### ðŸ“„ (3) ROLEì„ ì‚¬ìš©ìžì—ê²Œ ë¶€ì—¬
    
    ```sql
    GRANT prog TO insa;
    ```
    
    â†’ `insa` ì‚¬ìš©ìžëŠ” `prog` ROLEì´ ê°€ì§„ ëª¨ë“  ê¶Œí•œ ì‚¬ìš© ê°€ëŠ¥
    
    ---
    
    ## âœ… 3. ROLEì˜ ì¢…ë¥˜
    
    | êµ¬ë¶„ | ì„¤ëª… |
    | --- | --- |
    | ì‚¬ìš©ìž ì •ì˜ ROLE | ì§ì ‘ ë§Œë“  ROLE (`CREATE ROLE`) |
    | ì‚¬ì „ ì •ì˜ëœ ROLE | Oracle ê¸°ë³¸ ì œê³µ ROLE (`DBA`, `CONNECT`, `RESOURCE` ë“±) |
    
    ---
    
    ## âœ… 4. ROLE í™œì„±í™” (SET ROLE)
    
    - ë¶€ì—¬ë°›ì€ ROLEì€ **ì„¸ì…˜ì—ì„œ í™œì„±í™”** ë˜ì–´ì•¼ ì‚¬ìš© ê°€ëŠ¥ (ë³´í†µ ìžë™ í™œì„±í™”ë¨)
    
    ```sql
    SET ROLE prog;
    SET ROLE ALL;
    SET ROLE NONE;
    ```
    
    ðŸ‘‰ `SESSION_ROLES` ë·°ì—ì„œ í˜„ìž¬ í™œì„±í™”ëœ ROLE í™•ì¸ ê°€ëŠ¥
    
    ---
    
    ## âœ… 5. WITH ADMIN OPTION vs WITH GRANT OPTION
    
    | ì˜µì…˜ | ì„¤ëª… |
    | --- | --- |
    | WITH ADMIN OPTION | ROLE ìžì²´ë¥¼ ë‹¤ë¥¸ ì‚¬ìš©ìžì—ê²Œ ë„˜ê²¨ì¤„ ìˆ˜ ìžˆìŒ |
    | WITH GRANT OPTION | í…Œì´ë¸”/ë·° ê°™ì€ **ê°ì²´ ê¶Œí•œ**ì„ ë‹¤ë¥¸ ì‚¬ìš©ìžì—ê²Œ ì¤„ ìˆ˜ ìžˆìŒ (ROLEì—ëŠ” ì ìš© ì•ˆ ë¨) |
    
    ðŸ‘‰ ROLE ë¶€ì—¬í•  ë• **WITH ADMIN OPTION** ë§Œ ì‚¬ìš© ê°€ëŠ¥.
    
    ---
    
    ## âœ… 6. ROLE ê¶Œí•œì˜ íŠ¹ì§• (ì¤‘ìš”)
    
    | í•­ëª© | ë‚´ìš© |
    | --- | --- |
    | ROLE ê¶Œí•œ íšŒìˆ˜ | `REVOKE role FROM user` í•˜ë©´ ROLE ê¶Œí•œ ëª¨ë‘ ì‚¬ë¼ì§ |
    | ì§ì ‘ ê¶Œí•œê³¼ì˜ ì°¨ì´ | **ì‹œìŠ¤í…œ ê¶Œí•œ ì¼ë¶€ëŠ” ROLEì„ í†µí•´ì„  ë¹„í™œì„±í™” ê°€ëŠ¥** (ì˜ˆ: PL/SQL ë¸”ë¡ ì•ˆ) |
    | ë¡¤ ì† ê¶Œí•œ í™•ì¸ | `SELECT * FROM ROLE_SYS_PRIVS WHERE ROLE = 'PROG';` |
    
    ---
    
    ## âœ… 7. ROLE ê¶Œí•œ í™•ì¸ ë·°
    
    | ë·° | ì„¤ëª… |
    | --- | --- |
    | `DBA_ROLES` | ROLE ëª©ë¡ |
    | `ROLE_SYS_PRIVS` | ROLEì— ë¶€ì—¬ëœ ì‹œìŠ¤í…œ ê¶Œí•œ |
    | `ROLE_TAB_PRIVS` | ROLEì— ë¶€ì—¬ëœ ê°ì²´ ê¶Œí•œ |
    | `SESSION_ROLES` | í˜„ìž¬ ì„¸ì…˜ì—ì„œ í™œì„±í™”ëœ ROLE |

â–¶ï¸ í”„ë¡œì‹œì €ë¡œ í•´ë³´ìž.

```sql
-- â–¶ï¸ SYS ì„¸ì…˜
-- insa ì‚¬ìš©ìžì—ê²Œ ë¶€ì—¬í•œ hr.departments í…Œì´ë¸”ì˜ SELECT ê¶Œí•œ íšŒìˆ˜
REVOKE SELECT ON hr.departments FROM insa;

-- â–¶ï¸ INSA ì„¸ì…˜ (ê¶Œí•œ í™•ì¸)

-- 1ï¸âƒ£ DBA_TAB_PRIVS: insaê°€ ì§ì ‘ ë¶€ì—¬ë°›ì€ ëª¨ë“  ê°ì²´ ê¶Œí•œ í™•ì¸ (ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆ í¬í•¨)
SELECT * FROM dba_tab_privs WHERE grantee = 'INSA';

-- 2ï¸âƒ£ USER_TAB_PRIVS: insa ìŠ¤í‚¤ë§ˆ ë‚´ì—ì„œ insaê°€ ê°€ì§„ ê°ì²´ ê¶Œí•œ í™•ì¸
SELECT * FROM user_tab_privs;

-- 3ï¸âƒ£ ROLE_TAB_PRIVS: insaê°€ ROLEì„ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ë¶€ì—¬ë°›ì€ ê°ì²´ ê¶Œí•œ í™•ì¸
SELECT * FROM role_tab_privs;

-- 4ï¸âƒ£ ROLE_SYS_PRIVS: insaê°€ ROLEì„ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ë°›ì€ ì‹œìŠ¤í…œ ê¶Œí•œ í™•ì¸
SELECT * FROM role_sys_privs;

-- 5ï¸âƒ£ USER_SYS_PRIVS: insaê°€ ì§ì ‘ ë¶€ì—¬ë°›ì€ ì‹œìŠ¤í…œ ê¶Œí•œ í™•ì¸
SELECT * FROM user_sys_privs;

-- ðŸ“ í”„ë¡œì‹œì € ë§Œë“¤ê¸°
-- â–¶ï¸ insa session
-- í”„ë¡œì‹œì € ìƒì„± ê¶Œí•œì€ ìžˆì§€ë§Œ í”„ë¡œì‹œì € ë‚´ë¶€ ê°ì²´ ê¶Œí•œì€ ì—†ì–´ì„œ ì•„ëž˜ SELECT ë¬¸ì„ ëŒë¦¬ë©´ ì˜¤ë¥˜ê°€ ë‚œë‹¤.

CREATE OR REPLACE PROCEDURE dept_proc(p_id IN number)
IS
	v_rec hr.departments%rowtype;
BEGIN	
	SELECT * 
	INTO v_rec
	FROM hr.departments
	WHERE department_id = p_id;
	
	dbms_output.put_line(v_rec.department_name);
EXCEPTION	
	WHEN NO_DATA_FOUND THEN
		raise_application_error(-20000, 'ë¶€ì„œëŠ” ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ');
END dept_pro;
/

-- â–¶ï¸ sys session

-- ì¸ì‚¬ ìœ ì €ì—ê²Œ ê°ì²´ ê¶Œí•œ ë¶€ì—¬
grant select on hr.departments to insa;

-- â–¶ï¸ insa session
CREATE OR REPLACE PROCEDURE dept_proc(p_id IN number)
IS
	v_rec hr.departments%rowtype;
BEGIN	
	SELECT * 
	INTO v_rec
	FROM hr.departments
	WHERE department_id = p_id;
	dbms_output.put_line(v_rec.department_name);
EXCEPTION	
	WHEN NO_DATA_FOUND THEN
		raise_application_error(-20000, 'ë¶€ì„œëŠ” ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ');
END dept_proc;
/

INSA@ora19c> set serveroutput on
INSA@ora19c> execute dept_proc(10)
Administration

PL/SQL procedure successfully completed.

â–¶ï¸ sys session
-- ê¶Œí•œ íšŒìˆ˜

revoke select on hr.departments from insa;

â–¶ï¸ insa session

INSA@ora19c> execute dept_proc(10)
BEGIN dept_proc(10); END;

      *
ERROR at line 1:
ORA-06550: line 1, column 7:
PLS-00905: object INSA.DEPT_PROC is invalid
ORA-06550: line 1, column 7:
PL/SQL: Statement ignored

```

ðŸ“ ì•”í˜¸í™”

```sql
â–¶ï¸ sys session

drop role mgr;

-- íŒ¨ìŠ¤ì›Œë“œë¥¼ ì„¤ì •í•˜ì—¬ ìƒì„±í•œ ë¡¤ì„ ìœ ì €ì—ê²Œ ë¶€ì—¬í–ˆì„ë•Œ default roleì—ì„œ ìžë™ìœ¼ë¡œ ì œì™¸ëœë‹¤.
create role mgr identified by oracle;
grant select any table to mgr;
grant mgr to insa;

select * from dba_role_privs where grantee = 'INSA';

GRANTEE   GRANTED_ROLE   ADM  DEL  DEF  COM  INH
--------  ------------   ---  ---  ---  ---  ---
INSA      PROG           NO   NO   YES  NO   NO
INSA      MGR            NO   NO   **NO**   NO   NO

--ë¡¤ì— ì„¤ì •ëœ íŒ¨ìŠ¤ì›Œë“œ í•´ì œ
alter role mgr not identified;

select * from dba_role_privs where grantee = 'INSA';
```

![image.png](/assets/20250707/2.png)

```sql
â–¶ï¸ insa session
INSA@ora19c> select * from session_roles;

ROLE
--------------------------------------------------------------------------------
PROG
MGR

â–¶ï¸ sys session
-- ê¸°ì¡´ ë¡¤ì„ íŒ¨ìŠ¤ì›Œë“œë¡œ ìˆ˜ì •í•˜ë©´ default roleì—ì„œ ì œì™¸ê°€ ëœë‹¤.

alter role mgr identified by oracle;
select * from dba_role_privs where grantee = 'INSA';
```

![image.png](/assets/20250707/3.png)

```sql
â–¶ï¸ insa session
conn insa/oracle
select * from session_roles;
select * from user_role_privs;

ROLE
--------------------------------------------------------------------------------
PROG

-- ë‹¤ë¥¸ ì†Œìœ ìžê°€ ê°€ì§„ ê°ì²´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ë‹¤.

-- ðŸ“ set ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì„œ role í™œì„±í™”
-- íŒ¨ìŠ¤ì›Œë“œ ìž…ë ¥í•´ì•¼í•¨
set role mgr  -- ì˜¤ë¥˜ 

set role mgr identified by oracle;

select * from user_role_privs;

+----------+-------------+-----+-----+-----+-----+-----+-----+
| USERNAME | GRANTED_ROLE| ADM | DEL | DEF | OS_ | COM | INH |
+----------+-------------+-----+-----+-----+-----+-----+-----+
| INSA     | MGR         | NO  | NO  | NO  | NO  | NO  | NO  |
| INSA     | PROG        | NO  | NO  | YES | NO  | NO  | NO  |
+----------+-------------+-----+-----+-----+-----+-----+-----+

INSA@ora19c> select count(*) from hr.locations;

  COUNT(*)
----------
        23

â–¶ï¸ íŒ¨ìŠ¤ì›Œë“œê°€ ì„¤ì •ëœ ë¡¤ì„ í™œì„±í™”
set role prog, mgr identified by oracle;
select * from session_roles;

ROLE
--------------------------------------------------------------------------------
MGR
PROG

â–¶ï¸ ë‚´ê°€ ë°›ì€ ë¡¤ ì „ë¶€ ë¹„í™œì„±í™”
set role none;

INSA@ora19c> select count(*) from hr.locations;
select count(*) from hr.locations;
*
ERROR at line 1:
ORA-00942: table or view does not exist

INSA@ora19c> select * from user_role_privs;

USERNAME   GRANTED_ROLE   ADM  DEL  DEF  OS_  COM  INH
---------  -------------  ---  ---  ---  ---  ---  ---
INSA       MGR            NO   NO   NO   NO   NO   NO
INSA       PROG           NO   NO   YES  NO   NO   NO

INSA@ora19c> select * from role_sys_privs;

ROLE   PRIVILEGE           ADM  COM  INH
-----  ------------------  ---  ---  ---
PROG   CREATE VIEW         NO   NO   NO
PROG   CREATE SESSION      NO   NO   NO
PROG   CREATE TRIGGER      NO   NO   NO
MGR    SELECT ANY TABLE    NO   NO   NO
PROG   CREATE PROCEDURE    NO   NO   NO

INSA@ora19c> select * from role_tab_privs;

ROLE   OWNER   TABLE_NAME   COLUMN_NAME   PRIVILEGE
-----  ------  -----------  ------------  ---------
PROG   HR      DEPARTMENTS                 SELECT

â–¶ï¸ ë‚´ê°€ ë°›ì€ ë¡¤ ì „ë¶€ í™œì„±í™” í•˜ë˜ mgr ë¡¤ì€ ì œì™¸í•œë‹¤.
set role all except mgr;
select * from session_roles;

INSA@ora19c> select * from session_roles;

ROLE
--------------------------------------------------------------------------------
PROG

CREATE OR REPLACE FUNCTION today
RETURN varchar2
IS
BEGIN
	RETURN to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss');
END today;
/

INSA@ora19c> select today from dual;

TODAY
--------------------------------------------------------------------------------
2025-07-07 17:10:41

# sys session
SYS@ora19c> alter role mgr not identified;

Role altered.

SYS@ora19c> select * from dba_role_privs where grantee = 'INSA';

GRANTEE  GRANTED_ROLE  ADM  DEL  DEF  COM  INH
-------- ------------- ---  ---  ---  ---  ---
INSA     PROG          NO   NO   YES  NO   NO
INSA     MGR           NO   NO   YES  NO   NO

# insa session
INSA@ora19c> select * from session_roles;

ROLE
-----
PROG
MGR

```