---
title: "[29ì¼ì°¨] ì œì•½ ì¡°ê±´ í™œì„±í™”/ë¹„í™œì„±í™”"
excerpt: "ì•„ì´í‹°ìœŒ 0530_(2) disable validate, disable novalidate, enable validate, enable novalidate "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-05-30T20:10
---

# ì œì•½ ì¡°ê±´ í™œì„±í™”/ë¹„í™œì„±í™”

â¡ í…Œì´ë¸” ìƒì„± 

```sql
-- í…Œì´ë¸” ì œê±°
DROP TABLE hr.test PURGE;

-- í…Œì´ë¸” ìƒì„±
CREATE TABLE hr.test(
    id NUMBER CONSTRAINT test_id_pk PRIMARY KEY,
    sal NUMBER CONSTRAINT sal_ck CHECK(sal >= 1000  AND sal <= 3000)
)

-- ì¡°íšŒ    
SELECT * FROM hr.test;
SELECT * FROM user_constraints WHERE table_name = 'TEST';

-- ë°ì´í„° ì§‘ì–´ë„£ê¸°
insert into hr.test(id,sal) values(1,2000); 

SELECT * FROM hr.test;
```

â¡ ì¶”ê°€ë¡œ ë°ì´í„° ì§‘ì–´ë„£ìœ¼ë ¤ í–ˆì§€ë§Œ, ê°ê° pk, ck ìœ„ë°˜ë˜ì–´ ì˜¤ë¥˜ ë°œìƒ

```sql
--ORA-00001: unique constraint (HR.TEST_ID_PK) violated
--ë¬´ê²°ì„± ì œì•½ì¡°ê±´ì— ìœ„ë°°ë©ë‹ˆë‹¤. 
---- ì˜¤ë¥˜ë°œìƒ primary key ì œì•½ì¡°ê±´ ìœ„ë°˜
insert into hr.test(id,sal) values(1,3000); 
--ORA-02290: check constraint (HR.SAL_CK) violated
--check ì œì•½ì¡°ê±´ì— ìœ„ë°°ë©ë‹ˆë‹¤.
-- ì˜¤ë¥˜ë°œìƒ check ì œì•½ ì¡°ê±´ ìœ„ë°˜
insert into hr.test(id,sal) values(2,20001);
```

### â¡ **ë°ì´í„° ì…ë ¥ ìœ„í•´ ì œì•½ì¡°ê±´ì„ ë¹„í™œì„±í™”**

### 1ï¸âƒ£ **DISABLE VALIDATE : DML ì‘ì—…ì„ ë¶ˆí—ˆ**

ğŸ“Œ ì œì•½ì¡°ê±´ì€ êº¼ì ¸ ìˆëŠ”ë°, ê¸°ì¡´ ë°ì´í„°ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ëŠ” ì‚´ì•„ìˆì–´ ì¡°ê±´ ìœ„ë°˜ëœ **ë°ì´í„°ëŠ” I, U, Dì•ˆë¨**

ğŸ“Œ **primary key, unique ì œì•½ ì¡°ê±´ì„ ë¹„í™œì„±í™”ë¥¼ ìˆ˜í–‰**í•˜ê²Œ ë˜ë©´ **unique indexëŠ” ìë™ìœ¼ë¡œ ì‚­ì œ**ëœë‹¤.

```sql
ALTER TABLE hr.test DISABLE VALIDATE CONSTRAINT test_id_pk;

-- í™•ì¸ 
SELECT * FROM user_constraints WHERE table_name = 'TEST';

--**unique indexëŠ” ìë™ìœ¼ë¡œ ì‚­ì œ**
SELECT * FROM user_indexes WHERE table_name = 'TEST';

-- DML í—ˆìš©í•˜ì§€ ì•ŠìŒ
-- ORA-25128: No insert/update/delete on table with constraint (HR.TEST_ID_PK) disabled and validated
insert into hr.test(id,sal) values(1,3000); 
```

![image.png](/assets/20250530/10.png)

### 2ï¸âƒ£ **disable novalidate(disableì˜ ê¸°ë³¸ê°’) : ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ ì•„ì˜ˆ í•˜ì§€ ì•ŠìŒ**

```sql
ALTER TABLE hr.test DISABLE CONSTRAINT test_id_pk;
ALTER TABLE hr.test DISABLE CONSTRAINT sal_ck;

-- ë°ì´í„° ë„£ì–´ì§. **ë¬´ê²°ì„± ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.**
insert into hr.test(id,sal) values(1,3000); 
insert into hr.test(id,sal) values(2,20001);
```

![image.png](/assets/20250530/11.png)

### 3ï¸âƒ£ **ë™ì‹œì— ì—¬ëŸ¬ ì œì•½ì¡°ê±´ ë¹„í™œì„±í™”**

```sql
ALTER TABLE hr.test DISABLE ALL CONSTRAINTS;
```

### â¡ í™œì„±í™”

### 1ï¸âƒ£ ENABLE VALIDATE(ENABLE ê¸°ë³¸ê°’)

ğŸ“Œ ì œì•½ì¡°ê±´ì„ ê²€ì‚¬í•˜ë©°, ê¸°ì¡´ ë°ì´í„°ë„ ê²€ì¦í•¨ 

ğŸ“Œ **primary key, unique ì œì•½ì¡°ê±´ì„ enableí•˜ê²Œ ë˜ë©´ unique indexê°€ ìƒì„±ëœë‹¤.**

```sql
-- ê¸°ì¡´ ë°ì´í„°ì— ëŒ€í•´ì„œ ì œì•½ ì¡°ê±´ì„ ì²´í¬í•œ í›„ ë¬¸ì œë˜ëŠ” ë°ì´í„°ê°€ ìˆì–´ì„œ í™œì„±í™”ê°€ ì•ˆëœë‹¤.
-- DDL ë¬¸ì¥ ì‹¤í–‰í–ˆê¸°ë•Œë¬¸ì— ìë™ COMMIT ë˜ì—ˆê¸°ë•Œë¬¸ì— ROLLBACKë„ ì•ˆë¨.
ALTER TABLE hr.test ENABLE CONSTRAINT test_id_pk;
ALTER TABLE hr.test ENABLE CONSTRAINT sal_ck;
```

### 2ï¸âƒ£ ENABLE NOVALIDATE : ê¸°ì¡´ ë°ì´í„°ì— ëŒ€í•´ì„œëŠ” ì œì•½ì¡°ê±´ ê²€ì¦í•˜ì§€ ë§ê³  ìƒˆë¡­ê²Œ ì…ë ¥ë˜ëŠ” ë°ì´í„°ì— ëŒ€í•´ì„œ ì œì•½ì¡°ê±´ ì²´í¬

```sql
-- pk - no validate ì„±ê²©ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ì—†ë‹¤.
-- ORA-02437: cannot validate (HR.TEST_ID_PK) - primary key violated
-- ì˜¤ë¥˜
ALTER TABLE hr.test ENABLE NOVALIDATE CONSTRAINT tesT_id_pk; 

-- check - no validate ì„±ê²©ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.
-- check ì œì•½ì¡°ê±´ í™œì„±í™” 
ALTER TABLE hr.test ENABLE NOVALIDATE CONSTRAINT sal_ck;
SELECT * FROM user_constraints WHERE table_name = 'TEST'

-- ì˜¤ë¥˜ ë°œìƒ check ì œì•½ì¡°ê±´ ìœ„ë°˜ 
--ORA-02290: check constraint (HR.SAL_CK) violated
insert into hr.test(id,sal) values(3,600); 
```

![image.png](/assets/20250530/12.png)

### â¡ ë¬¸ì œë˜ëŠ” ë°ì´í„° ì°¾ê¸°

```sql
-- ê°€ì¥ ë¹¨ë¦¬ ë°ì´í„° ì°¾ì•„ê°€ëŠ” ë°©ë²• : rowid ë¡œ ì°¾ì•„ê°€ê¸° 
-- rowid ì¡°íšŒ
SELECT rowid, id, sal FROM hr.test;

-- ë¬¸ì œë˜ëŠ” rowë“¤ì„ ì €ì¥í•´ì„œ fatchí•˜ëŠ” í…Œì´ë¸” ê²½ë¡œ 
-- C:\oraclexe\app\oracle\product\11.2.0\server\rdbms\admin  -> utlexpt1

create table exceptions(row_id urowid,
	                owner varchar2(30),
	                table_name varchar2(30),
		        constraint varchar2(30));

-- shell í”„ë¡œê·¸ë¨ -> SQL PLUS
-- @C:\oraclexe\app\oracle\product\11.2.0\server\rdbms\admin\utlexpt1.sql
-- SQL Developerì—ì„œëŠ” ì•ˆë¨.
```

![image.png](/assets/20250530/13.png)

![image.png](/assets/20250530/14.png)

```sql
-- ì´ ë¬¸ì¥ ìˆ˜í–‰í•˜ë©´ ì˜¤ë¥˜ë‚˜ë©´ì„œ exceptions í…Œì´ë¸”ì— ìœ„ë°˜ëœ ë°ì´í„°ê°€ ì €ì¥ë¨
ALTER TABLE hr.test ENABLE CONSTRAINT test_id_pk EXCEPTIONS INTO exceptions;

-- PKì— ìœ„ë°˜ëœ rowë“¤ ì €ì¥.
SELECT * FROM exceptions;

-- ë¬¸ì œë˜ëŠ” ë°ì´í„°ë“¤
SELECT *
FROM hr.test
WHERE rowid IN(select row_id from exceptions);
```

![image.png](/assets/20250530/15.png)

```sql
-- ë¬¸ì œê°€ ë˜ëŠ” row ìˆ˜ì •í•˜ëŠ” ë°©ë²•
UPDATE hr.test
SET id = 5
WHERE rowid = 'AAAE+SAAEAAAAF1AAB';

SELECT * FROM hr.test;

TRUNCATE TABLE exceptions;

COMMIT;

-- ck ìœ„ë°˜ ë°ì´í„° ìˆ˜ì •
ALTER TABLE hr.test ENABLE CONSTRAINT sal_ck EXCEPTIONS INTO exceptions;

SELECT * FROM exceptions;

UPDATE hr.test
SET sal = 1500
WHERE rowid = 'AAAE+SAAEAAAAF1AAC';

SELECT * FROM hr.test;

TRUNCATE TABLE exceptions;

COMMIT;
```

![image.png](/assets/20250530/16.png)

### â¡ ì œì•½ì¡°ê±´ ENABLE

```sql
ALTER TABLE hr.test ENABLE CONSTRAINT test_id_pk;
ALTER TABLE hr.test ENABLE CONSTRAINT sal_ck;

-- í™•ì¸ 
SELECT * FROM user_constraints WHERE table_name = 'TEST';

--**unique indexê°€ ìƒì„±**
SELECT * FROM user_indexes WHERE table_name = 'TEST';
```

![image.png](/assets/20250530/17.png)

```sql
-- í…Œì´ë¸” ì‚­ì œ
DROP TABLE hr.test CASCADE CONSTRAINTS PURGE;
```