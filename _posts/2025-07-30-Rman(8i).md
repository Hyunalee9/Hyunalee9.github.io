---
title: "[67ì¼ì°¨] RMAN(8i) "
excerpt: "ì•„ì´í‹°ìœŒ 0730"
categories:
      - ORACLE19c
tags:
      - ORACLE19c
      - TIL
last-modified-at: 2025-07-30T21:08
---

# RMAN(8i)

## Recovery Manager

- RMANì€ ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°±ì—…, ë³µêµ¬ ì‘ì—…ì„ ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ì˜¤ë¼í´ ìœ í‹¸ë¦¬í‹°ì´ë‹¤.
- RMANì€ ìš´ì˜ì²´ì œì—ì„œ **ë…ë¦½ì ì¸ ëª…ë ¹ ì–¸ì–´ë¥¼ ì‚¬ìš©**í•œë‹¤.

```bash
-- ë…ë¦½í˜• ëª…ë ¹ (stand alone)
backup database;

-- ì‘ì—…í˜• ëª…ë ¹ (ì—¬ëŸ¬ ê°œì˜ ëª…ë ¹ì–´ë¥¼ í•œë²ˆì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•)
run{
	allocate channel ch1 type disk
	format ...
	
	...
}
```

- RMAN RepositoryëŠ” target databaseì™€ backup, recovery ì‘ì—…ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°ì´ë‹¤. repositoryëŠ” í•­ìƒ target databaseì˜ control fileì— ì €ì¥ëœë‹¤.

**ë”°ë¡œ ì •ë¦¬í•œ RMANì˜ ì£¼ìš” íŠ¹ì§•**

1ï¸âƒ£ **ìì£¼ ì‹¤í–‰í•˜ëŠ” ì‘ì—…ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì €ì¥**

- RMAN Recovery Catalog Serverë¥¼ ì‚¬ìš©í•  ê²½ìš° ìì£¼ ì‚¬ìš©í•˜ëŠ” ë°±ì—… ëª…ë ¹ì–´ë“¤ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì €ì¥í•œ í›„ ë¶ˆëŸ¬ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

2ï¸âƒ£ **ì¦ë¶„ ë¸”ë¡ ë ˆë²¨ ë°±ì—… ê¸°ëŠ¥ ì§€ì›**

- ê³¼ê±°ì— ë°±ì—… ë°›ì€ ë‚´ì—­ì„ ì¡°ì‚¬í•´ ê·¸ ê¸°ì¤€ ë°±ì—… ì´í›„ì— ë³€ê²½ëœ ë¸”ë¡ë§Œì°¾ì•„ ë°±ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ë°±ì—… ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆë‹¤.

3ï¸âƒ£ **ì‚¬ìš©ë˜ì§€ ì•Šì€ ë¸”ë¡ ê±´ë„ˆë›°ê³  ë°±ì—… ìˆ˜í–‰** 

- ì „ì²´ ë°ì´í„° íŒŒì¼ì´ 100m ë¼ í•˜ë”ë¼ë„ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ìš©ëŸ‰ì€ ì•„ì£¼ ì‘ì„ ìˆ˜ ìˆë‹¤. ì´ ì¤‘ í˜„ì¬ ì‚¬ìš©í•˜ê³  ìˆëŠ” ë¸”ë¡ë§Œ ì°¾ì•„ ë°±ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

4ï¸âƒ£ ë°±ì—… ìˆ˜í–‰ ì¤‘ í›¼ì†ëœ ë¸”ë¡ ê°ì§€

- ë°±ì—… ìˆ˜í–‰ ë„ì¤‘ì— í›¼ì†ëœ ë¸”ë¡ì„ ê°ì§€í•˜ì—¬ ë§ˆí‚¹í•´ ë‘ê³  ê³„ì† ë°±ì—…ì„ ì§„í–‰í•œë‹¤.

5ï¸âƒ£ ASM ê¸°ë°˜ ìœ ì¼í•œ ë°±ì—… ë„êµ¬

6ï¸âƒ£ ë°±ì—… ìˆ˜í–‰ ì‹œ ì••ì¶• ì§€ì› 

## â˜‘ï¸ êµ¬ì„±ë„

![image.png](/assets/20250730/1.png)

â­ RMAN ë°±ì—…, ë³µêµ¬ ëª…ë ¹ â†’ RMAN ëŒ€ìƒ ì„œë²„ (target db) ì— ì ‘ì†í•˜ì—¬ ë°±ì—…ì„ ìˆ˜í–‰. 

â†’ Recovery Catalog Serverê°€ ìˆìœ¼ë©´ ë°±ì—… ê´€ë ¨ ì •ë³´ë¥¼ **Catalog db**ì— ì €ì¥. ì—†ìœ¼ë©´ target db ì˜ **ì»¨íŠ¸ë¡¤ íŒŒì¼**ì— ê¸°ë¡

## â˜‘ï¸ RMAN ë°±ì—… ì¢…ë¥˜

1ï¸âƒ£ backupsetìœ¼ë¡œ ë°±ì—… ìˆ˜í–‰ (ê¸°ë³¸)

ğŸ“ RMANì—ì„œ ë°±ì—…ì„ ìˆ˜í–‰í•˜ë©´ ë°±ì—… ì…‹(ë…¼ë¦¬ì ì¸ ë©ì–´ë¦¬) ìœ¼ë¡œ ë°›ëŠ”ë‹¤. ì‹¤ì œë¡œëŠ” ë°±ì—… í”¼ìŠ¤ë¡œ ì €ì¥ëœë‹¤.

â–¶ï¸ Backup Set 

- ê°ê° í•˜ë‚˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì˜ ë°±ì—…ì„ í¬í•¨í•˜ëŠ” ë°±ì—… í”¼ìŠ¤ (backup piece)ë¼ê³  í•˜ëŠ” íŒŒì¼ì˜ ëª¨ìŒì´ë‹¤.
- ë°ì´í„° íŒŒì¼, ì»¨íŠ¸ë¡¤ íŒŒì¼, ì„œë²„ íŒŒë¼ë¯¸í„° íŒŒì¼, ì•„ì¹´ì´ë¸Œ íŒŒì¼ í¬í•¨ëœ í•˜ë‚˜ ì´ìƒì˜ binary file(ë°±ì—… í”¼ìŠ¤) ëª¨ìŒì´ë‹¤.
- Backup Setì„ ì‚¬ìš©í•˜ë©´ ë¹ˆ ë°ì´í„° ë¸”ë¡ì´ ì €ì¥ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë°±ì—…ì…‹ì—ì„œ ì†Œëª¨í•˜ëŠ” ë””ìŠ¤í¬ë‚˜ í…Œì´í”„ ê³µê°„ì´ ì¤„ì–´ë“ ë‹¤.
- ë°±ì—…ì…‹ì„ ì••ì¶•í•˜ë©´ ë°±ì—…ì— í•„ìš”í•œ ê³µê°„ì„ ë” ì¤„ì¼ ìˆ˜ ìˆë‹¤.

2ï¸âƒ£ image copyë¡œ ë°±ì—… ìˆ˜í–‰

- ì´ ë°©ë²•ì€ ì‚¬ìš©ì¤‘ì¸ ë¸”ë¡ë§Œ ë°±ì—… ë°›ëŠ” ê¸°ëŠ¥ì´ë‚˜ ì¦ë¶„ ë°±ì—… ë°›ëŠ” ê¸°ëŠ¥ ë“± ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.

## â˜‘ï¸ RMAN ë°±ì—…ì‹œ ì£¼ì˜ ì‚¬í•­

- open ìƒíƒœì—ì„œ ë°±ì—…ì„ ë°›ìœ¼ë ¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ **archive log mode**ë¡œ ìš´ì˜ë˜ì–´ì•¼ í•œë‹¤.
- DBëŠ” **mount ë˜ëŠ” open** ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.
- ìš´ì˜ ì¤‘ì¸ ì˜¨ë¼ì¸ ë¦¬ë‘ ë¡œê·¸ íŒŒì¼ì€ ë°±ì—…ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

```bash
alter system archive log current; -> ìš”ê²ƒì€? 
```

- ë…¸ ì•„ì¹´ì´ë¸Œ ëª¨ë“œì—ì„œëŠ” clean ë°±ì—…ë§Œ ì‚¬ìš© ê°€ëŠ¥

## â˜‘ï¸ ìš©ì–´ ì •ë¦¬

ğŸ“ **control_file_record_keep_time** : ë°±ì—… ì •ë³´ê°€ ê²¹ì³ì“°ì´ê¸° ì „ê¹Œì§€ ì €ì¥ë˜ëŠ” ìµœì†Œ ë‚ ì§œìˆ˜ë¥¼ ê²°ì •í•˜ëŠ” íŒŒë¼ë¯¸í„°

```sql
show parameter control_file_record_keep_time
-- 7ì¼ 

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
control_file_record_keep_time        integer     7

```

ğŸ“ **control file ë‚´ìš©**

- ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„, ìƒì„±ëœ ì‹œê°„
- ì²´í¬í¬ì¸íŠ¸
- **ë°ì´í„° íŒŒì¼, ë¦¬ë‘ ë¡œê·¸ íŒŒì¼, ì•„ì¹´ì´ë¸Œ íŒŒì¼**
- í˜„ì¬ log sequence number
- ë°±ì—… ì •ë³´(ìœ ì €ê°€ ì§ì ‘ ì˜¨ë¼ì¸ ë°±ì—… ìˆ˜í–‰)
- RMAN repository

ğŸ“ **ë°±ì—… ìœ„ì¹˜**

- ë””ìŠ¤í¬ ë””ë ‰í† ë¦¬
- media management library (í…Œì´í”„ ì¥ì¹˜) â†’ ë¬´ì¡°ê±´ RMAN
- fast recovery area (flash recovery area)
    - RMANì—ì„œ ë°±ì—…ê³¼ ë³µêµ¬ ë° flashback database ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë””ìŠ¤í¬ ì˜ì—­
    - íŒŒì¼ì€ í•„ìš”ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë³´ê´€ ë° ì‚­ì œëœë‹¤.
    - **control file ë‹¤ì¤‘í™”ëœ ë³µì‚¬ë³¸**
    - **redo log file ë‹¤ì¤‘í™”ëœ ë³µì‚¬ë³¸**
    - **ì•„ì¹´ì´ë¸Œëœ redo log**
    - fast recovery areaì˜ ì‚¬ìš©ëœ ê³µê°„ì´ 85% warning alert ì´ ë°œìƒí•˜ê³  97%ì— ë„ë‹¬í•˜ë©´ critical alertì´ ë°œìƒí•œë‹¤. (alert logì— ê¸°ë¡ëœë‹¤.)
    
    ```sql
    select * from dba_outstanding_alerts;
    show parameter db_recovery_file_dest
    
    NAME                                 TYPE        VALUE
    ------------------------------------ ----------- ------------------------------
    db_recovery_file_dest                string      /u01/app/oracle/fast_recovery_
                                                     area
    db_recovery_file_dest_size           big integer 8256M
    
    select * from v$flash_recovery_area_usage;
    
    /*
    CONTROL FILE  	0	0	0	0
    REDO LOG	      0	0	0	0
    ARCHIVED LOG	  1.62	0	3	0
    BACKUP PIECE	  0.37	0	3	0
    IMAGE COPY	    0	0	0	0
    FLASHBACK LOG	  0	0	0	0
    FOREIGN ARCHIVED LOG	0	0	0	0
    AUXILIARY DATAFILE COPY	0	0	0	0
    
    */
    ```
    
    ğŸ“ PERCENT_SPACE_USED : ì‚¬ìš©ì¤‘ì¸ recovery area ë°±ë¶„ìœ¨
    
    ğŸ“ PERCENT_SPACE_RECLAIMABLE : íšŒìˆ˜ ê°€ëŠ¥í•œ recovery area ë°±ë¶„ìœ¨
    
    ğŸ“ NUMBER_OF_FILES : recovery area íŒŒì¼ì˜ ìˆ˜
    
    ```sql
    select * from v$recovery_file_dest;
    
    NAME
    --------------------------------------------------------------------------------
    SPACE_LIMIT SPACE_USED SPACE_RECLAIMABLE NUMBER_OF_FILES     CON_ID
    ----------- ---------- ----------------- --------------- ----------
    /u01/app/oracle/fast_recovery_area
     8657043456  172130816                 0               6          0
    ```
    

â–¶ï¸ RMAN ì ‘ì†

```sql
[oracle@oracle ~]$ rman target /

Recovery Manager: Release 19.0.0.0.0 - Production on Wed Jul 30 10:23:20 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: ORA19C (DBID=**1258537005**) -- DB_IDê°’ ì¤‘ìš”í•˜ë‹¤.

-- RMANì—ì„œë„ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

RMAN> select dbid, name, log_mode from v$database;

using target database control file instead of recovery catalog
      DBID NAME      LOG_MODE
---------- --------- ------------
1258537005 ORA19C    ARCHIVELOG

select file_id, tablespace_name, file_name, bytes/1024/1024 mb from dba_data_files;

 FILE_ID TABLESPACE_NAME
---------- ------------------------------
FILE_NAME
--------------------------------------------------------------------------------
        MB
----------
         1 SYSTEM
/u01/app/oracle/oradata/ORA19C/system01.dbf
       920

         3 SYSAUX
/u01/app/oracle/oradata/ORA19C/sysaux01.dbf
       700

         7 USERS
/u01/app/oracle/oradata/ORA19C/users01.dbf
         5

         4 UNDOTBS1
/u01/app/oracle/oradata/ORA19C/undotbs01.dbf
       340

-- í˜„ì¬ DBì˜ temp íŒŒì¼ê³¼ ë°ì´í„° íŒŒì¼ í™•ì¸
RMAN> report schema;

/*
List of Permanent Datafiles    
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    920      SYSTEM               YES     /u01/app/oracle/oradata/ORA19C/system01.dbf
3    700      SYSAUX               NO      /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
4    340      UNDOTBS1             YES     /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
7    5        USERS                NO      /u01/app/oracle/oradata/ORA19C/users01.dbf

List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    35       TEMP                 32767       /u01/app/oracle/oradata/ORA19C/temp01.dbf

ğŸ“ RB segs : ë¡¤ë°± ì„¸ê·¸ë¨¼íŠ¸ 
*/  

-- ë°±ì—… ì •ë³´

RMAN> select a.name, a.checkpoint_change#, b.status, b.change#, b.time
from v$datafile a, v$backup b
where a.file# = b.file#;

NAME
--------------------------------------------------------------------------------
CHECKPOINT_CHANGE# STATUS                CHANGE# TIME
------------------ ------------------ ---------- ---------

/u01/app/oracle/oradata/ORA19C/system01.dbf
           4192808 NOT ACTIVE            4063220 29-JUL-25

/u01/app/oracle/oradata/ORA19C/sysaux01.dbf
           4192808 NOT ACTIVE            4063220 29-JUL-25

/u01/app/oracle/oradata/ORA19C/undotbs01.dbf
           4192808 NOT ACTIVE            4063220 29-JUL-25

/u01/app/oracle/oradata/ORA19C/users01.dbf
           4192808 NOT ACTIVE            4063220 29-JUL-25

--> ì»¨íŠ¸ë¡¤ íŒŒì¼ì´ ê°€ì§€ê³  ìˆì—ˆë˜ ë°±ì—… ì •ë³´

-- RMANì—ì„œ ë°±ì—… ì •ë³´
list backup;

BS Key  Type LV Size       Device Type Elapsed Time Completion Time
------- ---- -- ---------- ----------- ------------ ---------------
1       Full    10.20M     DISK        00:00:00     28-JUL-25
        BP Key: 1   Status: AVAILABLE  Compressed: NO  Tag: TAG20250728T095849
        Piece Name: /u01/app/oracle/fast_recovery_area/ORA19C/autobackup/2025_07_28/o1_mf_s_1207648729_n8flt9rk_.bkp
  SPFILE Included: Modification time: 28-JUL-25
  SPFILE db_unique_name: ORA19C

```

â–¶ï¸ í˜„ì¬ configure ì •ë³´

```sql
show all;

RMAN configuration parameters for database with db_unique_name ORA19C are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
**CONFIGURE CONTROLFILE AUTOBACKUP ON; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default**
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u01/app/oracle/product/19.3.0/dbhome_1/dbs/snapcf_ora19c.f'; # default

```

ğŸ“ **control file ìë™ìœ¼ë¡œ ë°±ì—… ì„¤ì •**

â–¶ï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ê°€ ë³€ê²½ë  ë•Œ **ìë™ìœ¼ë¡œ control fileê³¼ spfileì´ ë°±ì—…ì´ ì§„í–‰**ëœë‹¤.

â¡ï¸ `backup database` ìˆ˜í–‰ ë•Œ ìë™ìœ¼ë¡œ control file, spfile ì¶”ê°€í•´ì¤Œ 

```sql
**CONFIGURE CONTROLFILE AUTOBACKUP ON; # default**
```

â–¶ï¸ control file ìë™ìœ¼ë¡œ ë°±ì—… ë¹„í™œì„±í™” ì„¤ì •

```sql
CONFIGURE CONTROLFILE AUTOBACKUP OFF;
```

â–¶ï¸ ìë™ ì»¨íŠ¸ë¡¤ íŒŒì¼ ë°±ì—… ìœ„ì¹˜(fast recovery area), ì´ë¦„ ì„¤ì •

```sql
**CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default**
```

- %F : c-DBID-YYYYMMDD-QQ
    - QQëŠ” 00ìœ¼ë¡œ ì‹œì‘í•˜ê³  ìµœëŒ€ê°’ì´ FFì¸ 16ì§„ìˆ˜ ì‹œí€€ìŠ¤
    - %F í¬ë§· ë¬¸ìëŠ” í•„ìˆ˜ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.

â–¶ï¸ ìë™ ì»¨íŠ¸ë¡¤ íŒŒì¼ ë°±ì—… ìœ„ì¹˜, ì´ë¦„ì„ ì„¤ì •

```sql
**CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/home/oracle/backup/rman/cf_%F';**
```

â–¶ï¸ configure ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •

```sql
**CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK CLEAR;**
```

â–¶ï¸ control file ë°±ì—…í•˜ê³  ìˆëŠ” ë„ì¤‘ì— control fileì˜ ë‚´ìš©ì´ ë³€ê²½ëœë‹¤ë©´ ë°±ì—… ì „ê³¼ ë°±ì—… í›„ì— ë‚´ìš©ì´ ë‹¬ë¼ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ê·¸ëŸ° ìƒí™©ì´ ë˜ë©´ ë°±ì—… ë°›ë˜ control file ì„ ìŠ¤ëƒ…ìƒ·ì„ ìƒì„±í•˜ê³  ë°±ì—… í›„ì— ë™ê¸°í™”ì‹œì¼œì„œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.

```sql
CONFIGURE SNAPSHOT CONTROLFILE NAME TO
'/u01/app/oracle/product/19.3.0/dbhome_1/dbs/snapcf_ora19c.f'; # default
```

â–¶ï¸ ìŠ¤ëƒ…ìƒ· ì €ì¥ ìœ„ì¹˜ ë³€ê²½

```sql
CONFIGURE SNAPSHOT CONTROLFILE NAME TO
'/home/oracle/backup/rman/snapcf_ora19c.f'; 
```

â–¶ï¸ ìŠ¤ëƒ¡ìƒ· ì €ì¥ ìœ„ì¹˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •

```sql
CONFIGURE SNAPSHOT CONTROLFILE NAME CLEAR;
```

â–¶ï¸ ë°±ì—…ì´ í•„ìš”í•œ íŒŒì¼

```sql
RMAN> report need backup;

RMAN retention policy will be applied to the command
RMAN retention policy is set to redundancy 1
Report of files with less than 1 redundant backups
File #bkps Name
---- ----- -----------------------------------------------------
1    0     /u01/app/oracle/oradata/ORA19C/system01.dbf
3    0     /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
4    0     /u01/app/oracle/oradata/ORA19C/undotbs01.dbf
7    0     /u01/app/oracle/oradata/ORA19C/users01.dbf

```

â–¶ï¸ ë°±ì—… ëŒ€ìƒ íŒŒì¼ ì°¾ì•„ì„œ ë°±ì—…í•˜ê¸° (ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ë¡œ ë°±ì—… ì§„í–‰)

```sql
RMAN> backup database;
```

â–¶ï¸ User managed recovery ì—ì„œëŠ” alter database begin backup ~ ë°ì´í„°íŒŒì¼ ë°±ì—… ~ end, ì»¨íŠ¸ë¡¤ íŒŒì¼, pfile ë°±ì—…ë°›ì•˜ë‹¤.

```sql
list backup;
```

â–¶ï¸ RMANì—ì„œ ì•„ì¹´ì´ë¸Œ ì •ë³´ ì €ì¥í•˜ê¸°

```sql
alter system archive log current;

-- ì•„ì¹´ì´ë¸Œëœ ëª¨ë“  ì •ë³´ ë³´ê¸°
list archivelog all;
```

## â˜‘ï¸ ì‹¤ìŠµ

- ğŸ“ non-system tabespace ë³µêµ¬1
    
    â–¶ï¸ ìƒˆë¡œìš´ í…Œì´ë¸” ìƒì„±
    
    ```sql
    create table hr.loc_new tablespace users as select * from hr.locations;
    alter system switch logfile;
    
    -- ë¡œê·¸ ì •ë³´
    SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
    FROM v$logfile a, v$log b
    WHERE a.group# = b.group#
    ORDER BY b.group#;
    
    -- ì•„ì¹´ì´ë¸Œ ì •ë³´
    select sequence#, name, first_change#, next_change# from v$archived_log;
    
    ! ls arch*
    
    SELECT f.tablespace_name, f.file_name
    FROM   dba_extents e,
           dba_data_files f
    WHERE  f.file_id = e.file_id
    AND    e.segment_name = 'LOC_NEW'
    AND    e.owner = 'HR';
    
    TABLESPACE_NAME  FILE_NAME
    ---------------  ---------------------------------------------
    USERS            /u01/app/oracle/oradata/ORA19C/users01.dbf
    ```
    
    â–¶ï¸ ì¥ì•  ë°œìƒ
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/users01.dbf
    ! ls /u01/app/oracle/oradata/ORA19C/users01.dbf
    
    select count(*) from hr.loc_new;
    alter system checkpoint;
    ```
    
    â–¶ï¸ í˜¹ì‹œ ëª¨ë¥´ë‹ˆê¹Œ ì €ì¥ ê³µê°„ ì •ë¦¬
    
    ```sql
    ! df -l
    ```
    
    â–¶ï¸ ì˜¤ë¥˜ ìœ ë„í•˜ê¸° ìœ„í•´ì„œ
    
    ```sql
    -- rmanì—ì„œ ë‚˜ê°€ê¸°
    exit
    -- ë‹¤ì‹œ ë“¤ì–´ê°€ê¸°
    rman target/
    
    ì˜¤ë¥˜ ë°œìƒ
    ```
    
    â–¶ï¸ ë¦¬ì»¤ë²„ í•„ìš”í•œ íŒŒì¼ í™•ì¸
    
    ```sql
    select * from v$recover_file;
    ```
    
    â–¶ï¸ ì¥ì•  ë°œìƒ ì •ë³´
    
    ```sql
    list failure;
    
    Failure ID | Priority | Status | Time Detected | Summary
    -----------+----------+--------+---------------+-------------------------------------------------
    22         | HIGH     | OPEN   | 18-JUL-25     | One or more non-system datafiles are missing
    148        | HIGH     | OPEN   | 17-JUL-25     | One or more non-system datafiles need media recovery
    
    list failure 22 detail;
    list failure 148 detail;
    ```
    
    â–¶ï¸ ë³µêµ¬
    
    ```sql
    **-- 12c**
    -- (1) í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ offline mode 
    alter tablespace users offline immediate;
    
    -- (2) ê°€ì¥ ìµœê·¼ì— ë°›ì•„ ë†“ì€ ë°±ì—…ë³¸ ì°¾ì•„ ë¦¬ìŠ¤íŠ¸í™”
    restore tablespace users;
    
    -- (3) ë¦¬ë‘ ì •ë³´ ì ìš©
    recover tablespace users;
    
    -- (3) onlineìœ¼ë¡œ ì˜¬ë¦¬ê¸°
    alter tablespace users online;
    ```
    
    â–¶ï¸ í™•ì¸
    
    ```sql
    list failure;
    report schema;
    ```
    
- ğŸ“ non-system tabespace ë³µêµ¬2
    
    â–¶ï¸ ìƒˆë¡œìš´ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ìƒì„±
    
    ```sql
    create tablespace insa_tbs datafile '/home/oracle/insa_tbs01.dbf' size 10m;
    
    -- SQL PLUSì—ì„œ 
    create hr.emp tablespace insa_tbs as select * from hr.employees;
    ```
    
    â–¶ï¸ ë°±ì—…ì´ í•„ìš”í•œ ëŒ€ìƒ ë°ì´í„° íŒŒì¼ ì²´í¬
    
    ```sql
    report need backup;
    ```
    
    â–¶ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ë°±ì—…
    
    ```sql
    -- backup database;
    ```
    
    â–¶ï¸ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ë ˆë²¨ ë°±ì—…
    
    ```sql
    -- backup tablespace insa_tbs;
    ```
    
    â–¶ï¸ datafile ë ˆë²¨ ë°±ì—…
    
    ```sql
    -- backup datafile 5;
    ```
    
    â–¶ï¸ ë°±ì—… í™•ì¸ ì ˆì°¨
    
    ```sql
    list backup;
    
    -- ë°±ì—… ëŒ€ìƒ í™•ì¸
    report need backup;
    
    -- íŠ¹ì •í•œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ë°±ì—…ë³¸ ì²´í¬
    list backup of tablespace insa_tbs;
    ```
    
    â–¶ï¸ íŠ¹ì •í•œ ë°ì´í„°íŒŒì¼ ë°±ì—…ë³¸ ì²´í¬
    
    ```sql
    list backup of datafile 5;
    list backup of datafile 'home/oracle/insa_tbs01.dbf';
    ```
    
    â–¶ï¸ ì¥ì•  ë°œìƒ
    
    ```sql
    ! rm /home/oracle/insa_tbs01.dbf
    ! ls /home/oracle/insa_tbs01.dbf
    
    -- ì˜¤ë¥˜ ìœ ë°œ
    rman > alter system checkpoint;
    ```
    
    â–¶ï¸ ì¬ì ‘ì†
    
    ```sql
    rman target/
    startup  
    select status from v$instance;
    
    Failure ID | Priority | Status | Time Detected | Summary
    -----------+----------+--------+---------------+-----------------------------------------
    22         | HIGH     | OPEN   | 30-JUL-25     | One or more non-system datafiles are missing
    
    select * from v$recover_file;
    report schema;
    ```
    
    â–¶ï¸ ë³µêµ¬
    
    ```sql
    -- (1) ë³µêµ¬ ìˆ˜í–‰í•´ì•¼ í•  ë°ì´í„° íŒŒì¼ offline
    alter database datafile 5 offline;
    -- (2) ë°ì´í„°ë² ì´ìŠ¤ open
    alter database open;
    select * from hr.emp_new;
    -- (3) restore
    restore datafile 5;
    -- (4) recover
    recover datafile 5;
    -- (5) online
    alter database datafile 5 online;
    ```
    
- ğŸ“ non-system tabespace ë³µêµ¬3
    
    ```sql
    ! rm /home/oracle/insa_tbs01.dbf
    alter system checkpoint;
    
    rman target /
    /* shutdown abort */
    startup
    
    --í•œë²ˆì— ìˆ˜í–‰ (ì‘ì—…í˜• ëª¨ë“œë¡œ ìˆ˜í–‰)
    run{
    select status from v$instance; -- mounted
    alter database datafile 5 offline;
    restore datafile 5;
    recover datafile 5;
    alter database datafile 5 online;
    }
    
    alter database open;
    
    ```
    
- ğŸ“ non-system tabespace ë³µêµ¬4
    
    ```sql
    ! rm /home/oracle/insa_tbs01.dbf
    ! ls /home/oracle/insa_tbs01.dbf
    
    alter system checkpoint;
    
    rman target /
    /* shutdown abort */
    startup
    
    -- ë³µêµ¬ í•„ìš” ëª©ë¡ ì¡°íšŒ
    list failure;
    
    -- ìƒˆë¡œìš´ ìœ„
    
    --í•œë²ˆì— ìˆ˜í–‰ (ì‘ì—…í˜• ëª¨ë“œë¡œ ìˆ˜í–‰)
    run{
    select status from v$instance; -- mounted
    alter database datafile 5 offline;
    restore datafile 5;
    recover datafile 5;
    alter database datafile 5 online;
    }
    
    alter database open;
    
    ```
    
    â–¶ï¸ ê¸°ì¡´ ë°ì´í„° íŒŒì¼ ìœ„ì¹˜ê°€ ì•„ë‹Œ ìƒˆë¡œìš´ ìœ„ì¹˜ì— ë³µêµ¬ ì‘ì—…
    
    ```sql
    /*
    1) ë°ì´í„° íŒŒì¼ offline 
    2) ìƒˆë¡œìš´ ìœ„ì¹˜ë¡œ íŒŒì¼ ë³µì‚¬
    3) alter database rename file 'ê¸°ì¡´ìœ„ì¹˜' to 'ìƒˆë¡œìš´ìœ„ì¹˜';
    4) recover
    5) ë°ì´í„°íŒŒì¼ online
    */
    
    -- â–¶ï¸ ì‘ì—…í˜•ìœ¼ë¡œ ì‘ì—…í•˜ê¸°
    run{
    alter database datafile 5 offline;
    set newname for datafile 5 to '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf';
    restore datafile 5;
    switch datafile 5;
    recover datafile 5;
    alter database datafil 5 online;
    }
    
    alter database open;
    report schema;
    ```
    
    â–¶ï¸ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ì‚­ì œ
    
    ```sql
    drop tablespace insa_tbs including contents and datafiles;
    ```
    
    â–¶ï¸ ì •ì±…ìƒ í•„ìš” ì—†ëŠ” ë°±ì—… ì •ë³´, ì•„ì¹´ì´ë¸Œ ì •ë³´ í™•ì¸
    
    ```sql
    report obsolete;
    ```
    
    â–¶ï¸ ì •ì±…ìƒ í•„ìš” ì—†ëŠ” ë°±ì—… ì •ë³´, ì•„ì¹´ì´ë¸Œ ì •ë³´ ì‚­ì œ
    
    ```sql
    RMAN> report obsolete;
    
    RMAN retention policy will be applied to the command
    RMAN retention policy is set to redundancy 1
    no obsolete backups found
    
    -- ì•„ì¹´ì´ë¸Œì— ëŒ€í•´ì„œëŠ” ë…¼ë¦¬ì ì´ê²Œ ì†Œìœ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ cross check
    crosscheck archivelog all;
    
    /*
    released channel: ORA_DISK_1
    allocated channel: ORA_DISK_1
    channel ORA_DISK_1: SID=19 device type=DISK
    validation succeeded for archived log
    archived log file name=/home/oracle/arch2/arch_1_38_1205348976_.arc RECID=41 STAMP=1207826605
    validation succeeded for archived log
    archived log file name=/home/oracle/arch1/arch_1_38_1205348976_.arc RECID=40 STAMP=1207826605
    Crosschecked 2 objects
    
    */
    ```
    
    â–¶ï¸ crosscheck í›„ ë¬¸ì œê°€ ë˜ëŠ” ì •ë³´ë¥¼ expired ëœ ì•„ì¹´ì´ë¸Œ íŒŒì¼ í™•ì¸
    
    ```sql
    list expired archivelog all;
    ```
    
    â–¶ï¸ expired ëœ ì•„ì¹´ì´ë¸Œ íŒŒì¼ ì‚­ì œ
    
    ```sql
    delete expired archivelog all;
    
    -- í™•ì¸
    report obsolete;
    ```
    
    â–¶ï¸ ë°±ì—… ì •ë³´ì— ëŒ€í•´ cross check
    
    ```sql
    crosscheck backup;
    ```
    
    â–¶ï¸ expired ëœ ë°±ì—… ì •ë³´
    
    ```sql
    list expired backup;
    ```
    
    â–¶ï¸ expired ëœ ë°±ì—… ì‚­ì œ
    
    ```sql
    delete expired backup;
    
    -- í™•ì¸
    report obsolete
    ```
    
    â–¶ï¸ image copy ë°±ì—…ë³¸ ì²´í¬
    
    ```sql
    crosscheck datafilecopy all;
    ```
    
    â–¶ï¸ image copy expired í™•ì¸
    
    ```sql
    list expired datafilecopy all;
    ```
    
    â–¶ï¸ 
    
    ```sql
    delete expired datafilecopy all;
    ```
    
- ğŸ“ system datafile ë³µêµ¬
    
    â–¶ï¸ ì¥ì•  ë°œìƒ
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/system01.dbf
    ```
    
    â–¶ï¸ ë³µêµ¬
    
    ```sql
    >RMAN
    
    list failure;
    list failure 5862 detail;
    
    -- 1) restore
    restore tablespace system;
    -- 2) recover
    recover datafile 1
    -- 3) ë°ì´í„°ë² ì´ìŠ¤ open 
    alter database open;
    ```
    
- ğŸ“ ëª¨ë“  datafile ë³µêµ¬
    
    â–¶ï¸ ì¥ì•  ë°œìƒ
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/*.dbf
    alter system checkpoint;
    startup
    list failure;
    list failure 5942 detail;
    list failure 22 detail;
    ```
    
    â–¶ï¸ ëª¨ë“  ë°ì´í„° íŒŒì¼ restore
    
    ```sql
    restore database;
    ```
    
    â–¶ï¸ recover
    
    ```sql
    recover database
    ```
    
    â–¶ï¸ ë°ì´í„°ë² ì´ìŠ¤ open
    
    ```sql
    alter database open;
    ```
    
- ğŸ“ ëª¨ë“  datafileì´ ìˆëŠ” ë””ìŠ¤í¬ ì†ìƒ ë³µêµ¬
    
    ğŸŒ³ **ê¸°ì¡´ ìœ„ì¹˜ :  /u01/app/oracle/oradata/ORA19C/*.dbf â†’ /home/oracle/oradata/*.dbf**
    
    ```sql
    
    SYS@ora19c> ! rm /u01/app/oracle/oradata/ORA19C/*.dbf
    
    RMAN> alter system checkpoint;
    
    # ê¸°ì¡´ ë°ì´í„°íŒŒì¼ ìœ„ì¹˜ê°€ ì•„ë‹Œ ìƒˆë¡œìš´ ìœ„ì¹˜ì— ë³µêµ¬ ì‘ì—…
    1) ë°ì´í„° íŒŒì¼ offline
    2) ìƒˆë¡œìš´ ìœ„ì¹˜ë¡œ íŒŒì¼ ë³µì‚¬
    3) alter database rename file 'ê¸°ì¡´ìœ„ì¹˜' to 'ìƒˆë¡œìš´ìœ„ì¹˜';
    4) recover
    5) ë°ì´í„°íŒŒì¼ online
    ```
    
    ![image.png](/assets/20250730/2.png)
    
    ```sql
    RMAN> run {
        set newname for datafile 1 to '/home/oracle/oradata/system01.dbf';
    		set newname for datafile 3 to '/home/oracle/oradata/sysaux01.dbf';
    		set newname for datafile 4 to '/home/oracle/oradata/undotbs01.dbf';
    		set newname for datafile 7 to '/home/oracle/oradata/users01.dbf';
    		set newname for datafile 1 to '/home/oracle/oradata/temp01.dbf';
        restore datafile ;
        switch datafile all;
    		switch tempfile all;
    			 recover datafile;
    		alter database open;
    }
    
    report schema;
    list backup;
    ```
    
    â–¶ï¸ ì›ë³µ   **/home/oracle/oradata/*.dbf  â†’ /u01/app/oracle/oradata/ORA19C/*.dbf** 
    
    ```sql
    RMAN> run {
        set newname for datafile 1 to '**/u01/app/oracle/oradata/ORA19C/**system01.dbf';
    		set newname for datafile 3 to '**/u01/app/oracle/oradata/ORA19C/**sysaux01.dbf';
    		set newname for datafile 4 to '**/u01/app/oracle/oradata/ORA19C/**undotbs01.dbf';
    		set newname for datafile 7 to '**/u01/app/oracle/oradata/ORA19C/**users01.dbf';
    		set newname for datafile 1 to '**/u01/app/oracle/oradata/ORA19C/**temp01.dbf';
        restore datafile ;
        switch datafile all;
    		switch tempfile all;
    			 recover datafile;
    		alter database open;
    }
    ```
    
- ğŸ“ ë°±ì—… ë°›ì§€ ì•Šì€ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ì— ì†í•œ ë°ì´í„° íŒŒì¼ ì†ìƒ ë³µêµ¬
    
    â–¶ï¸ ë°ì´í„° ìƒì„±
    
    ```sql
    create tablespace data_tbs datafile '/u01/app/oracle/oradata/ORA19C/data_tbs01.dbf' size 5m;
    create table hr.dept_new tablespace data_tbs as select * from hr.departments;
    select count(*) from hr.dept_new;
    
    -- ë¡œê·¸ ì •ë³´
    SELECT a.group#, b.sequence#, a.member, b.status, b.first_change#, b.first_time, b.next_change#, b.next_time
    FROM v$logfile a, v$log b
    WHERE a.group# = b.group#
    ORDER BY b.group#;
    
    -- ì•„ì¹´ì´ë¸Œ ì •ë³´
    select sequence#, name, first_change#, next_change# from v$archived_log;
    
    ```
    
    â–¶ï¸ ì¥ì•  ìœ ë°œ
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/data_tbs01.dbf
    report schema;
    list failure;
    list failure 6305 detail;
    ```
    
    ![image.png](/assets/20250730/3.png)
    
    â–¶ï¸ ë°±ì—…ë³¸ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°
    
    ```sql
    list backup of datafile 5;
    ```
    
    â–¶ï¸ ëŒ€ìƒ ë°ì´í„° íŒŒì¼ offline
    
    ```sql
    alter database datafile 5 offline;
    ```
    
    â–¶ï¸ ë¹ˆ ê»ë°ê¸° ë°ì´í„° íŒŒì¼ ìƒì„±
    
    ```sql
    alter database create datafile '/u01/app/oracle/oradata/ORA19C/data_tbs01.dbf';
    ```
    
    ğŸŒ³ ë˜ ë‹¤ë¥¸ ë°©ë²• : alter database create datafile â€˜ê¸°ì¡´ë°ì´í„°íŒŒì¼â€™ as â€˜ìƒˆë¡œìš´ë°ì´í„°íŒŒì¼â€™;
    
    â–¶ï¸ recover
    
    ```sql
    recover datafile 5;
    ```
    
    â–¶ï¸ ë°ì´í„°íŒŒì¼ online
    
    ```sql
    alter database datafile 5 online;
    
    -- í™•ì¸ : report schema;
    ```
    
    â–¶ï¸ ë°±ì—… í•„ìš”í•œ íŒŒì¼ ë°±ì—… ë°›ê¸°
    
    ```sql
    report need backup;
    backup datafile 5;
    list backup;
    ```
    
- ğŸ“ íŠ¹ì •í•œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ì— ì†í•œ ì—¬ëŸ¬ ë°ì´í„° íŒŒì¼ ì¤‘ ì¼ë¶€ ë°ì´í„° íŒŒì¼ ë³µêµ¬
    
    â–¶ï¸ ë°ì´í„° íŒŒì¼ ì¶”ê°€
    
    ```sql
    alter tablespace data_tbs add datafile '/u01/app/oracle/oradata/ORA19C/data_tbs02.dbf' size 5m;
    
    SELECT a.file#, b.name tbs_name, a.name file_name, a.status, a.checkpoint_change#
    FROM v$datafile a, v$tablespace b
    WHERE a.ts# = b.ts#;
    ```
    
    â–¶ï¸ í…Œì´ë¸” ìƒì„±
    
    ```sql
    create table hr.emp_2025 tablespace data_tbs as select * from hr.employees;
    ```
    
    â–¶ï¸ ëŒ€ëŸ‰ì˜ ë°ì´í„° ë‹´ê¸°
    
    ```sql
    insert into hr.emp_2025 select * from hr.emp_2025;
    
    SELECT f.tablespace_name,
           f.file_name,
           COUNT(*) 
    FROM   dba_extents e,
           dba_data_files f
    WHERE  f.file_id = e.file_id
      AND  e.segment_name = 'EMP_2025'
      AND  e.owner = 'HR'
    GROUP BY f.tablespace_name, f.file_name;
    
    /*
    TABLESPACE_NAME	FILE_NAME	ìµìŠ¤í…íŠ¸ ê°œìˆ˜   
    DATA_TBS	/u01/app/oracle/oradata/ORA19C/data_tbs01.dbf	16
    DATA_TBS	/u01/app/oracle/oradata/ORA19C/data_tbs02.dbf	2
    */
    ```
    
    â–¶ï¸ ë°±ì—… ë‹´ê¸°
    
    ```sql
    > RMAN 
    report need backup;
    backup datafile 2;
    list backup of datafile 2;
    ```
    
    â–¶ï¸ íŠ¹ì •í•œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ì— ì†í•œ ë°ì´í„° íŒŒì¼ ì¤‘ í•œ íŒŒì¼ì´ ì†ìƒ
    
    â–¶ï¸ ì¥ì•  ë°œìƒ
    
    ```sql
    ! rm /u01/app/oracle/oradata/ORA19C/data_tbs02.dbf
    alter system checkpoint;
    ```
    
    â–¶ï¸ ë³µêµ¬ í•„ìš”í•œ íŒŒì¼ í™•ì¸
    
    ```sql
    > RMAN
    report schema;
    list failure;
    list faulure 6495 detail; 
    ```
    
    â–¶ï¸ ì†ìƒëœ ë°ì´í„° íŒŒì¼ offline
    
    ```sql
    database datafile 2 offline;
    alter database open;
    select count(*) from hr.dept_new;
    ```
    
    â–¶ï¸ restore
    
    ```sql
    restore datafile 2;
    ```
    
    â–¶ï¸ recover
    
    ```sql
    recover datafile 2;
    ```
    
    â–¶ï¸ online
    
    ```sql
    alter database datafile 2 online;
    
    -- í™•ì¸
    select count(*) from hr.emp_2025;
    ```
    
    â–¶ï¸ ì‚­ì œ
    
    ```sql
    drop tablespace data_tbs including contents and datafiles;
    -- í™•ì¸
    report schema;
    ```
    
    â–¶ï¸ ì˜ë¯¸ì—†ëŠ” ë°±ì—…ë³¸ ì‚­ì œ
    
    ```sql
    report obsolete;
    delete obsolete;
    ```