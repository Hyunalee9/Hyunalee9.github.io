---
title: "[75ì¼ì°¨] ë©”ëª¨ë¦¬ ì‹¬í™” "
excerpt: "ì•„ì´í‹°ìœŒ 0811"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-08-11T21:08
---

# ë©”ëª¨ë¦¬ ì‹¬í™”

## Connection

â–¶ï¸ í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ access í•˜ê¸° ìœ„í•´ì„œ SQLë¬¸ì„ ë˜ì§€ë ¤ê³  í•œë‹¤.

â–¶ï¸ SQL Developer (user process) ë¥¼ ì´ìš©í•´ Server processì— ì ‘ê·¼í•˜ë ¤ê³  í•œë‹¤.

â–¶ï¸ ì ‘ì† ì‹œë„ ì‹œ, ë¦¬ìŠ¤ë„ˆ(lister.ora) ê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ìš© ì„œë²„ í”„ë¡œì„¸ì„œë¥¼ ìƒì„±í•˜ì—¬ ë¶™ì—¬ì¤€ë‹¤.

â–¶ï¸ ë„¤íŠ¸ì›Œí¬ ì •ë³´ ì²´í¬ ( í˜¸ìŠ¤íŠ¸, í¬íŠ¸ , í”„ë¡œí† ì½œ, SID)

â–¶ï¸ í´ë¼ì´ì–¸íŠ¸ ìª½ ì—°ê²° ì˜µì…˜ì—ëŠ” ë‘ ê°€ì§€ê°€ ìˆë‹¤.

- Easy Connection : í´ë¼ì´ì–¸íŠ¸ìª½ì— ë„¤í¬ì›Œí¬ ì„¤ì •í•  í•„ìš” ì—†ëŠ” ì—°ê²° ë°©ë²• (ex. SQL Developer)
- ê³ ê¸‰ ì—°ê²° ì˜µì…˜ : í´ë¼ì´ì–¸íŠ¸ìª½ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•´ì•¼ë§Œ í•˜ëŠ” ì—°ê²° ë°©ë²• . tnsnames.ora ì„¤ì • (db link ë§Œë“¤ë•Œë„ í•„ìš”í•¨)

â–¶ï¸ **session** : userë“¤ì´ ì˜¤ë¼í´ì— loginí•œ ìƒíƒœ 

## Cursor

â–¶ï¸ cursorëŠ” ì„œë²„ í”„ë¡œì„¸ì„œ ì•ˆì— pga ì•ˆì— uga ì•ˆì— ìˆë‹¤.

â–¶ï¸ cursorëŠ” SQLë¬¸ ì‹¤í–‰ ë©”ëª¨ë¦¬ ì˜ì—­ì´ë‹¤. 

â–¶ï¸ ugaì•ˆì—ëŠ” sortì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” SQL ë¬¸ ì‘ì—… ì˜ì—­ë„ ìˆë‹¤.

## SELECT ë¬¸

â–¶ï¸ ìœ ì €ê°€ SELECT ë¬¸ì„ ë˜ì§€ë©´, 

1. parse ë‹¨ê³„
    - syntax check
    - semantic check - ìœ ì €, ê°ì²´, ê°ì²´ ê¶Œí•œ, ê°ì²´ íƒ€ì…, ì„¸ê·¸ë¨¼íŠ¸, ì»¬ëŸ¼ ì²´í¬)
    
    ğŸŒ³ ìœ„ ì •ë³´ëŠ” ë””ìŠ¤í¬ì˜ ì‹œìŠ¤í…œ í…Œì´ë¸” ìŠ¤í˜ì´ìŠ¤ì˜ ë°ì´í„° ë”•ì…”ë„ˆë¦¬ í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ìˆëŠ”ë°,
    
    ë¬¼ë¦¬ì  i/o ë§ì´ ë°œìƒí•´ì„œ data buffer cacheì— ì €ì¥. ìì£¼ ì‚¬ìš©í•˜ëŠ” ì •ë³´ë“¤ì€ shared pool ì˜ ë°ì´í„° ë”•ì…”ë„ˆë¦¬(=row ë‹¨ìœ„ë¡œ ìŒ“ì—¬ìˆë‹¤ê³  í•´ì„œ row cache)ì— ì €ì¥ëœë‹¤.  
    
    - ë™ì¼í•œ SQL ë¬¸ì´ library cahceì•ˆì— ë˜‘ê°™ì€ SQLë¬¸ì´ ìˆëŠ”ì§€ ì‹¤í–‰ê³„íšì´ ìˆëŠ”ì§€ ì²´í¬
1. bind ë‹¨ê³„
2. execute ë‹¨ê³„ (ë¬¼ë¦¬ì  ë¸”ëŸ­ i/o ë°œìƒ â†’ data buffer cache)
    - library cache pin (lock) - shared ëª¨ë“œ (ë¬´íš¨í™”ê°€ ë˜ë©´ ì•ˆë˜ë‹ˆê¹Œ)
    - í…Œì´ë¸”ì˜ êµ¬ì¡°ê°€ ë°”ë€Œê±°ë‚˜, ì¸ë±ìŠ¤ ë³€ê²½, í†µê³„ ìˆ˜ì§‘ ë“± ë°œìƒí•˜ë©´  í•¸ë“¤ê³¼ ì‹¤í–‰ ê³„íšì´ ë§ê°€ì ¸ ë²„ë¦°ë‹¤.
    - ì´ë•Œ, ì‹¤í–‰ ê³„íšì€ ë¬´íš¨í™”ê°€ ëœë‹¤.
    
    ğŸŒ³ íƒ€ ì„¸ì…˜ì˜ ddl ì‘ì—… ë°©ì§€- library cache lock (wait event)  
    
    - active set ë§Œë“ ë‹¤.
3. Fetch
    - library cache lock =  null  (ë¬´íš¨í™”ê°€ í•„ìš”í•  ë•Œ ë¹¨ë¦¬ ..)
    - librarh cache pin íŒ¨ì¹˜

ğŸŒ³ v$Libcache_locks

Lock/pin mode held:

- `0`Â - No lock/pin held
- `1`Â - Null mode
- `2`Â - Share mode
- `3`Â - Exclusive mode

## Latch

â–¶ï¸ ìœ ì €ê°€ SQLë¬¸ì„ ë˜ì§€ë©´ ì„œë²„ í”„ë¡œì„¸ì„œëŠ” ê·¸ SQLë¬¸ì„ library cacheì— ìˆëŠ” hash bucket ì— ë„£ëŠ”ë° ì´ ì „ì— Latchë¥¼ ì¡ì•„ì•¼ í•œë‹¤. â†’ Latch library cache;

â–¶ï¸ íŒŒì‹± â†’ í•¸ë“¤ê³¼ LCOë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê¸° ìœ„í•´ì„œëŠ” Shared Pool ì´ë¼ëŠ” Latchë¥¼ ì¡ì•„ì•¼ í•œë‹¤.

â–¶ï¸ CPUìˆ˜ê°€ 4ì¥ ì´ìƒì´ê³ , SGA â†’ 250m ì´ìƒì´ë©´ Latch 7ê°œ

â–¶ï¸ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ë°›ìœ¼ë©´, í•¸ë“¤ê³¼ LCOë¥¼ ìƒì„±. ë‚˜ í˜¼ì ì‘ì—…í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— Library Cache Lockì´ë¼ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì¡ì•„ì•¼ í•¨. (exclusive mode) - ë©”ëª¨ë¦¬ êµ¬ì„± (Library Cache Lock - null)

â–¶ï¸ A, B ìœ ì €ê°€ ìˆë‹¤. Aê°€ ë¨¼ì € í•˜ë“œ íŒŒì‹±ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆì—ëŠ” Library Cache Lockì´ë¼ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ Bì˜ ì‘ì—…ì„ ë§‰ëŠ”ë‹¤.

â–¶ï¸ ì‹¤í–‰ ê³„íš ìƒì„±ì€ Library cache pin (exclusive mode) ì°ì–´ë†“ê³  ìˆ˜í–‰

## â­ ì •ë¦¬ - SGA (System Global Area)

- ëª¨ë“  ì˜¤ë¼í´ í”„ë¡œì„¸ìŠ¤ê°€ ì•¡ì„¸ìŠ¤í•˜ëŠ” ê³µìœ  ë©”ëª¨ë¦¬
- SGA ì˜ì—­ì— ìˆëŠ” êµ¬ì„± ìš”ì†Œë“¤ì€ DB ìš´ì˜ ì¤‘ì— ë™ì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- SGA ë©”ëª¨ë¦¬ëŠ” SGA_MAX_SIZE (static parameter) ë¡œ ì„¤ì •í•œë‹¤.

```sql
show sga

/*
Total System Global Area   713027608 bytes      
Fixed Size                   8900632 bytes      
Variable Size              587202560 bytes      
Database Buffers           109051904 bytes      
Redo Buffers                 7872512 bytes  
*/
```

ğŸ“ Fixed Size

- ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ê°€ ì•¡ì„¸ìŠ¤ í•´ì•¼ í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë° ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœì— ëŒ€í•œ ì •ë³´
- ì ê¸ˆ (lock)ì— ëŒ€í•œ ì •ë³´ì™€ ê°™ì´ í”„ë¡œì„¸ìŠ¤ ê°„ì— í†µì‹ í•˜ëŠ” ì •ë³´
- Fixed SizeëŠ” ì˜¤ë¼í´ì´ ê´€ë¦¬í•œë‹¤.

â–¶ï¸ Variable Size = shared pool + large pool + java pool + streams pool

ğŸ“ shared pool

```sql
select count(*) from v$sgastat where pool = 'shared pool'; -- 1418
```

ğŸ“ library cache : SQL ë¬¸ ì‹¤í–‰ì— ê´€ë ¨ëœ ëª¨ë“  ê°ì²´ì— ëŒ€í•œ ì •ë³´ ê´€ë¦¬

- shared sql area : SQL ë¬¸ì¥, Parse, tree, ì‹¤í–‰ ê³„íš (execution plan)
- pl/sql area : pl/sql ë¬¸ì¥, ì»´íŒŒì¼ëœ ì •ë³´, source, p(parse)-code, m(machine)-code, errors
- handle + LCO(library cache object)
- handel = name (SQLë¬¸) + ë©”íƒ€ì •ë³´
- LCO = dependency, child table, data block(ì‹¤í–‰ ê³„íš ì •ë³´)

ğŸ“ data dictionary cache (row cache) : ë”•ì…”ë„ˆë¦¬ ì •ë³´ë“¤ì´ ì €ì¥ë˜ì–´ ìˆëŠ” ë©”ëª¨ë¦¬ 

```sql
select cache#, type, parameter from v$rowcache;
```

![image.png](/assets/20250811/1.png)

â–¶ï¸ ë°ì´í„° ë”•ì…”ë„ˆë¦¬ ìºì‰¬ì•ˆì— ë“¤ì–´ìˆëŠ” ì •ë³´ë“¤

- session, process, enqueue, transaction ì •ë³´
- shared server í™˜ê²½ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° UGA(User Global Area)
- shared_pool_size

â–¶ï¸ SELECT ë¬¸ ì²˜ë¦¬ ë‹¨ê³„

```sql
select * from hr.employees where employee_id = 100;
```

â–¶ï¸ parse

- ë¬¸ë²• ì²´í¬ (syntax)
- ì˜ë¯¸ ë¶„ì„(semantic) ì²´í¬ : user$, obj$, tab$, seg$, col$, objauth$, sysauth$
    
    â†’ ë”•ì…”ë„ˆë¦¬ ì •ë³´ê°€ ìˆëŠ” data dictionary cache ì˜ì—­ì„ ì¡°íšŒí•œë‹¤.
    

ğŸŒ³ objauth$

```sql
select * from objauth$;
```

![image.png](/assets/20250811/2.png)

â–¶ï¸ ì•Œì•„ë³´ê¸° í˜ë“¤ì–´ì„œ ë³´ê¸° ì‰½ê²Œ ë§Œë“  ë·° (dba_tab_privs)

ğŸŒ³ Soft parsing

- ë™ì¼í•œ SQL ë¬¸ì´ shared pool ë©”ëª¨ë¦¬ ì•ˆì— library cache ì— ìˆëŠ”ì§€ ì¡°íšŒ

â†’ ë™ì¼í•œ SQLë¬¸ì´ ìˆìœ¼ë©´ ì‹¤í–‰ ê³„íšì„ ê³µìœ í•˜ê¸° ìœ„í•´ì„œ 

â†’ library cache latch ë¥¼ íšë“í•œ í›„ ì¡°íšŒí•´ì•¼ í•œë‹¤.

â†’ latchë¥¼ ëª»ì¡ì„ ê²½ìš° ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤. ì´ë•Œ ë°œìƒí•˜ëŠ” wait event ëŠ” latch : library cache 

â†’ latch(í”„ë¡œê·¸ë¨) ëŒ€ì‹  mutex (í”„ë¡œê·¸ë¨) í˜•íƒœê°€ ë‚˜ì™”ë‹¤. (10g)

ğŸŒ³ library cache : mutex x 

ğŸŒ³ soft parsing ì‹¤íŒ¨í•˜ê²Œ ë˜ë©´ hard parsing ë°œìƒí•œë‹¤.

- ë©”ëª¨ë¦¬ í• ë‹¹
    - shared pool latchë¥¼ íšë“í•˜ê³  ì ì ˆí•œ í¬ê¸°ì˜ free chunkë¥¼ free listì—ì„œ ì°¾ëŠ”ë‹¤.
    - shared pool latchë¥¼ íšë“ ëª»í•˜ëŠ” latch : shared pool wait event ë°œìƒí•œë‹¤.

ğŸŒ³ ë§Œì•½ì— free ì¡°ê°ì´ 7k, 10k, 1k, 100byte ìˆëŠ” ê²½ìš° ë‚´ê°€ í•„ìš”í•œ í”„ë¦¬ ê³µê°„ì€ 8kë¼ë©´ ì´ ì¤‘ì— 10k í”„ë¦¬ ê³µê°„ì„ 8kë¡œ í™•ë³´í•˜ê³  ë‚¨ì€ 2këŠ” í”„ë¦¬ ê³µê°„ìœ¼ë¡œ ë†”ë‘”ë‹¤. í›„ì— í”„ë¦¬ ê³µê°„ì€ 7k, 2k, 1k, 100byte ë¡œ ë‚¨ì•„ ìˆë‹¤. ì´ë•Œ ë˜ í•„ìš”í•œ í”„ë¦¬ ê³µê°„ì´ 9k ë¼ë©´ ì–´ë–¨ê¹Œ â–¶ï¸ ë‚´ê°€ í•„ìš”í•œ ë§Œí¼ì˜ í”„ë¦¬ ê³µê°„ì´ ì—†ìœ¼ë©´ ORA-04031 ì˜¤ë¥˜ ë°œìƒí•œë‹¤. (**ë‹¨í¸í™” ë°œìƒ**: ê³µê°„ì´ ìˆì§€ë§Œ í•„ìš”í•œ ë§Œí¼ì˜ ê³µê°„ì€ ì—†ëŠ” ê²ƒ.)

ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¦¬ ê³µê°„ì´ ì—†ì´ ì¡°ê°ë“¤ì´ ë„ˆë¬´ ë§ì´ ë§Œë“¤ì–´ì ¸ ìˆëŠ” ê²½ìš° ora-4031ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ë¹ˆë²ˆí•´ ì§ˆ ìˆ˜ ìˆë‹¤. í•´ê²° ë°©ë²•ì€ shared poolë¥¼ flush í•´ì•¼ í•œë‹¤. alter system flush shared_pool; 

select ë¬¸ì˜ í¬ê¸°ì— ë”°ë¼ LCO, handle ì˜ í¬ê¸°ë„ ë‹¬ë¼ì§„ë‹¤.

- freeë¥¼ í™•ë³´í•œ í›„ library cache handleì— ëŒ€í•´ library cache lockì„ exclusive ëª¨ë“œë¡œ íšë“í•˜ê³  LCO(Library Cache Obejct) ë¥¼ ìƒì„±í•œë‹¤.
- LCOê°€ ìƒì„±ë˜ë©´ library cache lockì€ NULL ëª¨ë“œë¡œ ë³€í™˜í•œë‹¤.
- library cache pinì„ exclusive ëª¨ë“œë¡œ íšë“í•œ í›„ ì‹¤í–‰ ê³„íš(execution plan) ì„ ìƒì„±í•œë‹¤.

â–¶ï¸ bind(ì˜µì…˜)

- SQLë¬¸ì— ë³€ìˆ˜ ì²˜ë¦¬ê°€ ë˜ì–´ ìˆìœ¼ë©´ ì‹¤ì œ ê°’ì´ ì…ë ¥ë˜ëŠ” ë‹¨ê³„

â–¶ï¸ execute

- library cache lock ê³¼ library cache pinì„ shared ëª¨ë“œë¡œ ë³€í™˜í•˜ê³  ë¸”ë¡ I/O ë°œìƒ, ACTIVE SET ê²°ê³¼ ìƒì„±

â–¶ï¸ fetch

- library cache lock ì„ null ëª¨ë“œ ë³€í™˜í•˜ê³  library cache pinì„ í•´ì œí•œë‹¤.
- active set ê²°ê³¼ë¥¼ user processì— ì „ë‹¬í•œë‹¤.

- ì‹¤í–‰ ê³„íš
    
     â–¶ï¸ ë°ì´í„° ì²˜ë¦¬ ë°©ë²• ê²°ì • 
    
    1. full table scan
    2. rowid scan
        - by user rowid
        - by index rowid
    
    â–¶ï¸ ì¡°ì¸ ë°©ë²•
    
    1. nested loop join
    2. sort merge join
    3. hash join

        â–¶ï¸ ì¡°ì¸ ìˆœì„œ

- from ì ˆì— ë‚˜ì—´ë˜ì–´ ìˆëŠ” í…Œì´ë¸”ì˜ ìˆ˜ë§Œí¼ ìˆœì„œë¥¼ ê²°ì •í•´ì•¼ í•œë‹¤. (n!)

ğŸ“ ë™ì¼í•œ SQL ë¬¸

- ê³µë°±ë¬¸ì, ì¤„ë°”ê¿ˆ, tab key ì¼ì¹˜
- ëŒ€ì†Œë¬¸ì
- ì†Œìœ ì ì´ë¦„.í…Œì´ë¸”
- ì£¼ì„(â€”,/* */), íŒíŠ¸(/*+ full */)*
- ì¡°ê±´ì ˆ ë¹„êµê°’

```sql
alter system flush shared_pool;

-- â–¶ï¸ hr session
select * from hr.employees where employee_id = 100;
```

![image.png](/assets/20250811/3.png)

```sql
-- â–¶ï¸ sys session (LCO ì¡°íšŒ)
select sql_id, sql_text, parse_calls, loads, executions, hash_value, plan_hash_value
from v$sql
where sql_text like '%hr.employees%'
and sql_text not like '%v$sql%';

/*
-> 
í˜„ì¬ ê³µìœ  í’€(Shared Pool)ì— ìºì‹±ëœ SQL ì¤‘ì—ì„œ hr.emp í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ëŠ” SQL ë¬¸ì˜ ì‹¤í–‰ 
í†µê³„ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ëª…ë ¹
*/
```

![image.png](/assets/20250811/4.png)

ğŸ“ parse calls 

ğŸ“ loads

ğŸ“ executions 

ğŸ“ plan_hash_value :  ì‹¤í–‰ ê³„íšì— ëŒ€í•œ hash value

```sql
-- ì‹¤í–‰ ê³„íš
select * from v$sql_plan where sql_id  = '2sgjc8u8ha0m4'

-- ë¶ˆí¸í•˜ë‹¤.
-- ì¡°ê¸ˆ ë” í¸í•˜ê²Œ format
select * from table(dbms_xplan.display_cursor('2sgjc8u8ha0m4'));
```

ğŸ“ access : ë°ì´í„°ê°€ ìˆëŠ” ì‹¤ì œ ë¸”ë¡ì„ ì½ê¸° ì „ì— ì–´ë–¤ ë°©ë²•ìœ¼ë¡œ ë¸”ë¡ì„ ì½ì„ ê²ƒì¸ê°€ë¥¼ ê²°ì •í•œë‹¤. 

ì¦‰ ë°ì´í„°ê°€ ìˆëŠ” ë¸”ë¡ì„ ë¯¸ë¦¬ ì•Œê³  ìˆì„ ë•Œ ë³´í¸ì ìœ¼ë¡œ rowid scan ë°©ì‹

ğŸ“ filter : ë°ì´í„°ê°€ ìˆëŠ” ì‹¤ì œ ë¸”ë¡ì˜ ìœ„ì¹˜ë¥¼ ëª¨ë¥´ëŠ” ê²½ìš° ì¦‰ ì²« ë²ˆì§¸ ë¸”ë¡ë¶€í„° ë§ˆì§€ë§‰ ë¸”ë¡ê¹Œì§€ ì½ì–´ ê°€ë©´ì„œ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë°©ì‹, ë³´í¸ì ìœ¼ë¡œ full table scan

```sql
-- â–¶ï¸ hr session
select * from hr.employees where employee_id =100;
select * from hr.employees where employee_id =101;
select * from hr.employees where employee_id =102;
select * from hr.employees where employee_id =103;

-- â–¶ï¸ sys session
select sql_id, sql_text, parse_calls, loads, executions, hash_value, plan_hash_value 
from v$sql
where sql_text like '%hr.employees%'
and sql_text not like '%v$sql%';

/*
c2qq278mfcx26	select * from hr.employees where employee_id =103	1	1	1	652637254	1833546154
cnnnw37nqdkty	select * from hr.employees where employee_id =101	1	1	1	3915828030	1833546154
98159y3jq5tgn	select * from hr.employees where employee_id =102	1	1	1	3814909428	1833546154
2sgjc8u8ha0m4	select * from hr.employees where employee_id = 100	3	1	3	2433024612	1833546154
*/

-- LCO 4ê°œ 

```

â–¶ï¸ ë³€ìˆ˜ ì²˜ë¦¬

```sql
var b_id number
execute :b_id := 100
select * from hr.employees where employee_id = :b_id;

execute :b_id := 101
select * from hr.employees where employee_id = :b_id;

execute :b_id := 102
select * from hr.employees where employee_id = :b_id;

```

â–¶ï¸ 

```sql
drop table hr.emp purge;
create table hr.emp as select * from hr.employees;
alter system flush shared_pool;
select last_name, salary from hr.emp where employee_id = 100;
select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

![image.png](/assets/20250811/5.png)

```sql
select * from table(dbms_xplan.display_cursor('8qhp0dmv9q94d'));
```

![image.png](/assets/20250811/6.png)

â–¶ï¸ í•„í„° ìˆ ì–´

```sql
-- DDL ë¬¸ì¥ ìˆ˜í–‰
alter table hr.emp add constraint emp_id_pk primary key(employee_id);

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

![image.png](/assets/20250811/7.png)

â–¶ï¸ DDL ë¬¸ì¥ ìˆ˜í–‰í•˜ì—¬ ì‹¤í–‰ ê³„íšì´ ë§ê°€ì¡Œë‹¤. hard parsing ë°œìƒ.

```sql
select last_name, salary from hr.emp where employee_id = 100;

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

â–¶ï¸ ì‹¤í–‰ ê³„íš ë¬´íš¨í™”ê°€ ë°œìƒí•œ SQLë¬¸ì¥ì„ ë˜ ë‹¤ì‹œ ì‚¬ìš©í•œë‹¤ë©´ 

![image.png](/assets/20250811/8.png)

Loadsê°€ ì¦ê°€ëœë‹¤. ì¦‰, ì‹¤í–‰ ê³„íšì„ ë‹¤ì‹œ ë§Œë“ ë‹¤. 

```sql
alter table hr.emp drop primary key;

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

![image.png](/assets/20250811/9.png)

â–¶ï¸ DDL ë¬¸ì¥ ìˆ˜í–‰ â†’ ë¬´íš¨í™” ë˜ ë°œìƒ

```sql
create unique index hr.emp_idx on hr.emp(employee_id);

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

![image.png](/assets/20250811/10.png)

â–¶ï¸ unique index ìƒì„± â†’ ë¬´íš¨í™” ë°œìƒí•˜ì§€ ì•ŠìŒ

```sql
alter table hr.emp add constraint emp_id_pk primary key(employee_id);
-- ì•„ë˜ì™€ ê°™ìŒ
alter table hr.emp add constraint emp_id_pk primary key(employee_id) using index hr.emp_idx;
-- ë˜ unique index ë°œìƒ
-- ë¬´íš¨í™” ë°œìƒí•˜ì§€ ì•ŠìŒ

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';

select last_name, salary from hr.emp where employee_id = 100;
-- ë¬´íš¨í™” ë°œìƒ
```

![image.png](/assets/20250811/11.png)

â–¶ï¸ í…Œì´ë¸” êµ¬ì¡° ë³€ê²½ â†’ ë¬´íš¨í™” ë°œìƒ

```sql
alter table hr.emp modify last_name varchar2(40);

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

â–¶ï¸ select ë¬¸

```sql

select last_name, salary from hr.emp where employee_id = 100;

select sql_id, sql_text, parse_calls, loads, executions, invalidations
from v$sql
where sql_text like '%hr.emp%'
and sql_text not like '%v$sql%';
```

â–¶ï¸  

```sql
select num_rows, blocks, avg_row_len, to_char(last_analyzed, 'yyyy-mm-dd hh24:mi:ss') from dba_tables where owner = 'HR' and table_name ='EMP';

-- last_analyzed : ë§ˆì§€ë§‰ í†µê³„ ìˆ˜ì§‘ì„ í•œ ë‚ ì§œ.
```

![image.png](/assets/20250811/12.png)

ğŸ“ ctas ì´ìš©í•˜ë©´ ëŒ€ìƒ í…Œì´ë¸”ì€ í†µê³„ ìˆ˜ì§‘í•œë‹¤.

```sql
EXECUTE DBMS_STATS.GATHER_TABLE_STATS('HR','EMP');
```

ğŸ“ hidden íŒŒë¼ë¯¸í„°

```sql
select a.ksppinm parameter, b.ksppstvl value
from   x$ksppi a, x$ksppcv b
where  a.indx = b.indx
and    a.ksppinm = '_optimizer_invalidation_period';
```

![image.png](/assets/20250811/13.png)

â–¶ï¸ library cache lock

- library cache lock ì€ LCO(Library Cache Object)ë¥¼ ì ‘ê·¼í•˜ê±°ë‚˜ ë³€ê²½í•˜ëŠ” ê²½ìš° handleì— ëŒ€í•´ íšë“í•˜ëŠ” lockì´ë‹¤.
- ì—¬ëŸ¬ ì„¸ì…˜ì—ì„œ ë™ì‹œì— ë™ì¼í•œ LCOë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•œë‹¤.
- library cache lockì„ íšë“í•˜ì§€ ëª»í•´ ëŒ€ê¸° í•˜ëŠ” ê²½ìš° library cache lock ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤.
- SQL hard parsing
    - library cache lock ì€ exclusive modeë¡œ íšë“í•´ì•¼ í•œë‹¤.
    - LCOë¥¼ ìƒì„±í•˜ë©´ library cache lockì€ null mode ë³€í™˜í•œë‹¤.
- SQL execute ë‹¨ê³„ : library cache lock ì€ shared modeë¡œ íšë“í•´ì•¼ í•œë‹¤.
- SQL fetch ë‹¨ê³„ : library cache lock ì€ null modeë¡œ íšë“í•´ì•¼ í•œë‹¤.
- DDL ë¬¸ì¥ : library cache lockì€ exclusive modeë¡œ íšë“í•´ì•¼ í•œë‹¤.
- create or replace procedure (function, package) : library cache lockì€ exclusive modeë¡œ íšë“í•´ì•¼ í•œë‹¤.

```sql
-- hr ì„¸ì…˜ ì°½ 2ê°œ, sys 1ê°œ
-- â–¶ï¸ sess_1 (hr)
EXECUTE DBMS_APPLICATION_INFO.SET_CLIENT_INFO('sess_1');

-- â–¶ï¸ sess_2 (hr)
EXECUTE DBMS_APPLICATION_INFO.SET_CLIENT_INFO('sess_2');
-- â–¶ï¸ sys session
select client_info, sid from v$session where client_info in ('sess_1' , 'sess_2');
/*
SYS@ora19c> select client_info, sid from v$session where client_info in ('sess_1' , 'sess_2');

CLIENT_INFO                                                             SID
---------------------------------------------------------------- ----------
sess_1                                                                   36
sess_2                                                                  273

*/

-- ì„¸ì…˜ì´ í˜„ì¬ ëŒ€ê¸°í•˜ê³  ìˆëŠ” ì´ë²¤íŠ¸ ì •ë³´, ëˆ„ì  ì •ë³´ê°€ ì•„ë‹Œ ì‹¤ì‹œê°„ ì •ë³´ì´ë¯€ë¡œ ë°˜ë³µì ìœ¼ë¡œ ì¡°íšŒí•´ì•¼ ì˜ë¯¸ ìˆëŠ” ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.
-- (1)
select sid, event, wait_class, wait_time, seconds_in_wait, state
from v$session_wait
where sid in (36,273);

-- ì„¸ì…˜ë³„ ëŒ€ê¸° ì´ë²¤íŠ¸ì˜ ëˆ„ì  ì •ë³´ 
-- (2)
select sid, event, total_waits, time_waited from v$session_event where sid in (36,273);
```

![1)](/assets/20250811/14.png)

1)

![2)](/assets/20250811/15.png)

2)

ğŸ“ session_event : ëˆ„ì  ì •ë³´ ( ì„¸ì…˜ on)

â–¶ï¸ sid : ì„¸ì…˜ id

â–¶ï¸ event : ëŒ€ê¸° ì´ë²¤íŠ¸ ì´ë¦„

â–¶ï¸ log file sync :  commit, rollback í•˜ë©´ lwgr 

â–¶ï¸ total_waits : ì „ì²´ ëŒ€ê¸° íšŸìˆ˜

â–¶ï¸ time_waited : ì „ì²´ ëŒ€ê¸° ì‹œê°„ 1/100ì´ˆ ë‹¨ìœ„

ğŸ“ session_wait : ì‹¤ì‹œê°„ í˜„ì¬ ì •ë³´  (ì´ë¯¸ ì§€ë‚˜ê°„ eventëŠ” ì•ˆë³´ì„) 

- ì„¸ì…˜ì´ í˜„ì¬ ëŒ€ê¸°í•˜ê³  ìˆëŠ” ì´ë²¤íŠ¸ ì •ë³´, ëˆ„ì  ì •ë³´ê°€ ì•„ë‹Œ ì‹¤ì‹œê°„ ì •ë³´ì´ë¯€ë¡œ ë°˜ë³µì ìœ¼ë¡œ ì¡°íšŒí•´ì•¼ ì˜ë¯¸ ìˆëŠ” ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

â–¶ï¸  sid : ì„¸ì…˜ id

â–¶ï¸  event : ëŒ€ê¸° ì´ë²¤íŠ¸

â–¶ï¸ wait_class : ëŒ€ê¸° ì´ë²¤íŠ¸ ì¢…ë¥˜

â–¶ï¸ wait_time : ëŒ€ê¸° ì‹œê°„, state ì»¬ëŸ¼ì˜ ê°’ì´ waited know time ì¼ ê²½ìš°ì—ë§Œ ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤.

- ë‹¨ìœ„ëŠ” 1/100ì´ˆ, 11g wait_time, micro(1/1,000,000) ì»¬ëŸ¼ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤.

â–¶ï¸ seconds_in_wait : ëŒ€ê¸° ì‹œê°„, state ì»¬ëŸ¼ì˜ ê°’ì´ waitingì¼ ê²½ìš°ì—ë§Œ ì˜ë¯¸ë¥¼ ê°€ì§„ë‹¤. ë‹¨ìœ„ëŠ” 1ì´ˆ

11g time_since_last_wait_micro(1/1,000,000) ì»¬ëŸ¼ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤.

â–¶ï¸ state : ëŒ€ê¸° ìƒíƒœ, ì´ ì»¬ëŸ¼ì˜ ê°’ì´ waiting ì¼ ê²½ìš°ì—ë§Œ ì‹¤ì œ ëŒ€ê¸°í•˜ê³  ìˆëŠ” ì¤‘ì´ë‹¤.

ğŸ“ **ì„¸ì…˜ì´ ëŠê¸°ë©´ ì‚¬ë¼ì§„ë‹¤.** 

```sql
-- â–¶ï¸ sess_1
execute dbms_application_info.set_client_info('sass_1')

-- sess_1 , sess_2 ëª¨ë‘ ê°™ì€ í”„ë¡œì‹œì €ë¥¼ ìƒì„± (= LCO ìƒì„±) í•˜ë ¤ê³  í•´ ê²½í•©ì´ ì¼ì–´ë‚¬ë‹¤.
begin
    for i in 1..10000 loop
        execute immediate 'create or replace procedure p1 is begin null; end;';
    end loop;
end;
/

-- â–¶ï¸ sess_2
execute dbms_application_info.set_client_info('sass_2')

begin
    for i in 1..10000 loop
        execute immediate 'create or replace procedure p1 is begin null; end;';
    end loop;
end;
/

select sid, event, total_waits, time_waited 
from v$session_event 
where sid in (36,273);

/*
       SID EVENT
---------- ----------------------------------------------------------------
WAIT_CLASS                                                        WAIT_TIME
---------------------------------------------------------------- ----------
SECONDS_IN_WAIT STATE
--------------- -------------------
        36 SQL*Net message from client
Idle                                                                      0
            168 WAITING

       273 SQL*Net message from client
Idle                                                                      0
            158 WAITING

       SID EVENT
---------- ----------------------------------------------------------------
WAIT_CLASS                                                        WAIT_TIME
---------------------------------------------------------------- ----------
SECONDS_IN_WAIT STATE
--------------- -------------------

SYS@ora19c> select sid, event, total_waits, time_waited
from v$session_event
where sid in (36,273);  2    3

*/
```

â–¶ï¸ ëˆ„ì  ì •ë³´ (session_event)

![image.png](/assets/20250811/16.png)

ğŸ“ **S** â†’ shared

ğŸ“ **X** â†’ exclusive 

â–¶ï¸ ì¡°íšŒ

```sql
select sid, username, prev_sql_id, sql_id from v$session where sid in (36,273);
```

![image.png](/assets/20250811/17.png)

```sql
select sql_text from v$sql where sql_id = '39unwnghvw0vs';
```

![image.png](/assets/20250811/18.png)

ğŸ“ library cache pin

- LCO ì ‘ê·¼í•˜ê±°ë‚˜ ë³€ê²½í•˜ëŠ” ê²½ìš° LCOì— ëŒ€í•´ íšë“í•˜ëŠ” LOCK
- LCO ì‹¤í–‰ ì •ë³´ë¥¼ ë³´í˜¸ ì¦‰ ì‹¤í–‰ ê³¼ì • ë™ì•ˆ LCO ì˜ ì‹¤í–‰ ì •ë³´ê°€ ë³€ê²½ë˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤.
- SQLë¬¸ hard parsing :  library cache pinì„ exclusive mode íšë“í•œ í›„ ì‹¤í–‰ ê³„íšì„ ìƒì„±
- SQLë¬¸ execute ë‹¨ê³„ : library cache pinì„ shared mode íšë“
- SQLë¬¸ fetch ë‹¨ê³„ : library cache pin ì„ í•´ì œí•œë‹¤.
- procedure(function, package) ì‹¤í–‰ë‹¨ê³„ : library cache pinì„ shared mode íšë“

```sql
alter procedure(function, package).. compile : library cache pinì„ exclusive mode íšë“
```

â–¶ï¸ simulation

```sql
grant execute on dbms_lock to hr;
```

â–¶ï¸ í”„ë¡œì‹œì € ìƒì„±

```sql
create or replace procedure hr.pin_proc(p_time in number)
is
begin
	dbms_lock.sleep(p_time);
end;
/

-- 5ì´ˆë™ì•ˆ ê¸°ë‹¤ë ¤ì¤˜
execute hr.pin_proc(5)
```

â–¶ï¸

```sql
-- sess_1
execute dbms_application_info.set_client_info('sass_1')

-- sess_2
execute dbms_application_info.set_client_info('sass_2')

-- sys
select client_info, sid from v$session where client_info in ('sass_1','sass_2');

-- sess_2
alter procedure hr.pin_proc compile;

-- sys
select sid, event, total_waits, time_waited
from v$session_event
where sid in (36,282);
```

![image.png](/assets/20250811/19.png)