---
title: "[54ì¼ì°¨] Audit"
excerpt: "ì•„ì´í‹°ìœŒ 0709_(3)"
categories:
      - ORACLE19c
tags:
      - ORACLE19c
      - TIL
last-modified-at: 2025-07-09T18:01
---

## ğŸ“ **Audit(ê°ì‚¬)**

- auditì€ ì„ íƒí•œ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ëª¨ë‹ˆí„° í•˜ëŠ” ê²ƒì´ë‹¤.
- ì˜ì‹¬ì´ ê°€ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ì¡°ì‚¬í•  ê²½ìš°
- íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì— ëŒ€í•œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ê²½ìš°

ğŸŒ³ **ë¬¸ì¥ ê°ì‚¬**

```sql
-- â–¶ï¸ audit í™œì„±í™”
SYS@ora19c> show parameter audit_trail

/*

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
audit_trail                          string      DB

*/

select * from v$parameter where name = 'audit_trail';   --ì •ì  íŒŒë¼ë¯¸í„°

-- â–¶ï¸ ë¹„í™œì„±í™”
alter system set audit_trail = none scope = spfile;

-- â–¶ï¸ í™œì„±í™”
-- ê°ì‚¬ë¥¼ í™œì„±í™”í•˜ê³  ëª¨ë“  ê°ì‚¬ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ê°ì‚¬ ë”•ì…”ë„ˆë¦¬ í…Œì´ë¸”(aud$)ì— ì €ì¥í•œë‹¤.
alter system set audit_trail = db scope = spfile;

-- â–¶ï¸ ê°ì‚¬ ì •ë³´ê°€ ì €ì¥ë˜ëŠ” ë”•ì…”ë„ˆë¦¬ í…Œì´ë¸”
-- aud$ ê°ì‚¬í•˜ë©´ ìš©ëŸ‰ ê¸ˆë°© ë¶ˆì–´ë‚  ìˆ˜ ìˆìŒ. ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ ì˜í•´ë†”ì•¼í•¨
select * from sys.aud$;

-- â–¶ï¸ ê°ì‚¬ ì˜µì…˜ ì„¤ì •
-- 1ï¸âƒ£ ë¬¸ì¥ ê°ì‚¬
-- ğŸ“ SQLë¬¸ì„ ì„ íƒì ìœ¼ë¡œ ê°ì‚¬
-- ğŸŒ³ AUDIT TABLEì€ CREATE TABLE, DROP TABLE, TRUNCATE TABLE ìˆ˜í–‰í•˜ëŠ” ê°ì‚¬

-- ë¬¸ì¥ ê°ì‚¬ ì„¤ì •
AUDIT TABLE;

-- ë¬¸ì¥ ê°ì‚¬ ì„¤ì • ì •ë³´ í™•ì¸
SELECT * FROM dba_stmt_audit_opts WHERE audit_option = 'TABLE';
```

![image.png](/assets/20250709/2.png)

```sql
-- â–¶ï¸ sawon02 
-- ì‹œìŠ¤í…œ ê¶Œí•œ, ê°ì²´ ê¶Œí•œ í™•ì¸
SELECT * FROM session_privs;
SELECT * FROM role_sys_privs;
SELECT * FROM user_tab_privs;
SELECT * FROM user_ts_quotas;

CREATE TABLE emp AS SELECT * FROM hr.employees;
SELECT * FROM emp; 

-- â–¶ï¸ oracle
select * from sys.aud$;
```

![image.png](/assets/20250709/3.png)

```sql
-- â–¶ï¸ sawon02 
DROP TABLE emp PURGE;

-- â–¶ï¸ oracle
select * from sys.aud$;
select * from dba_audit_object;
```

![image.png](/assets/20250709/4.png)

```sql
-- â–¶ï¸ oracle
SELECT username, owner, obj_name, action_name, decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day , sql_text, sql_bind
from dba_audit_object;
```

![image.png](/assets/20250709/5.png)

```sql
-- â–¶ï¸ sawon02
CREATE TABLE emp AS SELECT * FROM hr.employees; -- ê°ì‚¬ì— ê±¸ë¦°ë‹¤.
ALTER TABLE emp MODIFY last_name varchar2(50);  -- ê°ì‚¬ì— ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤.
TRUNCATE TABLE emp;   -- ê°ì‚¬ì— ê±¸ë¦°ë‹¤.

-- â–¶ï¸ oracle
SELECT username, owner, obj_name, action_name, decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day
from dba_audit_object;
```

![image.png](/assets/20250709/6.png)

```sql
-- â–¶ï¸ sys
-- â–¶ï¸ ë¬¸ì¥ ê°ì‚¬ ì„¤ì • í•´ì§€
NOAUDIT TABLE;

-- â–¶ï¸ ë¬¸ì¥ ê°ì‚¬ ì„¤ì • ì •ë³´ í™•ì¸
SELECT * FROM dba_stmt_audit_opts WHERE audit_option = 'TABLE';

-- â–¶ï¸ ê°ì‚¬ ë¡œê·¸ ì •ë³´ ì§€ìš°ê¸°
DELETE FROM sys.aud$;

rollback;

select * from sys.aud$; 
-> 
SELECT username, owner, obj_name, action_name, decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day
from dba_audit_object;
--- timestamp : ì¶œë ¥í•  ë•Œ ì‹œê°„ì´ ì •ê·œí™”ë˜ì–´ ë‚˜ì˜¨ë‹¹

-- â–¶ï¸ ê°ì‚¬ í…Œì´ë¸” ì§€ìš°ê¸°
truncate table sys.aud$; -- ë¡¤ë°±ì„ í•  ìˆ˜ ì—†ë‹¤. 

```

ğŸŒ³ **schema (ìŠ¤í‚¤ë§ˆ , ìœ ì €) object audit**

**â–¶ï¸ ìŠ¤í‚¤ë§ˆ : íŠ¹ì •í•œ ìœ ì €ê°€ ê°€ì§€ê³  ìˆëŠ” ëª¨ë“  ê°ì²´ë“¤**

â–¶ï¸ íŠ¹ì •í•œ ìœ ì €ê°€ ì†Œìœ í•œ í…Œì´ë¸”ì— ëŒ€í•´ì„œ ê°ì‚¬ ì„¤ì •

```sql
-- â–¶ï¸ sys
audit select, insert, update, delete on hr.emp;
audit select, insert, update, delete on hr.dept;

select owner, object_name, object_type, sel, ins, upd, del from dba_obj_audit_opts WHERE owner = 'HR';
```

![image.png](/assets/20250709/7.png)

```sql
-- â–¶ï¸ sawon01 
SELECT sal FROM hr.emp WHERE id = 100;

-- â–¶ï¸ sys
SELECT * FROM sys.aud$;

-- â–¶ï¸ sawon02
SELECT * FROM hr.emp WHERE id = 200;

-- â–¶ï¸ sawon01
-- insert , update, delete ë‹¤ ê°ì‚¬ ê±¸ë¦°ë‹¤.
INSERT INTO hr.emp(id,name,sal,dept_id) VALUES(300,'oracle', 1000, 10);

UPDATE hr.emp
SET sal = 3000
WHERE id = 200;

DELETE FROM hr.emp WHERE id = 101;

-- ë¡¤ë°±í•´ë„ ë‹¤ ê±¸ë¦°ë‹¤.
ROLLBACK;

-- â–¶ï¸ sys
SELECT username, 
       owner, obj_name, 
       action_name, 
       decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day
from dba_audit_object;
```

ğŸŒ³ ìŠ¤í‚¤ë§ˆ ê°ì²´ ê°ì‚¬ ì„¤ì • í•´ì§€

```sql
-- â–¶ï¸ sys
noaudit select, insert, update, delete on hr.emp;
noaudit select, insert, update, delete on hr.dept;

SELECT owner, object_name, object_type, sel, ins, upd, del 
FROM dba_obj_audit_opts 
WHERE owner = 'HR';
```

ğŸŒ³ ê°ì‚¬ ë¡œê·¸ ì •ë³´ ì‚­ì œ

```sql
TRUNCATE TABLE sys.aud$;
SELECT * FROM sys.aud$;

SELECT username, 
       owner, obj_name, 
       action_name, 
       decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day
from dba_audit_object;

-- â–¶ï¸ hr
SELECT * FROM user_tab_privs WHERE grantee IN ('SAWON01', 'SAWON02');

REVOKE ALL on hr.emp FROM sawon01, sawon02;
REVOKE ALL on hr.dept FROM sawon01, sawon02;

SELECT * FROM user_tab_privs WHERE grantee IN ('SAWON01', 'SAWON02');

--â–¶ï¸ sys
GRANT SELECT any table TO sawon01, sawon02;
```

ğŸŒ³ ê¶Œí•œ(privilege) ê°ì‚¬

- ì‹œìŠ¤í…œ ê¶Œí•œì„ ì„ íƒì ìœ¼ë¡œ ê°ì‚¬

```sql
-- â–¶ï¸ sys 
audit select any table by sawon01, sawon02 by session;
select * from dba_stmt_audit_opts where audit_option = 'SELECT ANY TABLE';

-- â–¶ï¸ sawon01
SELECT * FROM hr.emp;
```

ğŸŒ³ audit_trail =db_extended ì˜µì…˜ ì„¤ì •

- ìœ ì €ê°€ ì‹¤í–‰í•œ SQLë¬¸ í…ìŠ¤íŠ¸ ë° ë³€ìˆ˜ ê°’ ê°ì‚¬ ë¡œê·¸ ì •ë³´ê°€ ì €ì¥

```sql
-- â–¶ï¸ sys 
SYS@ora19c> ALTER SYSTEM SET audit_trail=db,extended scope=spfile;
SYS@ora19c> shutdown immediate;

SYS@ora19c> show parameter audit_trail

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
audit_trail                          string      DB, EXTENDED

-- â–¶ï¸ SQL Developer
SELECT username, owner, obj_name, action_name, decode(returncode, '0', 'success', returncode) sess,
       to_char(timestamp, 'yyyy-mm-dd hh24:mi:ss') day , sql_text, sql_bind
from dba_audit_object;
```

![image.png](/assets/20250709/8.png)

â†’ sql_text, sql_bind ê¸°ëŠ¥

â–¶ï¸ ì¤‘ê°„ì— ì£¼ì‹  ê±°

```sql
-- ì œì•½ ì¡°ê±´ì´ë‘ ë‹¤í•¨ê»˜ dept, emp ëª¨ë‘ ì‚­ì œ
drop table hr.dept cascade constraints purge;
drop table hr.emp cascade constraints purge;

-- ë‹¤ì‹œ
-- dept í…Œì´ë¸” ìƒì„±
create table hr.dept 
as
select department_id dept_id, department_name dept_name
from hr.departments;

-- emp í…Œì´ë¸” ìƒì„±
create table hr.emp
as select employee_id id, last_name name, salary sal, department_id dept_id
from hr.employees;

-- ì œì•½ ì¡°ê±´ ì¶”ê°€
alter table hr.dept add constraint deptid_pk primary key(dept_id);
alter table hr.emp add constraint empid_pk primary key(id);
alter table hr.emp add constraint emp_deptid_fk foreign key(dept_id) references hr.dept(dept_id);

select * from user_constraints where table_name in ('EMP','DEPT');

-- ê°ì²´ ê¶Œí•œ ë¶€ì—¬
grant select, insert, update, delete on hr.emp to sawon01, sawon02;
grant select, insert, update, delete on hr.dept to sawon01, sawon02;

select * from user_tab_privs where grantee in ('SAWON01','SAWON02');
```