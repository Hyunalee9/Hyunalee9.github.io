---
title: "[37ì¼ì°¨] íŠ¸ë¦¬ê±°"
excerpt: "ì•„ì´í‹°ìœŒ 0613_(3) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-13T18:37
---


ğŸ“ **Trigger (íŠ¸ë¦¬ê±°)**

- íŠ¸ë¦¬ê±°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ê³  ì§€ì •ëœ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” PLSQLë¸”ë¡ì´ë‹¤.
- ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì§€ì •ëœ ì¡°ê±´ì´ ë°œìƒí•  ë•Œ íŠ¸ë¦¬ê±°ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.
- íŠ¸ë¦¬ê±°ëŠ” í…Œì´ë¸”, ë·°, ìœ ì €ë ˆë²¨, ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì— ì •ì˜ë  ìˆ˜ ìˆë‹¤.
- íŠ¸ë¦¬ê±°ì˜ í¬ê¸°ëŠ”(í”„ë¡œê·¸ë¨ ì‚¬ì´ì¦ˆ) 32KBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ë‹¤.
- íŠ¸ë¦¬ê±°ë¥¼ ìƒì„±í•˜ë ¤ë©´ CREATE TRIGGER ì‹œìŠ¤í…œ ê¶Œí•œì´ í•„ìš”í•˜ë‹¤

ğŸ“ **íŠ¸ë¦¬ê±° ìœ í˜•**

â–¶ï¸ DML íŠ¸ë¦¬ê±° : íŠ¹ì • í…Œì´ë¸”, ë·°ì— insert, update, delete

â–¶ï¸ DDL íŠ¸ë¦¬ê±° : CREATE, ALTER, DROP, TRUNCATE

â–¶ï¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‹œì‘, ì¢…ë£Œ

â–¶ï¸ íŠ¹ì • ì˜¤ë¥˜ ë©”ì‹œì§€

â–¶ï¸ ìœ ì € ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ

ğŸ“ **DML ë¬¸ì¥ íŠ¸ë¦¬ê±°**

- DML ë¬¸ì¥ íŠ¸ë¦¬ê±°ëŠ” ì˜í–¥ì„ ë°›ì€ í–‰ì´ ì „í˜€ ì—†ë”ë¼ë„ ë¬¸ì¥ íŠ¸ë¦¬ê±°ëŠ” í•œë²ˆ ì‹¤í–‰í•œë‹¤.

ğŸ“ **DML í–‰ íŠ¸ë¦¬ê±°**

- DML í–‰ íŠ¸ë¦¬ê±°ëŠ” ì˜í–¥ì„ ë°›ì€ í–‰ì´ ì—†ì„ ê²½ìš°ì—ëŠ” íŠ¸ë¦¬ê±°ê°€ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ì˜í–¥ì„ ë°›ì€ ê° í–‰ì— ëŒ€í•´ì„œ íŠ¸ë¦¬ê±°ëŠ” ìˆ˜í–‰ëœë‹¤.
- FOR EACH ROW ì ˆì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

## before ë¬¸ì¥ íŠ¸ë¦¬ê±°

```sql
CREATE OR REPLACE TRIGGER hr.dept_before
BEFORE
INSERT ON hr.dept 
BEGIN dbms_output.put_line('insertí•˜ê¸° ì „ì— ë¬¸ì¥ íŠ¸ë¦¬ê±° ìˆ˜í–‰');
END dept_before;
/
```

ğŸ“ trigger invalid â†’ ë°˜ë“œì‹œ ì˜¤ë¥˜ í•´ê²°í•´ì•¼í•¨ ì•„ë‹˜ ê³„ì† ì˜¤ë¥˜ë‚¨.

## after ë¬¸ì¥ íŠ¸ë¦¬ê±°

```sql
CREATE OR REPLACE TRIGGER hr.dept_after
AFTER
INSERT ON hr.dept
BEGIN
	 dbms_output.put_line('insertí•œ í›„ì— ë¬¸ì¥ íŠ¸ë¦¬ê±° ìˆ˜í–‰');
END dept_after;
/
```

![image.png](/assets/20250613/2.png)

## í–‰ íŠ¸ë¦¬ê±°

## before row íŠ¸ë¦¬ê±°

```sql
CREATE OR REPLACE TRIGGER hr.dept_row_before
BEFORE
INSERT ON hr.dept
FOR EACH ROW
BEGIN
	 dbms_output.put_line('insertí•œ í›„ì— í–‰ íŠ¸ë¦¬ê±° ìˆ˜í–‰');
END dept_row_before;
/
```

## after row íŠ¸ë¦¬ê±°

```sql
CREATE OR REPLACE TRIGGER hr.dept_row_after
BEFORE
INSERT ON hr.dept
FOR EACH ROW
BEGIN
	 dbms_output.put_line('insertí•œ í›„ì— í–‰ íŠ¸ë¦¬ê±° ìˆ˜í–‰');
END dept_row_after;
/
```

![image.png](/assets/20250613/3.png)

ğŸ“ í…Œì´ë¸”ì— ê±¸ë ¤ìˆëŠ” trigger ëª… ì¡°íšŒ

```sql
SELECT *
FROM user_triggers WHERE table_name = 'DEPT';
```

![image.png](/assets/20250613/4.png)

ğŸ“source ì¡°íšŒ

```sql
SELECT text 
FROM user_source WHERE name = 'DEPT_AFTER' 
ORDER BY line;
```

ğŸ“ íŠ¸ë¦¬ê±° ì‚­ì œ

```sql
DROP TRIGGER  hr.dept_before;
DROP TRIGGER  hr.dept_dept_after;
DROP TRIGGER  hr.dept_row_before;
DROP  TRIGGER  hr.dept_row_after;
```

ğŸ“ íŠ¸ë¦¬ê±° í™œì„±í™”/ë¹„í™œì„±í™” ì¡°íšŒ

```sql
SELECT status FROM user_triggers WHERE trigger_name = 'DEPT_BEFORE';
```

â **ì£¼ì˜**

íŠ¸ë¦¬ê±° ìƒì„±ì‹œ ì»´íŒŒì¼ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆëŠ”ë° ë°©ì¹˜í–ˆì„ ê²½ìš° ëŒ€ìƒ í…Œì´ë¸” INSERT ì‘ì—…ì‹œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

![image.png](/assets/20250613/5.png)

ğŸ“ íŠ¸ë¦¬ê±°ë¥¼ ë¹„í™œì„±í™”

```sql
ALTER TRIGGER hr.dept_before DISABLE;

SELECT status FROM user_triggers WHERE trigger_name = 'DEPT_BEFORE';
```

![image.png](/assets/20250613/6.png)

```sql
CREATE OR REPLACE TRIGGER hr.secure_dept
BEFORE
INSERT OR UPDATE OR DELETE ON hr.dept
BEGIN
    IF (to_char(sysdate, 'hh24:mi') NOT BETWEEN '09:00' AND '16:00') OR (to_char(sysdate, 'dy') IN ('í† ', 'ì¼'))
    THEN 
        IF INSERTING THEN
           ------> ì¡°ê±´ë¶€ ìˆ ì–´.
            RAISE_APPLICATION_ERROR(-20000,'ì…ë ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.');
        ELSIF DELETING THEN
            RAISE_APPLICATION_ERROR(-20001, 'ì‚­ì œ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.');
        ELSIF UPDATING THEN
            RAISE_APPLICATION_ERROR(-20002, 'ìˆ˜ì • ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.');
        END IF;
        
    END IF;
END secure_dept;
/
```

ğŸ“ delete ì‹œë„ ì‹œ 

```sql
DELETE 
FROM hr.dept
WHERE department_id = 380;
```

![image.png](/assets/20250613/7.png)

ğŸ“ insert ì‹œë„ ì‹œ 

```sql
INSERT INTO hr.dept(department_id,department_name,manager_id,location_id)
VALUES(380, 'Data Architect', 100, 1500);
```

![image.png](/assets/20250613/8.png)

â–¶ï¸ ì¡°ê±´ë¶€ ìˆ ì–´ : insert, update, delete ì´ë²¤íŠ¸ì— ë”°ë¼ í‹€ë¦¬ê²Œ ë¡œì§ êµ¬í˜„ì„ ìˆ˜í–‰í•´ì•¼ í•  ê²½ìš°

inserting, updating, deleting ì¡°ê±´ë¶€ ìˆ ì–´ë¥¼ ì´ìš©í•´ì„œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

**í–‰ íŠ¸ë¦¬ê±° ì—°ìŠµ**

ğŸ“ OLD, NEW ìˆ˜ì‹ì

- DML í–‰ íŠ¸ë¦¬ê±°ì—ì„œ ì‚¬ìš©

| ë°ì´í„° ì‘ì—… | **ì´ì „ ê°’(OLD)** | **ìƒˆë¡œìš´ ê°’(NEW)** |
| --- | --- | --- |
| INSERT | NULL | ì…ë ¥ëœ ê°’ |
| DELETE | ì‚­ì œ ì „ ê°’ | NULL |
| UPDATE | ê°±ì‹  ì „ ê°’ | ê°±ì‹  í›„ ê°’ |

```sql
CREATE TABLE hr.copy_emp
AS
SELECT employee_id, last_name, salary, department_id
FROM hr.employees;
```

```sql
CREATE OR REPLACE TRIGGER hr.emp_trig
BEFORE                     
                           **--> ì—…ë°ì´íŠ¸ ì‹œì—ë§Œ ì‚¬ìš©**  
INSERT OR DELETE OR UPDATE OF salary ON hr.copy_emp
FOR EACH ROW                                                 
WHEN(NEW.department_id = 20 OR OLD.department_id = 10)
		---> ìˆ˜ì‹ì                 --> ìˆ˜ì‹ì       : ì—¬ê¸°ì„  ì½œë¡  ì‚¬ìš©í•˜ë©´ ì•ˆë¨.
															  --> DELETE, UPDATE 
DECLARE
    salary_diff number;
BEGIN
    IF DELETING THEN
        dbms_output.put_line('OLD SALARY : '|| :OLD.salary);
                                               -----> Begin ì ˆì—ì„œ ìˆ˜ì‹ìë¥¼ ì‚¬ìš©í•  ë•Œ : ë¶™ì„
    ELSIF INSERTING THEN
        dbms_output.put_line('NEW SALARY : '|| :NEW.salary);
    ELSE
        salary_diff := :NEW.salary - :OLD.salary;
        dbms_output.put_line(' ì‚¬ë²ˆ : '|| :OLD.employee_id);
        dbms_output.put_line(' ì´ì „ ê¸‰ì—¬ : '|| :OLD.salary);
        dbms_output.put_line(' ìˆ˜ì • ê¸‰ì—¬ : '|| :NEW.salary);
        dbms_output.put_line(' ê¸‰ì—¬ ì°¨ì´ : '||salary_diff);
    END IF;
END emp_trig;
/
```

â–¶ï¸ SQL PLUS

```sql
SQL> DELETE FROM hr.copy_emp WHERE department_id = 10;
-- OLD SALARY : 4400
```

```sql
UPDATE hr.copy_emp
SET salary = salary * 1.1
WHERE department_id = 20;
```

![image.png](/assets/20250613/9.png)

â–¶ï¸ íŠ¸ë¦¬ê±°ê°€ ëŒì•„ê°€ì§€ ì•ŠëŠ” ê²½ìš° : íŠ¹ì • ì»¬ëŸ¼ salary ê°’ì´ ìˆ˜ì •í•˜ëŠ” ê²½ìš°ì—ë§Œ íŠ¸ë¦¬ê±°ê°€ ëŒì•„ê°€ê¸° ë•Œë¬¸

```sql
UPDATE hr.copy_emp
SET last_name = 'ORACLE'
WHERE employee_id = 200; 
```