---
title: "[64일차] Backup & Recovery9"
excerpt: "아이티윌 0724"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-24T18:26
---

# 백업 & 리커버리 9

날짜: 2025년 7월 24일
유형: 64일차, archive, 백업리커버리
포트폴리오: 미완료

### 1. 오전 실습 — 정상 종료 후 컨트롤 파일 장애 복구

---

### 시나리오 1 — 백업 컨트롤 파일 이용 복구 (RESETLOGS)

**주요 명령어**

```bash
# 백업 컨트롤 파일 복사
cp /home/oracle/backup/arch/open/20250724/control01.ctl \
   /u01/app/oracle/oradata/ORA19C/

# MOUNT까지 기동
sqlplus / as sysdba
ALTER DATABASE MOUNT;

# 백업 컨트롤 파일 이용 복구
RECOVER DATABASE USING BACKUP CONTROLFILE;

# current redo log 경로 직접 입력 시 예시
/u01/app/oracle/oradata/ORA19C/redo01.log

# RESETLOGS로 오픈
ALTER DATABASE OPEN RESETLOGS;

```

---

### 시나리오 2 — 컨트롤 파일 재생성 (NO RESETLOGS)

**주요 명령어**

```sql
-- 컨트롤 파일 트레이스 생성
ALTER DATABASE BACKUP CONTROLFILE TO TRACE AS '/home/oracle/create_control.txt';

-- DB 종료
SHUTDOWN ABORT;

-- NOMOUNT → 컨트롤 파일 생성
STARTUP NOMOUNT;
@/home/oracle/create_control.txt   -- NORESETLOGS로 수정된 스크립트 실행

-- TEMPFILE 재등록
ALTER TABLESPACE TEMP ADD TEMPFILE '/u01/app/oracle/oradata/ORA19C/temp01.dbf' REUSE;

```

---

### 시나리오 3 — 비정상 종료 후 컨트롤 파일 재생성 (RECOVER 필요)

**주요 명령어**

```bash
# 백업 컨트롤 파일 복사
cp /home/oracle/backup/arch/open/20250724/control01.ctl \
   /u01/app/oracle/oradata/ORA19C/

# NOMOUNT → 컨트롤 파일 생성
STARTUP NOMOUNT;
@/home/oracle/create_control.txt   -- NORESETLOGS

# 복구 수행
RECOVER DATABASE;

# DB 오픈
ALTER DATABASE OPEN;

# TEMPFILE 재등록
ALTER TABLESPACE TEMP ADD TEMPFILE '/u01/app/oracle/oradata/ORA19C/temp01.dbf' REUSE;

```

---

### 시나리오 4 — 구조 변경 후 컨트롤 파일 재생성

**주요 명령어**

```sql
-- 백업 컨트롤 파일로 MOUNT
STARTUP MOUNT;

-- 컨트롤 파일 트레이스 생성
ALTER DATABASE BACKUP CONTROLFILE TO TRACE AS '/home/oracle/control_new.txt';

-- DB 종료 후 NOMOUNT
SHUTDOWN ABORT;
STARTUP NOMOUNT;

-- CREATE CONTROLFILE 구문에 신규 DATAFILE 경로 추가
@/home/oracle/control_new.txt

-- DB 오픈
ALTER DATABASE OPEN;

-- TEMPFILE 재등록
ALTER TABLESPACE TEMP ADD TEMPFILE '/u01/app/oracle/oradata/ORA19C/temp01.dbf' REUSE;

```

---

### 2. 오후 실습 — 복합 장애 및 특수 복구

---

### 모든 데이터파일 + 컨트롤 파일 손상

```bash
# 백업본 복사
cp /home/oracle/backup/arch/open/20250724/*.{ctl,dbf} \
   /u01/app/oracle/oradata/ORA19C/

# MOUNT
STARTUP MOUNT;

# 복구
RECOVER DATABASE USING BACKUP CONTROLFILE;

# current redo 경로 직접 입력
/u01/app/oracle/oradata/ORA19C/redo01.log

# 오픈
ALTER DATABASE OPEN RESETLOGS;

```

---

### 모든 리두로그 + 컨트롤 파일 손상

```bash
# 백업본 복사
cp /home/oracle/backup/arch/open/20250724/*.{ctl,dbf} \
   /u01/app/oracle/oradata/ORA19C/

# MOUNT
STARTUP MOUNT;

# 불완전 복구
RECOVER DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL;
CANCEL;

# 오픈
ALTER DATABASE OPEN RESETLOGS;

```

---

### Point-in-Time Recovery (PITR)

```sql
-- 목표 시간 예시: 2025-07-24 15:40:00
SHUTDOWN ABORT;

-- 백업본 복사
cp /home/oracle/backup/arch/open/20250724/*.{ctl,dbf} \
   /u01/app/oracle/oradata/ORA19C/

-- MOUNT
STARTUP MOUNT;

-- 시간 기준 복구
RECOVER DATABASE USING BACKUP CONTROLFILE UNTIL TIME '2025-07-24 15:40:00';
AUTO;

-- current redo 요청 시 직접 입력
/u01/app/oracle/oradata/ORA19C/redo02.log

-- 오픈
ALTER DATABASE OPEN RESETLOGS;

```

---

### 3. LogMiner 분석 절차

```sql
-- 보조 로그 활성화
ALTER DATABASE ADD SUPPLEMENTAL LOG DATA;

-- 로그파일 등록
BEGIN
  DBMS_LOGMNR.ADD_LOGFILE(
    LOGFILENAME => '/u01/app/oracle/oradata/ORA19C/redo01.log',
    OPTIONS     => DBMS_LOGMNR.NEW);
  DBMS_LOGMNR.ADD_LOGFILE(
    LOGFILENAME => '/u01/app/oracle/oradata/ORA19C/redo02.log',
    OPTIONS     => DBMS_LOGMNR.ADDFILE);
END;
/

-- 분석 시작
EXECUTE DBMS_LOGMNR.START_LOGMNR(OPTIONS => DBMS_LOGMNR.DICT_FROM_ONLINE_CATALOG);

-- 분석 결과 확인
SELECT TIMESTAMP, OPERATION, SQL_REDO, SQL_UNDO
FROM V$LOGMNR_CONTENTS
WHERE SEG_NAME = 'ITWILL';

-- 분석 종료
EXECUTE DBMS_LOGMNR.END_LOGMNR;

```

---

### 4. 공통 주의사항

- 데이터베이스 구조 변경 직후 컨트롤 파일 백업 또는 트레이스 생성 필수
- RESETLOGS 이후에는 반드시 새로운 백업 생성
- 비정상 종료 시 `RECOVER DATABASE` 과정 필수
- current redo 요청 시 alert.log에서 경로 확인 후 입력