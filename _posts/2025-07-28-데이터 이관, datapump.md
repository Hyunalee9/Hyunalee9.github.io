---
title: "Îç∞Ïù¥ÌÑ∞ Ïù¥Í¥Ä Ïãú ÏÇ¨Ïö©ÌïòÎäî datapump"
excerpt: "ÏïÑÏù¥Ìã∞Ïúå 0728"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-28T17:03
---

## Data Migration(Îç∞Ïù¥ÌÑ∞ Ïù¥Í¥Ä)

- Ìïú ÏãúÏä§ÌÖúÏóêÏÑú Îã§Î•∏ ÏãúÏä§ÌÖúÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Î•º Ïù¥ÎèôÏãúÌÇ§Îäî ÌîÑÎ°úÏÑ∏Ïä§

## dbms_metadata(Îç∞Ïù¥ÌÑ∞ Ïù¥Í¥Ä ÏûëÏóÖÌï† Îïå Ïù¥Ïö©)

- Ïù¥ Ìå®ÌÇ§ÏßÄÎäî Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ dictionaryÏóêÏÑú Î©îÌÉÄ Îç∞Ïù¥ÌÑ∞Î•º xml, ddlÌòïÌÉúÎ°ú Í≤ÄÏÉâÌïòÍ≥† Ï∂îÏ∂úÌï¥ÏÑú Îã§Ïãú ÏÉùÏÑ±ÌïòÎäî Î∞©Î≤ïÏùÑ Ï†úÍ≥µÌïúÎã§.

```sql
select dbms_metadata.get_ddl('user','hr') from dual;

-- ÎßåÏïΩ ÏïÑÎûòÏùò Ïò§Î•òÍ∞Ä Î∞úÏÉùÌïúÎã§Î©¥

ERROR:
ORA-31600: invalid input value user for parameter OBJECT_TYPE in function GET_DDL
ORA-06512: at "SYS.DBMS_METADATA", line 6731
ORA-06512: at "SYS.DBMS_METADATA", line 6516
ORA-06512: at "SYS.DBMS_SYS_ERROR", line 105
ORA-06512: at "SYS.DBMS_METADATA_INT", line 4166
ORA-06512: at "SYS.DBMS_METADATA_INT", line 4643
ORA-06512: at "SYS.DBMS_METADATA_INT", line 9660
ORA-06512: at "SYS.DBMS_METADATA", line 6459
ORA-06512: at "SYS.DBMS_METADATA", line 6572
ORA-06512: at "SYS.DBMS_METADATA", line 9734
ORA-06512: at line 1

-- ÎåÄÎ¨∏ÏûêÎ°ú ÏãúÌñâ
-- Ïú†Ï†Ä ÏÉùÏÑ± Ï†ïÎ≥¥ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï∂î
select dbms_metadata.get_ddl('USER','HR') from dual;

DBMS_METADATA.GET_DDL('USER','HR')
--------------------------------------------------------------------------------

   CREATE USER "HR" IDENTIFIED BY VALUES 'S:B2F1F7A064CCCABED4E2CBE13307C7BE7773
B269ED09396BAB1776D2B38D;T:C9BD89A825F27B9CF148E9CEFD1D7BACBEF198F9535D3A29AB186
BF1CBFAA5344A827872231BE4E89C1A84FE8F8A1AED958A121D7521F659175782E8F69C79DBEA647
652BD4F5F310FF0733332B17B37'
      DEFAULT TABLESPACE "SYSAUX"
      TEMPORARY TABLESPACE "TEMP"

-- ‚ñ∂Ô∏è Ïù¥Î†áÍ≤å Î≥ÄÌôòÌïòÏûê
   CREATE USER "HR" 
   IDENTIFIED BY VALUES oracle
      DEFAULT TABLESPACE "SYSAUX"
      TEMPORARY TABLESPACE "TEMP";
  
  -- HR Ïú†Ï†Ä Ï†ïÎ≥¥ Î≥¥Í∏∞
  select * from dba_users where username = 'HR';
  
  -- Ïú†Ï†ÄÌïúÌÖå Î∂ÄÏó¨Ìïú ÏãúÏä§ÌÖú Í∂åÌïú
  select * from dba_sys_privs where grantee = 'HR';
  
  -- HR Ïú†Ï†ÄÏóêÍ≤å Î∂ÄÏó¨Îêú ÏãúÏä§ÌÖú Í∂åÌïúÏùÑ Ï∂îÏ∂úÌï¥ÏÑú Í∂åÌïú Î∂ÄÏó¨ÌïòÎäî SQL Î¨∏ÏùÑ ÎΩëÏïÑÏ§ÄÎã§.
  select dbms_metadata.get_granted_ddl('SYSTEM_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('SYSTEM_GRANT','HR')
--------------------------------------------------------------------------------

  GRANT CREATE SESSION TO "HR"
  GRANT ALTER SESSION TO "HR"
  GRANT UNLIMITED TABLESPACE TO "HR"
  GRANT CREATE SYNONYM TO "HR"
  GRANT CREATE VIEW TO "HR"
  GRANT CREATE SEQUENCE TO "HR"
  GRANT CREATE DATABASE LINK TO "HR"
  
  -- Ïú†Ï†ÄÌïúÌÖå Î∂ÄÏó¨Ìïú Í∞ùÏ≤¥ Í∂åÌïú
  select * from dba_tab_privs where grantee = 'HR';
  select dbms_metadata.get_granted_ddl('OBJECT_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('OBJECT_GRANT','HR')
--------------------------------------------------------------------------------

  GRANT EXECUTE ON "SYS"."DBMS_STATS" TO "HR"

  
  -- Ïú†Ï†ÄÌïúÌÖå Î∂ÄÏó¨Ìïú Î°§
  select * from dba_role_privs where grantee = 'HR';
  select dbms_metadata.get_granted_ddl('ROLE_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('ROLE_GRANT','HR')
--------------------------------------------------------------------------------

   GRANT "RESOURCE" TO "HR"

-- Ïú†Ï†ÄÌïúÌÖå Î∂ÄÏó¨Ìïú ÌÖåÏù¥Î∏îÏä§ÌéòÏù¥Ïä§ QUOTA

select * from dba_ts_quotas where username = 'HR';
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'HR') from dual;

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','HR')
--------------------------------------------------------------------------------
	DECLARE
	  TEMP_COUNT NUMBER;
    SQLSTR VARCHAR2(200);
  BEGIN
	  --Ïú†Ï†ÄÍ∞Ä ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî quota Í∞í : unlimited
	  SQLSTR := 'ALTER USER "HR" QUOTA UNLIMITED ON "SYSAUX"'; 
  EXECUTE IMMEDIATE SQLSTR; -- SQLSTRÏóê ÏûàÎäî SQL Î¨∏Ïû•ÏùÑ ÏàòÌñâÌïòÎäî Î™ÖÎ†πÏñ¥.
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
	    -- dynamic sql Î¨∏Ïû•
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
              WHERE TABLESPACE_NAME = ''SYSAUX'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;  -- FETCH ÏàòÌñâ 
      IF TEMP_COUNT = 1 THEN RETURN; -- Í∞íÏù¥ ÏóÜÎäî return; (Ï¢ÖÎ£å)
      ELSE RAISE; -- Ïò§Î•ò Î∞úÏÉù 
      END IF;
    ELSE
      RAISE;
    END IF;
END;

alter user hr quota 10m on users;
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'HR') from dual;

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','HR')
--------------------------------------------------------------------------------
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "HR" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
              WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
          ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;
```

## Export, Import utility

- export utilityÎäî Ïò§ÎùºÌÅ¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Í∞Ä ÏÑúÎ°ú Îã§Î•∏ ÌïòÎìúÏõ®Ïñ¥ Î∞è ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Íµ¨ÏÑ±ÏùÑ ÏÇ¨Ïö©ÌïòÎäî ÌîåÎû´ÌèºÏóê ÏÉÅÏ£ºÌïòÎçîÎùºÎèÑ Ïù¥Îü∞ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í∞ÑÏóê Îç∞Ïù¥ÌÑ∞ Í∞ùÏ≤¥Î•º Ïù¥ÎèôÌï† Ïàò ÏûàÎäî Î∞©Î≤ïÏùÑ Ï†úÍ≥µ
- import utility Îäî export dump file ÏóêÏÑú Í∞ùÏ≤¥ Ï†ïÏùòÏôÄ ÌÖåÏù¥Î∏î Îç∞Ïù¥ÌÑ∞Î•º ÏùΩÏñ¥ÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ùÏ≤¥Î•º Ïò§ÎùºÌÅ¥ Îç∞Ïù¥ÌÑ∞Ïóê ÏûÖÎ†•ÌïúÎã§.

‚ñ∂Ô∏è Î∞ëÏûëÏóÖ

```sql
drop table hr.emp purge;
create table hr.emp tablespace users as select * from hr.employees;
alter table hr.emp add constraint empid_pk primary key(employee_id);

-- Ï†úÏïΩÏ°∞Í±¥ Ï°∞Ìöå
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'HR'
  and table_name = 'EMP';
```

‚ñ∂Ô∏è hr.emp ÌÖåÏù¥Î∏î export

```sql
SYS@ora19c> ! exp userid=system/oracle tables=hr.emp file=hr_emp.dmp statistics=none

--> ÎßåÏïΩÏóê ÎπÑÎ∞ÄÎ≤àÌò∏ ÏóêÎü¨ÎÇúÎã§Î©¥
-- alter user system identified expired; (Ï†ïÌôïÌûà Ïù¥Í≤å ÎßûÎäîÏßÄ ÌôïÏù∏ ÌïÑÏöî)

Export: Release 19.0.0.0.0 - Production on Mon Jul 28 10:47:21 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.
```

‚ñ∂Ô∏è ÏûòÎ™ªÌï¥ÏÑú ÌäπÏ†ï ÌÖåÏù¥Î∏î ÏÇ≠Ï†ú

```sql
drop table hr.emp purge;
select * from hr.emp; -- Ïò§Î•òÎÇúÎã§.
```

‚ñ∂Ô∏è export Î∞õÏùÄ dump file ÏùÑ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ import

```sql
! imp userid = system/oracle file=hr_emp.dmp fromuser=hr

Export file created by EXPORT:V19.00.00 via conventional path
import done in US7ASCII character set and AL16UTF16 NCHAR character set
import server uses AL32UTF8 character set (possible charset conversion)
IMP-00403:

Warning: This import generated a separate SQL file "import_sys" which contains DDL that failed due to a privilege issue.

. importing SYSTEM's objects into SYSTEM
. importing HR's objects into HR
. . importing table                          "EMP"        107 rows imported
Import terminated successfully with warnings.

```

‚ñ∂Ô∏è ÏûòÎ™ªÌï¥ÏÑú ÌÖåÏù¥Î∏î truncateÌñàÎã§.

```sql
truncate table hr.emp;
select * from hr.emp; 
```

‚ñ∂Ô∏è Îç∞Ïù¥ÌÑ∞Îßå import 

```sql
! imp userid = system/oracle file=hr_emp.dmp fromuser=hr tables=emp data_only=y

-- ÌôïÏù∏ Ïûë
SYS@ora19c> select count(*) from hr.emp;

  COUNT(*)
----------
       107

```

‚ñ∂Ô∏è Ïú†Ï†Ä ÏÉùÏÑ±

üìç fromuser : Ïú†Ï†ÄÏóê ÏÜçÌïú Î™®Îì† Í∞ùÏ≤¥

üìç touser : import ÎåÄÏÉÅÏù¥ Îê† Ïú†Ï†Ä

```sql
SYS@ora19c> create user minha identified by oracle default tablespace users quota 10m on users;
User created.

SYS@ora19c> grant create session to minha;
Grant succeeded.

-- exp Îç§ÌîÑ ÌååÏùºÏùÑ Îã§Î•∏ Ïú†Ï†Ä(minha)Î°ú ÏûÑÌè¨Ìä∏
! imp userid=system/oracle file=hr_emp.dmp fromuser=hr touser=minha

SYS@ora19c> conn minha/oracle
Connected.

MINHA@ora19c> select count(*) from minha.emp;

            COUNT(*)
--------------------
                 107
                 
-- Ï†úÏïΩÏ°∞Í±¥ Ï°∞Ìöå
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'MINHA'
  and table_name = 'EMP';
```

‚ñ∂Ô∏è Ïú†Ï†Ä Î†àÎ≤® export

```sql
! exp userid=system/oracle owner=minha file=minha.dmp

Export: Release 19.0.0.0.0 - Production on Mon Jul 28 11:06:35 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
Export done in US7ASCII character set and AL16UTF16 NCHAR character set
server uses AL32UTF8 character set (possible charset conversion)

About to export specified users ...
. exporting pre-schema procedural objects and actions
. exporting foreign function library names for user MINHA
. exporting PUBLIC type synonyms
. exporting private type synonyms
. exporting object type definitions for user MINHA
About to export MINHA's objects ...
. exporting database links
. exporting sequence numbers
. exporting cluster definitions
. about to export MINHA's tables via Conventional Path ...
. . exporting table                            EMP        107 rows exported
EXP-00091: Exporting questionable statistics.
. exporting synonyms
. exporting views
. exporting stored procedures
. exporting operators
. exporting referential integrity constraints
. exporting triggers
. exporting indextypes
. exporting bitmap, functional and extensible indexes
. exporting posttables actions
. exporting materialized views
. exporting snapshot logs
. exporting job queues
. exporting refresh groups and children
. exporting dimensions
. exporting post-schema procedural objects and actions
. exporting statistics
Export terminated successfully with warnings.

select dbms_metadata.get_ddl('USER','MINHA') from dual;

DBMS_METADATA.GET_DDL('USER','MINHA')
--------------------------------------------------------------------------------

   CREATE USER "MINHA" IDENTIFIED BY VALUES 'S:478FC41957ACC3DDA22D9778FFB9AAA14
9A5C13E075566C5635C1B25117F;T:E5B69B5207E6647D4D184CFFF17A776D8BBB246CE4A49FD18B
F3CBF0275E711FF71C286E224D2EBDCF678BD71DD0C3FB669FB03CDAC1F3ED9D01C24BAB853A2571
B3A5FEB497D40476C3BE6E789F5063'
      DEFAULT TABLESPACE "USERS"
      TEMPORARY TABLESPACE "TEMP"

select dbms_metadata.get_granted_ddl('SYSTEM_GRANT', 'MINHA') from dual;

DBMS_METADATA.GET_GRANTED_DDL('SYSTEM_GRANT','MINHA')
--------------------------------------------------------------------------------

  GRANT CREATE SESSION TO "MINHA"

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','MINHA')
--------------------------------------------------------------------------------
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'MINHA') from dual;

  DECLARE
  TEMP_COUNT NUMBER;
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "MINHA" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
                    WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
      ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;

```

‚ñ∂Ô∏è Ïú†Ï†Ä minha ÏûòÎ™ªÌï¥ÏÑú ÏÇ≠Ï†ú.

```sql
drop user minha cascade;
```

‚ñ∂Ô∏è Ïú†Ï†Ä ÏÉùÏÑ±, Í∂åÌïú Î∂ÄÏó¨

```sql
CREATE USER "MINHA" IDENTIFIED BY oracle
  DEFAULT TABLESPACE "USERS"
  TEMPORARY TABLESPACE "TEMP";
  
 
  GRANT CREATE SESSION TO "MINHA" ;
  
  
    DECLARE
  TEMP_COUNT NUMBER;
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "MINHA" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
                    WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
      ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;
/

select * from dba_users where username='MINHA';
select * from dba_sys_privs where grantee='MINHA';
select * from dba_ts_quotas where username='MINHA';
```

‚ñ∂Ô∏è minha ÏÜåÏú†Ïùò Í∞ùÏ≤¥Î•º import

```sql
! imp userid=system/oracle file=minha.dmp fromuser=minha

select count(*) from minha.emp;

-- Ï†úÏïΩÏ°∞Í±¥ Ï°∞Ìöå
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'MINHA'
  and table_name = 'EMP';
```

‚ñ∂Ô∏è insa tablespace ÏÉùÏÑ±

```sql
create tablespace insa_tbs datafile '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' size 10m;
select tablespace_name, file_name from dba_data_files;

select dbms_metadata.get_ddl('TABLESPACE','INSA_TBS') from dual;

DBMS_METADATA.GET_DDL('TABLESPACE','INSA_TBS')
--------------------------------------------------------------------------------

  CREATE TABLESPACE "INSA_TBS" DATAFILE
  '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' SIZE 10485760
  LOGGING ONLINE PERMANENT BLOCKSIZE 8192
  EXTENT MANAGEMENT LOCAL AUTOALLOCATE DEFAULT
 NOCOMPRESS  SEGMENT SPACE MANAGEMENT AUTO;

create table hr.insa tablespace insa_tbs as select * from hr.employees;

SELECT f.tablespace_name, f.file_name
FROM dba_extents e, dba_data_files f
WHERE e.file_id = f.file_id
  AND e.segment_name = 'INSA'
  AND e.owner = 'HR';

```

‚ñ∂Ô∏è ÌÖåÏù¥Î∏îÏä§ÌéòÏù¥Ïä§ Î†àÎ≤® export

```sql
! exp userid=system/oracle file=insa_tbs.dmp tablespaces=insa_tbs

! ls -l insa_tbs.dmp
```

‚ñ∂Ô∏è insa_tbs ÏûòÎ™ª ÏÇ≠Ï†ú

```sql
drop tablespace insa_tbs including contents and datafiles;
```

‚ñ∂Ô∏è Ïä§ÌÇ§Îßà ÏÉùÏÑ±Ìï¥ÎÜìÏùÄ Í≤É ÏÇ¨Ïö©

```sql
  CREATE TABLESPACE "INSA_TBS" DATAFILE
  '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' SIZE 10485760
  LOGGING ONLINE PERMANENT BLOCKSIZE 8192
  EXTENT MANAGEMENT LOCAL AUTOALLOCATE DEFAULT
 NOCOMPRESS  SEGMENT SPACE MANAGEMENT AUTO;

SYS@ora19c> select tablespace_name, file_name from dba_data_files;

TABLESPACE_NAME                FILE_NAME
------------------------------ -------------------------------------------------
SYSTEM                         /u01/app/oracle/oradata/ORA19C/system01.dbf
SYSAUX                         /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
INSA_TBS                       /u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf
USERS                          /u01/app/oracle/oradata/ORA19C/users01.dbf
UNDOTBS1                       /u01/app/oracle/oradata/ORA19C/undotbs01.dbf

```

‚ñ∂Ô∏è export Î∞õÏïÑÎÜìÏùÄ Í≤É import

```sql
-- Ïù¥Í±∞ Îã§Ïãú 
! imp userid=system/oracle file=insa_tbs.dmp tablespaces=insa_tbs touser=insa

-- ÌÖåÏä§Ìä∏ Ïö©Ïù¥ÏóàÏúºÎãà drop
drop tablespace insa_tbs including contents and datafiles;

```

## Data Pump

- Ìïú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏóêÏÑú Îã§Î•∏ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î°ú Îç∞Ïù¥ÌÑ∞ÏôÄ Î©îÌÉÄ Îç∞Ïù¥ÌÑ∞Î•º Îß§Ïö∞ Îπ†Î•∏ ÏÜçÎèÑÎ°ú Ïù¥ÎèôÌï† Ïàò ÏûàÎäî Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌïúÎã§.

‚ñ∂Ô∏è ÎÖºÎ¶¨Ï†Å ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±

```sql
SYS@ora19c> ! pwd
/home/oracle

SYS@ora19c> ! mkdir data_pump
SYS@ora19c> ! ls /home/oracle/data_pump -- Ïù¥ ÏúÑÏπòÏóê dump ÌååÏùº ÏÉùÏÑ±

-- ÎÖºÎ¶¨Ï†Å ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±
create directory pump_dir as '/home/oracle/data_pump';

select * from dba_directories where directory_name='PUMP_DIR';

/*
SYS	PUMP_DIR	/home/oracle/data_pump	0
*/
```

‚ñ∂Ô∏è ÎÖºÎ¶¨Ï†Å ÎîîÎ†âÌÜ†Î¶¨Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Í∞ùÏ≤¥ Í∂åÌïú Î∂ÄÏó¨

```sql
grant read,write on directory pump_dir to hr;
select * from dba_tab_privs where grantee='HR';

/*
HR	SYS	DBMS_STATS	SYS	EXECUTE	NO	NO	NO	PACKAGE	NO
HR	SYS	PUMP_DIR	  SYS	READ	  NO	NO	NO	DIRECTORY	NO
HR	SYS	PUMP_DIR	  SYS	WRITE	  NO	NO	NO	DIRECTORY	NO
*/
```

‚ñ∂Ô∏è Ïú†Ï†Ä Î†àÎ≤® export

```sql
-- HR Ïú†Ï†ÄÏóê ÎåÄÌïú Í∞ùÏ≤¥Îì§ÏùÑ Ï†ÑÎ∂Ä export Î∞õÏùå
! expdp system/oracle schemas=hr directory=pump_dir dumpfile=hr_schema.dmp

-- ÌôïÏù∏ ÏûëÏóÖ
SYS@ora19c> ! ls -l /home/oracle/data_pump/hr_schema.dmp
-rw-r-----. 1 oracle oinstall 864256 Jul 28 12:11 /home/oracle/data_pump/hr_schema.dmp
```

‚ñ∂Ô∏è emp ÌÖåÏù¥Î∏î ÏûòÎ™ª ÏÇ≠Ï†ú

```sql
SYS@ora19c> drop table hr.emp purge;

Table dropped.

SYS@ora19c> select * from hr.emp;
select * from hr.emp
                 *
ERROR at line 1:
ORA-00942: table or view does not exist
```

‚ñ∂Ô∏è import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_schema.dmp tables=hr.emp

-- ÌôïÏù∏
SYS@ora19c> select count(*) from hr.emp;

  COUNT(*)
----------
       107

select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'HR'
  and table_name = 'EMP';
```

‚ñ∂Ô∏è table level export

```sql
! expdp system/oracle schemas=hr directory=pump_dir dumpfile=hr_table.dmp include=table
! ls -l /home/oracle/data_pump

total 1604
-rw-r--r--. 1 oracle oinstall   2283 Jul 28 13:50 export.log
-rw-r-----. 1 oracle oinstall 864256 Jul 28 12:11 hr_schema.dmp
-rw-r-----. 1 oracle oinstall 765952 Jul 28 13:50 hr_table.dmp
-rw-r--r--. 1 oracle oinstall   1059 Jul 28 12:15 import.log
```

‚ñ∂Ô∏è Ïú†Ï†Ä ÏÉùÏÑ±

```sql
create user james
identified by oracle
default tablespace sysaux
quota unlimited on sysaux;

grant create session to james;

select default_tablespace, temporary_tablespace from dba_users where username='JAMES';

DEFAULT_TABLESPACE             TEMPORARY_TABLESPACE
------------------------------ ------------------------------
SYSAUX                         TEMP

```

‚ñ∂Ô∏è hr.emp ‚Üí james.emp : ÏÜåÏú†Í∂å Î≥ÄÍ≤Ω remap_schema=‚Äôhr‚Äô : ‚Äòjames‚Äô 

‚ñ∂Ô∏è hr.emp : users ‚Üí james.emp sysaux : ÌÖåÏù¥Î∏îÏä§ÌéòÏù¥Ïä§ Î≥ÄÍ≤Ω remap_tablespace -‚Äôusers‚Äô:‚Äôsysaux‚Äô

```sql
select dbms_metadata.get_ddl('TABLE','EMP','HR') from dual;

 ! impdp system/oracle directory=pump_dir dumpfile=hr_table.dmp tables=hr.emp remap_schema='hr':'james' remap_tablespace='users':'sysaux'
 
```

‚ñ∂Ô∏è hr.employees, hr.departments, hr.locations ‚Üí james.employees, james.departments, james.locations

‚ñ∂Ô∏è trigger, ref_constraint Ï†úÏô∏

```sql
 select table_name, tablespace_name from dba_tables where owner ='HR'
 
 -- sys ÏÑ∏ÏÖò
 ! impdp system/oracle directory=pump_dir dumpfile=hr_table.dmp tables=hr.employees, hr.departments, hr.locations remap_schema='hr':'james' exclude=trigger,ref_constraint
```

‚ñ∂Ô∏è ÌôïÏù∏

```sql
SELECT table_name, 
       constraint_name, 
       constraint_type, 
       search_condition, 
       r_constraint_name, 
       status, 
       index_name
FROM dba_constraints
WHERE owner = 'HR'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
    
SELECT table_name, 
       constraint_name, 
       constraint_type, 
       search_condition, 
       r_constraint_name, 
       status, 
       index_name
FROM dba_constraints
WHERE owner = 'JAMES'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
  
SELECT *
FROM dba_triggers
WHERE owner = 'HR'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
  
SELECT *
FROM dba_triggers
WHERE owner = 'JAMES'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
```

## Ïú†Ï†ÄÎì§Ïù¥ ÏÜåÏú†Ìïú ÌäπÏ†ïÌïú ÌÖåÏù¥Î∏îÏóê ÎåÄÌï¥ÏÑú export

```sql
! expdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.employees, hr.departments, hr.job_history, james.emp

-- ÌôïÏù∏
! ls -l /home/oracle/data_pump/hr_james_table.dmp
-rw-r-----. 1 oracle oinstall 442368 Jul 28 14:43 /home/oracle/data_pump/hr_james_table.dmp

```

‚ñ∂Ô∏è ÌÖåÏù¥Î∏î ÏÇ≠Ï†ú

```sql
drop table hr.job_history purge;
select * from hr.job_history;
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history

select count(*) from hr.job_history;
  COUNT(*)
----------
        10

select constraint_name, constraint_type, search_condition, status, index_name
from dba_constraints
where table_name = 'JOB_HISTORY'
and owner = 'HR';

/*

JHIST_JOB_FK	R		ENABLED	
JHIST_EMP_FK	R		ENABLED	
JHIST_DEPT_FK	R		ENABLED	
JHIST_EMPLOYEE_NN	C	"EMPLOYEE_ID" IS NOT NULL	ENABLED	
JHIST_START_DATE_NN	C	"START_DATE" IS NOT NULL	ENABLED	
JHIST_END_DATE_NN	C	"END_DATE" IS NOT NULL	ENABLED	
JHIST_JOB_NN	C	"JOB_ID" IS NOT NULL	ENABLED	
JHIST_DATE_INTERVAL	C	end_date > start_date	ENABLED	
JHIST_EMP_ID_ST_DATE_PK	P		ENABLED	JHIST_EMP_ID_ST_DATE_PK

*/
```

‚ñ∂Ô∏è ÏûòÎ™ªÌï¥ÏÑú truncate Ìï¥Î≤ÑÎ†∏Îã§.

```sql
truncate table hr.job_history;
select count(*) from hr.job_history;
  COUNT(*)
----------
         0
```

‚ñ∂Ô∏è Îç∞Ïù¥ÌÑ∞Îßå import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history content=data_only

select count(*) from hr.job_history;

```

‚ñ∂Ô∏è Îã§Ïãú drop

```sql
drop table hr.job_history;
```

‚ñ∂Ô∏è content=metadata_only : ÌÖåÏù¥Î∏î Íµ¨Ï°∞ (Î©îÌÉÄ Ï†ïÎ≥¥) import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history content=metadata_only

desc hr.job_history;

select count(*) from hr.job_history;
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history
content=data_only
```

‚ñ∂Ô∏è Ï°∞Í±¥Ï†àÏóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Îßå export

```sql
select * from hr.employees where department_id=50 and job_id = 'ST_MAN';
! expdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.employees query=hr.employees:"where department_id=50 and job_id='ST_MAN'"
```

‚ñ∂Ô∏è ÌÖåÏù¥Î∏î ÏÉùÏÑ±

```sql
create table hr.emp_50_stman tablespace users as select * from hr.employees where 1 = 2 ;
select * from hr.emp_50_stman;
```

‚ñ∂Ô∏è employees ‚Üí emp_50_stman ÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp remap_table=employees:emp_50_stman content=data_only
```

‚ñ∂Ô∏è Í∏∞Ï°¥ dump ÏßÄÏõÄ

```sql
select * from hr.emp_50_stman;
! rm /home/oracle/data_pump/hr_50_stman.dmp
```

‚ñ∂Ô∏è export

```sql
! expdp system/oracle/ directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp50_stman
! impdp system/oracle/ directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp50_stman
```

‚ñ∂Ô∏è importÏãúÏóê ÎèôÏùºÌïú Ïù¥Î¶ÑÏúºÎ°ú ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ skip

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=skip
```

‚ñ∂Ô∏è importÏãúÏóê ÎèôÏùºÌïú Ïù¥Î¶ÑÏúºÎ°ú ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞Ä(append)

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=append

-- ÌôïÏù∏
select count(*) from hr.emp_50_stman;
```

‚ñ∂Ô∏è importÏãúÏóê ÎèôÏùºÌïú Ïù¥Î¶ÑÏúºÎ°ú ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïú ÌõÑ ÏûÖÎ†•

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=truncate
```

‚ñ∂Ô∏è importÏãúÏóê ÎèôÏùºÌïú Ïù¥Î¶ÑÏúºÎ°ú ÌÖåÏù¥Î∏îÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†ú(drop) Ìïú ÌõÑ ÏûÖÎ†•

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=replace
```

## DB Ï†ÑÏ≤¥ export

```sql
! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full.dmp job_name=job1

sqlplus / as sysdba
SELECT owner_name, job_name, operation, job_mode, state
FROM dba_datapump_jobs;

> Ctrl+C
> Status
```

![image.png](/assets/20250728/1.png)

‚ñ∂Ô∏è ÏùºÏãú Ï§ëÏßÄÎêú ÏûëÏóÖÏùÑ ÏàòÌñâ

‚ñ∂Ô∏è Ïû¨Ï†ëÏÜç , attach=owner_name, job_name

```sql
! expdp system/oracle attach=system.job1
```

‚ñ∂Ô∏è ÏûëÏóÖÏùÑ Îã§Ïãú ÏßÑÌñâ

```sql
Export> start_job

select owner_name,job_name, operation, job_mode, state from dba_datapump_jobs;

OWNER_NAME  JOB_NAME   OPERATION  JOB_MODE  STATE
----------- ---------- ---------- --------- ----------
SYSTEM      JOB1       EXPORT     FULL      EXECUTING  --> ÏßÑÌñâÏ§ë

SYS@ora19c> select owner_name, job_name, operation, job_mode, state from dba_datapump_jobs;

OWNER_NAME  JOB_NAME   OPERATION  JOB_MODE  STATE
----------- ---------- ---------- --------- ----------
SYSTEM      JOB1       EXPORT     FULL      COMPLETING  --> ÏôÑÎ£åÎêòÎäî ÏÉÅÌÉú

 select owner_name, job_name, operation, job_mode, state from dba_datapump_jobs; --> ÏôÑÎ£åÎêú ÏÉÅÌÉú
 
 exit
 ! ls -lh /home/oracle/data_pump/ora19c_full.dmp

```

‚ñ∂Ô∏è

```sql
! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full%U.dmp job_name=job2 compression=all parallel=2

> Ctrl + C
status

! expdp system/oracle attach=system.job2

select owner_name, job_name, operation, job_mode, state from dba_datapump
```

‚ñ∂Ô∏è ÏûëÏóÖÏùÑ Ï§ëÎã®

```sql
Export> kill_job
Are you sure you wish to stop this job ([yes]/no): yes

select owner_name, job_name, operation, job_mode, state from dba_datapump

-- no rows selected

SYS@ora19c> ! ls -lh /home/oracle/data_pump/
total 16M
-rw-r----- 1 oracle oinstall 2.9K Jul 28 16:27 export.log
-rw-r----- 1 oracle oinstall 196K Jul 28 15:40 hr_50_stman.dmp
-rw-r----- 1 oracle oinstall 432K Jul 28 14:10 hr_james_table.dmp
-rw-r----- 1 oracle oinstall 820K Jul 28 12:17 hr_schema.dmp
-rw-r----- 1 oracle oinstall 976K Jul 28 13:49 hr_table.dmp
-rw-r----- 1 oracle oinstall 2.0K Jul 28 15:40 import1.log
-rw-r----- 1 oracle oinstall 14M  Jul 28 16:15 ora19c_full.dmp

! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full%U.dmp job_name=job2 compression=all parallel=2
```

‚ñ∂Ô∏è dump fileÏóê ÏûàÎäî ÎÇ¥Ïö©ÏùÑ SQLÎ¨∏ÏúºÎ°ú ÏÉùÏÑ±

üìç sqlfile=hr_table.txt : dump fileÏóê ÏûàÎäî ÎÇ¥Ïö©ÏùÑ SQLÎ¨∏ÏúºÎ°ú ÏÉùÏÑ±

```sql
! impdp system/oracle directory=pump_dir dumpfile=ora19c_full$U.dmp schemas=hr include=table sqlfile=hr_table.txt
-- ÎÖºÎ¶¨Ï†Å ÎîîÎ†âÌÜ†Î¶¨ÏóêÏÑú ÌôïÏù∏ hr.table.txt
```

‚ñ∂Ô∏è James Ïú†Ï†Ä ÏÇ≠Ï†ú ‚Üí Î≥µÍµ¨

```sql
! ls /home/oracle/data_pump
! cat /home/oracle/data_pump/hr_table.txt
drop user james cascade;
! impdp system/oracle directory=pump_dir dumpfile=ora19c_full%U.dmp schemas=james
conn james/oracle
select * from tab;

```