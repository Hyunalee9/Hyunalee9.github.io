---
title: "ë°ì´í„° ì´ê´€ ì‹œ ì‚¬ìš©í•˜ëŠ” datapump"
excerpt: "ì•„ì´í‹°ìœŒ 0728"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-07-28T17:03
---

## Data Migration(ë°ì´í„° ì´ê´€)

- í•œ ì‹œìŠ¤í…œì—ì„œ ë‹¤ë¥¸ ì‹œìŠ¤í…œìœ¼ë¡œ ë°ì´í„°ë¥¼ ì´ë™ì‹œí‚¤ëŠ” í”„ë¡œì„¸ìŠ¤

## dbms_metadata(ë°ì´í„° ì´ê´€ ì‘ì—…í•  ë•Œ ì´ìš©)

- ì´ íŒ¨í‚¤ì§€ëŠ” ë°ì´í„°ë² ì´ìŠ¤ dictionaryì—ì„œ ë©”íƒ€ ë°ì´í„°ë¥¼ xml, ddlí˜•íƒœë¡œ ê²€ìƒ‰í•˜ê³  ì¶”ì¶œí•´ì„œ ë‹¤ì‹œ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.

```sql
select dbms_metadata.get_ddl('user','hr') from dual;

-- ë§Œì•½ ì•„ë˜ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´

ERROR:
ORA-31600: invalid input value user for parameter OBJECT_TYPE in function GET_DDL
ORA-06512: at "SYS.DBMS_METADATA", line 6731
ORA-06512: at "SYS.DBMS_METADATA", line 6516
ORA-06512: at "SYS.DBMS_SYS_ERROR", line 105
ORA-06512: at "SYS.DBMS_METADATA_INT", line 4166
ORA-06512: at "SYS.DBMS_METADATA_INT", line 4643
ORA-06512: at "SYS.DBMS_METADATA_INT", line 9660
ORA-06512: at "SYS.DBMS_METADATA", line 6459
ORA-06512: at "SYS.DBMS_METADATA", line 6572
ORA-06512: at "SYS.DBMS_METADATA", line 9734
ORA-06512: at line 1

-- ëŒ€ë¬¸ìë¡œ ì‹œí–‰
-- ìœ ì € ìƒì„± ì •ë³´ ë©”íƒ€ë°ì´í„° ì¶”
select dbms_metadata.get_ddl('USER','HR') from dual;

DBMS_METADATA.GET_DDL('USER','HR')
--------------------------------------------------------------------------------

   CREATE USER "HR" IDENTIFIED BY VALUES 'S:B2F1F7A064CCCABED4E2CBE13307C7BE7773
B269ED09396BAB1776D2B38D;T:C9BD89A825F27B9CF148E9CEFD1D7BACBEF198F9535D3A29AB186
BF1CBFAA5344A827872231BE4E89C1A84FE8F8A1AED958A121D7521F659175782E8F69C79DBEA647
652BD4F5F310FF0733332B17B37'
      DEFAULT TABLESPACE "SYSAUX"
      TEMPORARY TABLESPACE "TEMP"

-- â–¶ï¸ ì´ë ‡ê²Œ ë³€í™˜í•˜ì
   CREATE USER "HR" 
   IDENTIFIED BY VALUES oracle
      DEFAULT TABLESPACE "SYSAUX"
      TEMPORARY TABLESPACE "TEMP";
  
  -- HR ìœ ì € ì •ë³´ ë³´ê¸°
  select * from dba_users where username = 'HR';
  
  -- ìœ ì €í•œí…Œ ë¶€ì—¬í•œ ì‹œìŠ¤í…œ ê¶Œí•œ
  select * from dba_sys_privs where grantee = 'HR';
  
  -- HR ìœ ì €ì—ê²Œ ë¶€ì—¬ëœ ì‹œìŠ¤í…œ ê¶Œí•œì„ ì¶”ì¶œí•´ì„œ ê¶Œí•œ ë¶€ì—¬í•˜ëŠ” SQL ë¬¸ì„ ë½‘ì•„ì¤€ë‹¤.
  select dbms_metadata.get_granted_ddl('SYSTEM_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('SYSTEM_GRANT','HR')
--------------------------------------------------------------------------------

  GRANT CREATE SESSION TO "HR"
  GRANT ALTER SESSION TO "HR"
  GRANT UNLIMITED TABLESPACE TO "HR"
  GRANT CREATE SYNONYM TO "HR"
  GRANT CREATE VIEW TO "HR"
  GRANT CREATE SEQUENCE TO "HR"
  GRANT CREATE DATABASE LINK TO "HR"
  
  -- ìœ ì €í•œí…Œ ë¶€ì—¬í•œ ê°ì²´ ê¶Œí•œ
  select * from dba_tab_privs where grantee = 'HR';
  select dbms_metadata.get_granted_ddl('OBJECT_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('OBJECT_GRANT','HR')
--------------------------------------------------------------------------------

  GRANT EXECUTE ON "SYS"."DBMS_STATS" TO "HR"

  
  -- ìœ ì €í•œí…Œ ë¶€ì—¬í•œ ë¡¤
  select * from dba_role_privs where grantee = 'HR';
  select dbms_metadata.get_granted_ddl('ROLE_GRANT', 'HR') from dual;
  
  DBMS_METADATA.GET_GRANTED_DDL('ROLE_GRANT','HR')
--------------------------------------------------------------------------------

   GRANT "RESOURCE" TO "HR"

-- ìœ ì €í•œí…Œ ë¶€ì—¬í•œ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ QUOTA

select * from dba_ts_quotas where username = 'HR';
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'HR') from dual;

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','HR')
--------------------------------------------------------------------------------
	DECLARE
	  TEMP_COUNT NUMBER;
    SQLSTR VARCHAR2(200);
  BEGIN
	  --ìœ ì €ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” quota ê°’ : unlimited
	  SQLSTR := 'ALTER USER "HR" QUOTA UNLIMITED ON "SYSAUX"'; 
  EXECUTE IMMEDIATE SQLSTR; -- SQLSTRì— ìˆëŠ” SQL ë¬¸ì¥ì„ ìˆ˜í–‰í•˜ëŠ” ëª…ë ¹ì–´.
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
	    -- dynamic sql ë¬¸ì¥
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
              WHERE TABLESPACE_NAME = ''SYSAUX'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;  -- FETCH ìˆ˜í–‰ 
      IF TEMP_COUNT = 1 THEN RETURN; -- ê°’ì´ ì—†ëŠ” return; (ì¢…ë£Œ)
      ELSE RAISE; -- ì˜¤ë¥˜ ë°œìƒ 
      END IF;
    ELSE
      RAISE;
    END IF;
END;

alter user hr quota 10m on users;
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'HR') from dual;

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','HR')
--------------------------------------------------------------------------------
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "HR" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
              WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
          ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;
```

## Export, Import utility

- export utilityëŠ” ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì„œë¡œ ë‹¤ë¥¸ í•˜ë“œì›¨ì–´ ë° ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±ì„ ì‚¬ìš©í•˜ëŠ” í”Œë«í¼ì— ìƒì£¼í•˜ë”ë¼ë„ ì´ëŸ° ë°ì´í„°ë² ì´ìŠ¤ ê°„ì— ë°ì´í„° ê°ì²´ë¥¼ ì´ë™í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µ
- import utility ëŠ” export dump file ì—ì„œ ê°ì²´ ì •ì˜ì™€ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì½ì–´ì„œ ë°ì´í„° ê°ì²´ë¥¼ ì˜¤ë¼í´ ë°ì´í„°ì— ì…ë ¥í•œë‹¤.

â–¶ï¸ ë°‘ì‘ì—…

```sql
drop table hr.emp purge;
create table hr.emp tablespace users as select * from hr.employees;
alter table hr.emp add constraint empid_pk primary key(employee_id);

-- ì œì•½ì¡°ê±´ ì¡°íšŒ
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'HR'
  and table_name = 'EMP';
```

â–¶ï¸ hr.emp í…Œì´ë¸” export

```sql
SYS@ora19c> ! exp userid=system/oracle tables=hr.emp file=hr_emp.dmp statistics=none

--> ë§Œì•½ì— ë¹„ë°€ë²ˆí˜¸ ì—ëŸ¬ë‚œë‹¤ë©´
-- alter user system identified expired; (ì •í™•íˆ ì´ê²Œ ë§ëŠ”ì§€ í™•ì¸ í•„ìš”)

Export: Release 19.0.0.0.0 - Production on Mon Jul 28 10:47:21 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.
```

â–¶ï¸ ì˜ëª»í•´ì„œ íŠ¹ì • í…Œì´ë¸” ì‚­ì œ

```sql
drop table hr.emp purge;
select * from hr.emp; -- ì˜¤ë¥˜ë‚œë‹¤.
```

â–¶ï¸ export ë°›ì€ dump file ì„ ë°ì´í„°ë² ì´ìŠ¤ import

```sql
! imp userid = system/oracle file=hr_emp.dmp fromuser=hr

Export file created by EXPORT:V19.00.00 via conventional path
import done in US7ASCII character set and AL16UTF16 NCHAR character set
import server uses AL32UTF8 character set (possible charset conversion)
IMP-00403:

Warning: This import generated a separate SQL file "import_sys" which contains DDL that failed due to a privilege issue.

. importing SYSTEM's objects into SYSTEM
. importing HR's objects into HR
. . importing table                          "EMP"        107 rows imported
Import terminated successfully with warnings.

```

â–¶ï¸ ì˜ëª»í•´ì„œ í…Œì´ë¸” truncateí–ˆë‹¤.

```sql
truncate table hr.emp;
select * from hr.emp; 
```

â–¶ï¸ ë°ì´í„°ë§Œ import 

```sql
! imp userid = system/oracle file=hr_emp.dmp fromuser=hr tables=emp data_only=y

-- í™•ì¸ ì‘
SYS@ora19c> select count(*) from hr.emp;

  COUNT(*)
----------
       107

```

â–¶ï¸ ìœ ì € ìƒì„±

ğŸ“ fromuser : ìœ ì €ì— ì†í•œ ëª¨ë“  ê°ì²´

ğŸ“ touser : import ëŒ€ìƒì´ ë  ìœ ì €

```sql
SYS@ora19c> create user minha identified by oracle default tablespace users quota 10m on users;
User created.

SYS@ora19c> grant create session to minha;
Grant succeeded.

-- exp ë¤í”„ íŒŒì¼ì„ ë‹¤ë¥¸ ìœ ì €(minha)ë¡œ ì„í¬íŠ¸
! imp userid=system/oracle file=hr_emp.dmp fromuser=hr touser=minha

SYS@ora19c> conn minha/oracle
Connected.

MINHA@ora19c> select count(*) from minha.emp;

            COUNT(*)
--------------------
                 107
                 
-- ì œì•½ì¡°ê±´ ì¡°íšŒ
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'MINHA'
  and table_name = 'EMP';
```

â–¶ï¸ ìœ ì € ë ˆë²¨ export

```sql
! exp userid=system/oracle owner=minha file=minha.dmp

Export: Release 19.0.0.0.0 - Production on Mon Jul 28 11:06:35 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
Export done in US7ASCII character set and AL16UTF16 NCHAR character set
server uses AL32UTF8 character set (possible charset conversion)

About to export specified users ...
. exporting pre-schema procedural objects and actions
. exporting foreign function library names for user MINHA
. exporting PUBLIC type synonyms
. exporting private type synonyms
. exporting object type definitions for user MINHA
About to export MINHA's objects ...
. exporting database links
. exporting sequence numbers
. exporting cluster definitions
. about to export MINHA's tables via Conventional Path ...
. . exporting table                            EMP        107 rows exported
EXP-00091: Exporting questionable statistics.
. exporting synonyms
. exporting views
. exporting stored procedures
. exporting operators
. exporting referential integrity constraints
. exporting triggers
. exporting indextypes
. exporting bitmap, functional and extensible indexes
. exporting posttables actions
. exporting materialized views
. exporting snapshot logs
. exporting job queues
. exporting refresh groups and children
. exporting dimensions
. exporting post-schema procedural objects and actions
. exporting statistics
Export terminated successfully with warnings.

select dbms_metadata.get_ddl('USER','MINHA') from dual;

DBMS_METADATA.GET_DDL('USER','MINHA')
--------------------------------------------------------------------------------

   CREATE USER "MINHA" IDENTIFIED BY VALUES 'S:478FC41957ACC3DDA22D9778FFB9AAA14
9A5C13E075566C5635C1B25117F;T:E5B69B5207E6647D4D184CFFF17A776D8BBB246CE4A49FD18B
F3CBF0275E711FF71C286E224D2EBDCF678BD71DD0C3FB669FB03CDAC1F3ED9D01C24BAB853A2571
B3A5FEB497D40476C3BE6E789F5063'
      DEFAULT TABLESPACE "USERS"
      TEMPORARY TABLESPACE "TEMP"

select dbms_metadata.get_granted_ddl('SYSTEM_GRANT', 'MINHA') from dual;

DBMS_METADATA.GET_GRANTED_DDL('SYSTEM_GRANT','MINHA')
--------------------------------------------------------------------------------

  GRANT CREATE SESSION TO "MINHA"

DBMS_METADATA.GET_GRANTED_DDL('TABLESPACE_QUOTA','MINHA')
--------------------------------------------------------------------------------
select dbms_metadata.get_granted_ddl('TABLESPACE_QUOTA', 'MINHA') from dual;

  DECLARE
  TEMP_COUNT NUMBER;
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "MINHA" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
                    WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
      ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;

```

â–¶ï¸ ìœ ì € minha ì˜ëª»í•´ì„œ ì‚­ì œ.

```sql
drop user minha cascade;
```

â–¶ï¸ ìœ ì € ìƒì„±, ê¶Œí•œ ë¶€ì—¬

```sql
CREATE USER "MINHA" IDENTIFIED BY oracle
  DEFAULT TABLESPACE "USERS"
  TEMPORARY TABLESPACE "TEMP";
  
 
  GRANT CREATE SESSION TO "MINHA" ;
  
  
    DECLARE
  TEMP_COUNT NUMBER;
  SQLSTR VARCHAR2(200);
BEGIN
  SQLSTR := 'ALTER USER "MINHA" QUOTA 10485760 ON "USERS"';
  EXECUTE IMMEDIATE SQLSTR;
EXCEPTION
  WHEN OTHERS THEN
    IF SQLCODE = -30041 THEN
      SQLSTR := 'SELECT COUNT(*) FROM USER_TABLESPACES
                    WHERE TABLESPACE_NAME = ''USERS'' AND CONTENTS = ''TEMPORARY''';
      EXECUTE IMMEDIATE SQLSTR INTO TEMP_COUNT;
      IF TEMP_COUNT = 1 THEN RETURN;
      ELSE RAISE;
      END IF;
    ELSE
      RAISE;
    END IF;
END;
/

select * from dba_users where username='MINHA';
select * from dba_sys_privs where grantee='MINHA';
select * from dba_ts_quotas where username='MINHA';
```

â–¶ï¸ minha ì†Œìœ ì˜ ê°ì²´ë¥¼ import

```sql
! imp userid=system/oracle file=minha.dmp fromuser=minha

select count(*) from minha.emp;

-- ì œì•½ì¡°ê±´ ì¡°íšŒ
select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'MINHA'
  and table_name = 'EMP';
```

â–¶ï¸ insa tablespace ìƒì„±

```sql
create tablespace insa_tbs datafile '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' size 10m;
select tablespace_name, file_name from dba_data_files;

select dbms_metadata.get_ddl('TABLESPACE','INSA_TBS') from dual;

DBMS_METADATA.GET_DDL('TABLESPACE','INSA_TBS')
--------------------------------------------------------------------------------

  CREATE TABLESPACE "INSA_TBS" DATAFILE
  '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' SIZE 10485760
  LOGGING ONLINE PERMANENT BLOCKSIZE 8192
  EXTENT MANAGEMENT LOCAL AUTOALLOCATE DEFAULT
 NOCOMPRESS  SEGMENT SPACE MANAGEMENT AUTO;

create table hr.insa tablespace insa_tbs as select * from hr.employees;

SELECT f.tablespace_name, f.file_name
FROM dba_extents e, dba_data_files f
WHERE e.file_id = f.file_id
  AND e.segment_name = 'INSA'
  AND e.owner = 'HR';

```

â–¶ï¸ í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ë ˆë²¨ export

```sql
! exp userid=system/oracle file=insa_tbs.dmp tablespaces=insa_tbs

! ls -l insa_tbs.dmp
```

â–¶ï¸ insa_tbs ì˜ëª» ì‚­ì œ

```sql
drop tablespace insa_tbs including contents and datafiles;
```

â–¶ï¸ ìŠ¤í‚¤ë§ˆ ìƒì„±í•´ë†“ì€ ê²ƒ ì‚¬ìš©

```sql
  CREATE TABLESPACE "INSA_TBS" DATAFILE
  '/u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf' SIZE 10485760
  LOGGING ONLINE PERMANENT BLOCKSIZE 8192
  EXTENT MANAGEMENT LOCAL AUTOALLOCATE DEFAULT
 NOCOMPRESS  SEGMENT SPACE MANAGEMENT AUTO;

SYS@ora19c> select tablespace_name, file_name from dba_data_files;

TABLESPACE_NAME                FILE_NAME
------------------------------ -------------------------------------------------
SYSTEM                         /u01/app/oracle/oradata/ORA19C/system01.dbf
SYSAUX                         /u01/app/oracle/oradata/ORA19C/sysaux01.dbf
INSA_TBS                       /u01/app/oracle/oradata/ORA19C/insa_tbs01.dbf
USERS                          /u01/app/oracle/oradata/ORA19C/users01.dbf
UNDOTBS1                       /u01/app/oracle/oradata/ORA19C/undotbs01.dbf

```

â–¶ï¸ export ë°›ì•„ë†“ì€ ê²ƒ import

```sql
-- ì´ê±° ë‹¤ì‹œ 
! imp userid=system/oracle file=insa_tbs.dmp tablespaces=insa_tbs touser=insa

-- í…ŒìŠ¤íŠ¸ ìš©ì´ì—ˆìœ¼ë‹ˆ drop
drop tablespace insa_tbs including contents and datafiles;

```

## Data Pump

- í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë°ì´í„°ì™€ ë©”íƒ€ ë°ì´í„°ë¥¼ ë§¤ìš° ë¹ ë¥¸ ì†ë„ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

â–¶ï¸ ë…¼ë¦¬ì  ë””ë ‰í† ë¦¬ ìƒì„±

```sql
SYS@ora19c> ! pwd
/home/oracle

SYS@ora19c> ! mkdir data_pump
SYS@ora19c> ! ls /home/oracle/data_pump -- ì´ ìœ„ì¹˜ì— dump íŒŒì¼ ìƒì„±

-- ë…¼ë¦¬ì  ë””ë ‰í† ë¦¬ ìƒì„±
create directory pump_dir as '/home/oracle/data_pump';

select * from dba_directories where directory_name='PUMP_DIR';

/*
SYS	PUMP_DIR	/home/oracle/data_pump	0
*/
```

â–¶ï¸ ë…¼ë¦¬ì  ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°ì²´ ê¶Œí•œ ë¶€ì—¬

```sql
grant read,write on directory pump_dir to hr;
select * from dba_tab_privs where grantee='HR';

/*
HR	SYS	DBMS_STATS	SYS	EXECUTE	NO	NO	NO	PACKAGE	NO
HR	SYS	PUMP_DIR	  SYS	READ	  NO	NO	NO	DIRECTORY	NO
HR	SYS	PUMP_DIR	  SYS	WRITE	  NO	NO	NO	DIRECTORY	NO
*/
```

â–¶ï¸ ìœ ì € ë ˆë²¨ export

```sql
-- HR ìœ ì €ì— ëŒ€í•œ ê°ì²´ë“¤ì„ ì „ë¶€ export ë°›ìŒ
! expdp system/oracle schemas=hr directory=pump_dir dumpfile=hr_schema.dmp

-- í™•ì¸ ì‘ì—…
SYS@ora19c> ! ls -l /home/oracle/data_pump/hr_schema.dmp
-rw-r-----. 1 oracle oinstall 864256 Jul 28 12:11 /home/oracle/data_pump/hr_schema.dmp
```

â–¶ï¸ emp í…Œì´ë¸” ì˜ëª» ì‚­ì œ

```sql
SYS@ora19c> drop table hr.emp purge;

Table dropped.

SYS@ora19c> select * from hr.emp;
select * from hr.emp
                 *
ERROR at line 1:
ORA-00942: table or view does not exist
```

â–¶ï¸ import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_schema.dmp tables=hr.emp

-- í™•ì¸
SYS@ora19c> select count(*) from hr.emp;

  COUNT(*)
----------
       107

select constraint_name, constraint_type, search_condition, status, index_name
  from dba_constraints
  where owner = 'HR'
  and table_name = 'EMP';
```

â–¶ï¸ table level export

```sql
! expdp system/oracle schemas=hr directory=pump_dir dumpfile=hr_table.dmp include=table
! ls -l /home/oracle/data_pump

total 1604
-rw-r--r--. 1 oracle oinstall   2283 Jul 28 13:50 export.log
-rw-r-----. 1 oracle oinstall 864256 Jul 28 12:11 hr_schema.dmp
-rw-r-----. 1 oracle oinstall 765952 Jul 28 13:50 hr_table.dmp
-rw-r--r--. 1 oracle oinstall   1059 Jul 28 12:15 import.log
```

â–¶ï¸ ìœ ì € ìƒì„±

```sql
create user james
identified by oracle
default tablespace sysaux
quota unlimited on sysaux;

grant create session to james;

select default_tablespace, temporary_tablespace from dba_users where username='JAMES';

DEFAULT_TABLESPACE             TEMPORARY_TABLESPACE
------------------------------ ------------------------------
SYSAUX                         TEMP

```

â–¶ï¸ hr.emp â†’ james.emp : ì†Œìœ ê¶Œ ë³€ê²½ remap_schema=â€™hrâ€™ : â€˜jamesâ€™ 

â–¶ï¸ hr.emp : users â†’ james.emp sysaux : í…Œì´ë¸”ìŠ¤í˜ì´ìŠ¤ ë³€ê²½ remap_tablespace -â€™usersâ€™:â€™sysauxâ€™

```sql
select dbms_metadata.get_ddl('TABLE','EMP','HR') from dual;

 ! impdp system/oracle directory=pump_dir dumpfile=hr_table.dmp tables=hr.emp remap_schema='hr':'james' remap_tablespace='users':'sysaux'
 
```

â–¶ï¸ hr.employees, hr.departments, hr.locations â†’ james.employees, james.departments, james.locations

â–¶ï¸ trigger, ref_constraint ì œì™¸

```sql
 select table_name, tablespace_name from dba_tables where owner ='HR'
 
 -- sys ì„¸ì…˜
 ! impdp system/oracle directory=pump_dir dumpfile=hr_table.dmp tables=hr.employees, hr.departments, hr.locations remap_schema='hr':'james' exclude=trigger,ref_constraint
```

â–¶ï¸ í™•ì¸

```sql
SELECT table_name, 
       constraint_name, 
       constraint_type, 
       search_condition, 
       r_constraint_name, 
       status, 
       index_name
FROM dba_constraints
WHERE owner = 'HR'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
    
SELECT table_name, 
       constraint_name, 
       constraint_type, 
       search_condition, 
       r_constraint_name, 
       status, 
       index_name
FROM dba_constraints
WHERE owner = 'JAMES'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
  
SELECT *
FROM dba_triggers
WHERE owner = 'HR'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
  
SELECT *
FROM dba_triggers
WHERE owner = 'JAMES'
  AND table_name IN ('EMPLOYEES', 'DEPARTMENTS', 'LOCATIONS');
```

## ìœ ì €ë“¤ì´ ì†Œìœ í•œ íŠ¹ì •í•œ í…Œì´ë¸”ì— ëŒ€í•´ì„œ export

```sql
! expdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.employees, hr.departments, hr.job_history, james.emp

-- í™•ì¸
! ls -l /home/oracle/data_pump/hr_james_table.dmp
-rw-r-----. 1 oracle oinstall 442368 Jul 28 14:43 /home/oracle/data_pump/hr_james_table.dmp

```

â–¶ï¸ í…Œì´ë¸” ì‚­ì œ

```sql
drop table hr.job_history purge;
select * from hr.job_history;
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history

select count(*) from hr.job_history;
  COUNT(*)
----------
        10

select constraint_name, constraint_type, search_condition, status, index_name
from dba_constraints
where table_name = 'JOB_HISTORY'
and owner = 'HR';

/*

JHIST_JOB_FK	R		ENABLED	
JHIST_EMP_FK	R		ENABLED	
JHIST_DEPT_FK	R		ENABLED	
JHIST_EMPLOYEE_NN	C	"EMPLOYEE_ID" IS NOT NULL	ENABLED	
JHIST_START_DATE_NN	C	"START_DATE" IS NOT NULL	ENABLED	
JHIST_END_DATE_NN	C	"END_DATE" IS NOT NULL	ENABLED	
JHIST_JOB_NN	C	"JOB_ID" IS NOT NULL	ENABLED	
JHIST_DATE_INTERVAL	C	end_date > start_date	ENABLED	
JHIST_EMP_ID_ST_DATE_PK	P		ENABLED	JHIST_EMP_ID_ST_DATE_PK

*/
```

â–¶ï¸ ì˜ëª»í•´ì„œ truncate í•´ë²„ë ¸ë‹¤.

```sql
truncate table hr.job_history;
select count(*) from hr.job_history;
  COUNT(*)
----------
         0
```

â–¶ï¸ ë°ì´í„°ë§Œ import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history content=data_only

select count(*) from hr.job_history;

```

â–¶ï¸ ë‹¤ì‹œ drop

```sql
drop table hr.job_history;
```

â–¶ï¸ content=metadata_only : í…Œì´ë¸” êµ¬ì¡° (ë©”íƒ€ ì •ë³´) import

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history content=metadata_only

desc hr.job_history;

select count(*) from hr.job_history;
! impdp system/oracle directory=pump_dir dumpfile=hr_james_table.dmp tables=hr.job_history
content=data_only
```

â–¶ï¸ ì¡°ê±´ì ˆì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë§Œ export

```sql
select * from hr.employees where department_id=50 and job_id = 'ST_MAN';
! expdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.employees query=hr.employees:"where department_id=50 and job_id='ST_MAN'"
```

â–¶ï¸ í…Œì´ë¸” ìƒì„±

```sql
create table hr.emp_50_stman tablespace users as select * from hr.employees where 1 = 2 ;
select * from hr.emp_50_stman;
```

â–¶ï¸ employees â†’ emp_50_stman ìœ¼ë¡œ ë°ì´í„° ì…ë ¥

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp remap_table=employees:emp_50_stman content=data_only
```

â–¶ï¸ ê¸°ì¡´ dump ì§€ì›€

```sql
select * from hr.emp_50_stman;
! rm /home/oracle/data_pump/hr_50_stman.dmp
```

â–¶ï¸ export

```sql
! expdp system/oracle/ directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp50_stman
! impdp system/oracle/ directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp50_stman
```

â–¶ï¸ importì‹œì— ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ skip

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=skip
```

â–¶ï¸ importì‹œì— ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ ë°ì´í„°ë¥¼ ì¶”ê°€(append)

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=append

-- í™•ì¸
select count(*) from hr.emp_50_stman;
```

â–¶ï¸ importì‹œì— ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ ë°ì´í„°ë¥¼ ì‚­ì œí•œ í›„ ì…ë ¥

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=truncate
```

â–¶ï¸ importì‹œì— ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ ë°ì´í„°ë¥¼ ì‚­ì œ(drop) í•œ í›„ ì…ë ¥

```sql
! impdp system/oracle directory=pump_dir dumpfile=hr_50_stman.dmp tables=hr.emp_50_stman table_exists_action=replace
```

## DB ì „ì²´ export

```sql
! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full.dmp job_name=job1

sqlplus / as sysdba
SELECT owner_name, job_name, operation, job_mode, state
FROM dba_datapump_jobs;

> Ctrl+C
> Status
```

![image.png](/assets/20250728/1.png)

â–¶ï¸ ì¼ì‹œ ì¤‘ì§€ëœ ì‘ì—…ì„ ìˆ˜í–‰

â–¶ï¸ ì¬ì ‘ì† , attach=owner_name, job_name

```sql
! expdp system/oracle attach=system.job1
```

â–¶ï¸ ì‘ì—…ì„ ë‹¤ì‹œ ì§„í–‰

```sql
Export> start_job

select owner_name,job_name, operation, job_mode, state from dba_datapump_jobs;

OWNER_NAME  JOB_NAME   OPERATION  JOB_MODE  STATE
----------- ---------- ---------- --------- ----------
SYSTEM      JOB1       EXPORT     FULL      EXECUTING  --> ì§„í–‰ì¤‘

SYS@ora19c> select owner_name, job_name, operation, job_mode, state from dba_datapump_jobs;

OWNER_NAME  JOB_NAME   OPERATION  JOB_MODE  STATE
----------- ---------- ---------- --------- ----------
SYSTEM      JOB1       EXPORT     FULL      COMPLETING  --> ì™„ë£Œë˜ëŠ” ìƒíƒœ

 select owner_name, job_name, operation, job_mode, state from dba_datapump_jobs; --> ì™„ë£Œëœ ìƒíƒœ
 
 exit
 ! ls -lh /home/oracle/data_pump/ora19c_full.dmp

```

â–¶ï¸

```sql
! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full%U.dmp job_name=job2 compression=all parallel=2

> Ctrl + C
status

! expdp system/oracle attach=system.job2

select owner_name, job_name, operation, job_mode, state from dba_datapump
```

â–¶ï¸ ì‘ì—…ì„ ì¤‘ë‹¨

```sql
Export> kill_job
Are you sure you wish to stop this job ([yes]/no): yes

select owner_name, job_name, operation, job_mode, state from dba_datapump

-- no rows selected

SYS@ora19c> ! ls -lh /home/oracle/data_pump/
total 16M
-rw-r----- 1 oracle oinstall 2.9K Jul 28 16:27 export.log
-rw-r----- 1 oracle oinstall 196K Jul 28 15:40 hr_50_stman.dmp
-rw-r----- 1 oracle oinstall 432K Jul 28 14:10 hr_james_table.dmp
-rw-r----- 1 oracle oinstall 820K Jul 28 12:17 hr_schema.dmp
-rw-r----- 1 oracle oinstall 976K Jul 28 13:49 hr_table.dmp
-rw-r----- 1 oracle oinstall 2.0K Jul 28 15:40 import1.log
-rw-r----- 1 oracle oinstall 14M  Jul 28 16:15 ora19c_full.dmp

! expdp system/oracle full=y directory=pump_dir dumpfile=ora19c_full%U.dmp job_name=job2 compression=all parallel=2
```

â–¶ï¸ dump fileì— ìˆëŠ” ë‚´ìš©ì„ SQLë¬¸ìœ¼ë¡œ ìƒì„±

ğŸ“ sqlfile=hr_table.txt : dump fileì— ìˆëŠ” ë‚´ìš©ì„ SQLë¬¸ìœ¼ë¡œ ìƒì„±

```sql
! impdp system/oracle directory=pump_dir dumpfile=ora19c_full$U.dmp schemas=hr include=table sqlfile=hr_table.txt
-- ë…¼ë¦¬ì  ë””ë ‰í† ë¦¬ì—ì„œ í™•ì¸ hr.table.txt
```

â–¶ï¸ James ìœ ì € ì‚­ì œ â†’ ë³µêµ¬

```sql
! ls /home/oracle/data_pump
! cat /home/oracle/data_pump/hr_table.txt
drop user james cascade;
! impdp system/oracle directory=pump_dir dumpfile=ora19c_full%U.dmp schemas=james
conn james/oracle
select * from tab;

```