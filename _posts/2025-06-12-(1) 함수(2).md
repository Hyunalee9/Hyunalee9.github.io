---
title: "í•¨ìˆ˜2"
excerpt: "ì•„ì´í‹°ìœŒ 0612_(1) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-12T18:37
---

# í•¨ìˆ˜(2)

ğŸ“ ë‹¤ë¥¸ ìœ ì €ë“¤ì´ ë§Œë“  sourceë¥¼ ë³´ëŠ” ë°©ë²•

```sql
SELECT text
FROM all_source
WHERE name = 'ë§Œë“  í•¨ìˆ˜, í”„ë¡œì‹œì €ì´ë¦„'
ORDER BY line;
```

ğŸ“ í•¨ìˆ˜ëŠ” IN ëª¨ë“œë§Œ ê°€ëŠ¥í•˜ë©°, í‘œí˜„ì‹ì— ì¼ë¶€ë¡œ ì–´ë””ì„œë“ ì§€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```sql
-- p-valueë¥¼ ì…ë ¥í•˜ë©´ 0.08ì„ ê³±í•´ì„œ ë°˜í™˜í•´ì£¼ëŠ” í•¨ìˆ˜
CREATE OR REPLACE FUNCTION hr.tax(p_value IN number)
RETURN number
IS
BEGIN
    RETURN (p_value * 0.08);
END tax;
/

SELECT text
FROM user_source
WHERE name = 'TAX'
ORDER BY line;

-- í•¨ìˆ˜ë¥¼ í‘œí˜„ì‹ì— ì¼ë¶€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. (1)
SELECT employee_id, last_name, salary, tax(salary)
FROM hr.employees;

---- (2)
SELECT employee_id, last_name, salary, tax(salary)
FROM hr.employees
WHERE tax(salary) > (SELECT max(tax(salary))
                       FROM hr.employees
                      WHERE department_id = 50);  
```

ğŸ“ SQL í‘œí˜„ì‹ì—ì„œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ë¶€ì‘ìš©

- **ê°™ì€ í…Œì´ë¸”**ì— ëŒ€í•´ì„œ ë™ì‹œì— SELECT, DMLì„ í•  ìˆ˜ ì—†ë‹¤.  â†’ ì¼ê´€ì„±ì„ ìƒì–´ë²„ë¦°ë‹¤. (ì‹œì  íŒŒì•…ì„ ëª»í•¨)
- READ - WRITE ëª»í•¨ / WRITE - READ ëª»í•¨ / WRITE - WRITE ëª»í•¨ / READ - READ ë§Œ ê°€ëŠ¥
- í•¨ìˆ˜ì™€ íŠ¸ë¦¬ê±° (ì´ë²¤íŠ¸ì„± í”„ë¡œê·¸ë¨) ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆìŒ.

```sql
CREATE OR REPLACE FUNCTION hr.query_call(p_id IN number)
RETURN number
IS
    v_sal number;
BEGIN
    SELECT salary
      INTO v_sal
      FROM hr.employees
     WHERE employee_id = p_id; 
     
     RETURN v_sal;
END query_call;
/

execute dbms_output.put_line(hr.query_call(100))

SELECT employee_id, hr.query_call(employee_id)
FROM hr.employees;

-- í•¨ìˆ˜ ì‚¬ìš©ì‹œì— ë¶€ì‘ìš© 
-- ORA-04091: table HR.EMPLOYEES is mutating, trigger/function may not see it
UPDATE hr.employees
SET salary = hr.query_call(101) * 1.1
WHERE employee_id = 101;
```

ğŸ“ ë‹¤ë¥¸ í…Œì´ë¸”ì— ëŒ€í•´ì„œëŠ” READ - WRITE ê°€ëŠ¥ 

```sql
-- 1 í–‰ ì´(ê°€) ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.

UPDATE hr.emp
SET salary = hr.query_call(101) * 1.1
WHERE employee_id = 101;

```