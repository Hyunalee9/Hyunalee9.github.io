---
title: "[30ì¼ì°¨] ë°”ì¸ë“œ ë³€ìˆ˜"
excerpt: "ì•„ì´í‹°ìœŒ 0602_(4) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-02T18:27
---


# ë³€ìˆ˜ - ë°”ì¸ë“œ ë³€ìˆ˜

## ë³€ìˆ˜

- ë°ì´í„°ë¥¼ ì„ì‹œë¡œ ì €ì¥í•˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­
- ë¬¸ìë¡œ ì‹œì‘í•´ì•¼ í•œë‹¤.
- ë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ( _, #, $) í¬í•¨í•  ìˆ˜ ìˆë‹¤.
- ë³€ìˆ˜ ì´ë¦„ì˜ ê¸¸ì´ëŠ” 30ì ì´í•˜ë§Œ ê°€ëŠ¥í•˜ë‹¤.
- ì˜ˆì•½ì–´ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

ğŸ“ **ì˜ˆì•½ì–´ í™•ì¸**

```sql
-- dba
SELECT * FROM V$reserved_words WHERE reserved = 'Y';
```

- ì„ ì–¸ ì‹œì— not null, constant(ìƒìˆ˜) ì˜ ê²½ìš° ê¼­ ì´ˆê¸° ê°’ì„ í• ë‹¹í•´ì•¼ í•œë‹¤.
- ë³€ìˆ˜ëŠ” ë³€í•˜ëŠ” ê°’ì„ ê³„ì† ì…ë ¥í•  ìˆ˜ ìˆë‹¤.
- ìƒìˆ˜ëŠ” í•œë²ˆ ë°›ì€ ê°’ë§Œ ê³„ì† ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ë³€ìˆ˜ì— ê°’ì„ í• ë‹¹í•˜ëŠ” ì—°ì‚°ì : `:=` , `default`
    - ğŸ“ `DEFAULT` :  ì´ˆê¸°ê°’ í• ë‹¹. **ì„ ì–¸ ì‹œì—ë§Œ ì‚¬ìš© ê°€ëŠ¥**í•˜ê³ , **ì˜¤ì§ ì„ ì–¸ë¶€ì—ì„œë§Œ**  ì‚¬ìš© ( +. ìƒìˆ˜ ì„ ì–¸ì—ë„ ì‚¬ìš©ë¨)
    
    ```sql
    DECLARE
      v_cnt NUMBER DEFAULT 10; 
    ```
    
- ê°€ë…ì„± ë° ì½”ë“œ ìœ ì§€ ê´€ë¦¬ íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ì„œ ê° í–‰ë§ˆë‹¤ í•˜ë‚˜ì”© ì‹ë³„ì(ë³€ìˆ˜, ìƒìˆ˜)ë¥¼ ì„ ì–¸í•œë‹¤.

ğŸ“  ì˜¤ë¥˜ ë°œìƒí•˜ëŠ” ì„ ì–¸ë²•

```sql
v_id, v_no number; -- ì˜¤ë¥˜ ë°œìƒ
```

ğŸ“ ìš”ë ‡ê²Œ  í•œ ì¤„ì”© ì„ ì–¸í•´ì•¼ í•¨

```sql
v_id number;
v_no number;
```

ğŸ“ `:=` ì‚¬ìš© 

```sql
DECLARE
	v_name varchar2(30);  -- null 
BEGIN
  -- ë¬¸ì||null -> ë¬¸ì.
	dbms_output.put_line('My name is '||v_name);
	v_name := 'í™ê¸¸ë™';
	dbms_output.put_line('My name is '||v_name);
END;
/

/*
My name is 
My name is í™ê¸¸ë™
*/
```

```sql
DECLARE
	v_name varchar2(30) := 'James';  -- null 
BEGIN
  -- ë¬¸ì||null -> ë¬¸ì.
	dbms_output.put_line('My name is '||v_name);
	v_name := 'í™ê¸¸ë™';
	dbms_output.put_line('My name is '||v_name);
END;
/

/*
My name is James
My name is í™ê¸¸ë™
*/
```

```sql
DECLARE
		/* scalar data type : ë‹¨ì¼ê°’ë§Œ ë³´ìœ í•˜ëŠ” ë³€ìˆ˜ */
		v_a number(7);
		v_b number(3) := 100;
		v_c varchar2(10) NOT NULL := 'ORACLE';  
		v_d CONSTANT date DEFAULT sysdate;   -- ìƒìˆ˜ ì„ ì–¸
		v_e CONSTANT number(3) := 20;
BEGIN
		v_a := 300;
		dbms_output.put_line(v_a);
		dbms_output.put_line(v_b);
		dbms_output.put_line(v_c);
		dbms_output.put_line(v_d);
		dbms_output.put_line(v_e);
    -- v_e := 200; -> ìƒìˆ˜ëŠ” ë‹¤ë¥¸ê°’ìœ¼ë¡œ ì¬í• ë‹¹ ëª»í•¨. ì˜¤ë¥˜ ë°œìƒ
END;
/

/*

300
100
ORACLE
25/06/02
20

*/
```

```sql
DECLARE
		/* local variable (ì§€ì—­ ë³€ìˆ˜) : ì„ ì–¸ëœ ë¸”ë¡ í”„ë¡œê·¸ë¨ì—ì„œë§Œ ìˆ˜í–‰í•˜ëŠ” ë³€ìˆ˜ */
		v_sal number := 10000;
		v_comm number := 1000;
		v_total number;
BEGIN
		v_total := v_sal + v_comm;      
		dbms_output.put_line(v_total);  -- 11000
END;
/

-- v_total : local variable(ì§€ì—­ ë³€ìˆ˜)
--> ë¸”ë¡ í”„ë¡œê·¸ë¨ ë°”ê¹¥ìª½ì—ì„œ ì§€ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ì˜¤ë¥˜ ë°œìƒ.
SELECT * FROM hr.employees WHERE salary > v_total;
```

# ë°”ì¸ë“œ ë³€ìˆ˜(bind variable)

- **í˜¸ìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìƒì„±**í•œë‹¤. ( í”„ë¡œê·¸ë¨ ë°”ê¹¥ìª½ì—ì„œ ì„ ì–¸)
- **í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜**ë¼ê³  í•œë‹¤.
- variable(var) í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ì„ ì–¸í•œë‹¤.
- ë°”ì¸ë“œ ë³€ìˆ˜ëŠ” SQLë¬¸ê³¼ PLSQLë¸”ë¡(ìµëª…ë¸”ë¡)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ë°”ì¸ë“œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” **ì½œë¡ (:)í‚¤ì›Œë“œ**ë¥¼ ë°”ì¸ë“œ ë³€ìˆ˜ ì´ë¦„ ì•ì— ì…ë ¥í•´ì•¼ í•œë‹¤.
- global variable(ì „ì—­ë³€ìˆ˜)**ì²˜ëŸ¼** ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
- global variable : í”„ë¡œê·¸ë¨ ì–´ë””ì„œë“ ì§€ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜, ì„¸ì…˜ì´ ì—´ë ¤ ìˆëŠ” ë™ì•ˆì—ëŠ” ì–´ë””ì„œë“ ì§€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

â–¶ï¸ **SQL PLUSì—ì„œ ë°”ì¸ë“œ ë³€ìˆ˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•**

```sql
-- > SQL PLUS
var b_total number

DECLARE	
		v_sal number := 10000;
		v_comm number := 1000;
BEGIN
		:b_total := v_sal + v_comm;
		dbms_output.put_line(:b_total);
END;
/

print :b_total   -- í”„ë¦°íŠ¸í• ë•ŒëŠ” ; ì¨ë„ ì•ˆì¨ë„ ìƒê´€ x
print b_total

SELECT * FROM hr.employees WHERE salary > :b_total;
```

```sql
-- > ë³€ìˆ˜ì— ê°’ í• ë‹¹
SQL> var b_id number
SQL> execute :b_id := 100

PL/SQL procedure successfully completed.

SQL> print :b_id
/*
      B_ID
----------
       100
*/

SQL> SELECT * FROM hr.employees WHERE employee_id  = :b_id;
```

```sql
SQL>BEGIN
		:b_id := 100;
END;
/

SQL> print :b_id
SQL> SELECT * FROM hr.employees WHERE employee_id = :b_id;
```

ğŸ“ SQL Developerì—ì„œëŠ” bind ë³€ìˆ˜ ìœ„ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ì— ì• ë¡œì‚¬í•­ì´ ìˆë‹¤.

â–¶ï¸  SQL Developerì— ë°”ì¸ë“œ ë³€ìˆ˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

```sql
SELECT * FROM hr.employees WHERE employee_id = **:b_id;**
```

â–¶ï¸ **ì‹¤í–‰ ê³„íš sharing í•¨**

ğŸ“ bind ë³€ìˆ˜ëŠ” ì„¸ì…˜ì´ ëë‚  ë•Œê¹Œì§€ ì¡´ì¬í•œë‹¤.

![image.png](/assets/20250602/14.png)

## bind ë³€ìˆ˜ëŠ” ì‹¤í–‰ ê³„íšì„ sharing í•˜ê¸° ìœ„í•´ ì‚¬ìš©.

â–¶ï¸ ê°’ì— ë¶„í¬ë„ì— ë”°ë¼ ì‹¤í–‰ ê³„íš ë¶„ë¦¬ ìœ ë¬´ë¥¼ ì •í•œë‹¤.

ex) 

employee_id  ëŠ” ê³ ìœ í•´ì„œ sharing, dept_idëŠ” ê°’ ì—¬ëŸ¬ ê°œ ì´ê¸° ë•Œë¬¸ì— ioê°€ full scan ë³´ë‹¤ í¼.

 ì´ ê²½ìš°ëŠ” ë¶„ë¦¬ (ë¶„í¬ë„ëŠ” group by + count(*) ë¡œ)

```sql
SELECT * FROM hr.employees WHERE department_id = :dept_id;
```

â–¶ï¸ bind ì„ ì–¸ì‹œ number ë°ì´í„° íƒ€ì… ì„ ì–¸í•  ë•Œ ì‚¬ì´ì¦ˆ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

```sql
SQL> var emp_id number(3)
Usage: VAR[IABLE] [ <variable> [ NUMBER | CHAR | CHAR (n [CHAR|BYTE]) |
                    VARCHAR2 (n [CHAR|BYTE]) | NCHAR | NCHAR (n) |
                    NVARCHAR2 (n) | CLOB | NCLOB | BLOB | BFILE
                    REFCURSOR | BINARY_FLOAT | BINARY_DOUBLE ] ]
```

â–¶ï¸ char ë°ì´í„° íƒ€ì… ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ 1byteì´ë‹¤.

![image.png](/assets/20250602/14.png)



```sql
SQL> var v_name varchar2
SQL> execute:v_name varchar2
BEGIN :v_name varchar2; END;

              *
ERROR at line 1:
ORA-06550: line 1, column 15:
PLS-00103: Encountered the symbol "VARCHAR2" when expecting one of the
following:
:= . ( @ % ; indicator
The symbol ":=" was substituted for "VARCHAR2" to continue.
```

## PL / SQLì˜ SQL í•¨ìˆ˜

- í”„ë¡œì‹œì €ë¬¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜
    - ë‹¨ì¼í–‰ í•¨ìˆ˜
- í”„ë¡œì‹œì €ë¬¸ì—ì„œ **ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í•¨ìˆ˜**
    - `DECODE` , `NVL2`, ê·¸ë£¹ í•¨ìˆ˜

```sql
DECLARE
		v_last_name varchar2(10) := 'hong'; -- í”„ë¡œì‹œì €ë¬¸
		v_first_name varchar2(30) := 'gil dong';
BEGIN
		dbms_output.put_line(upper(v_last_name));
		dbms_output.put_line(initcap(v_first_name));
END;
/
```

```sql
DECLARE
		v_last_name varchar2(10) := initcap('hong'); -- í”„ë¡œì‹œì €ë¬¸
		v_first_name varchar2(30) := initcap('gil dong');
BEGIN
		dbms_output.put_line(upper(v_last_name||''||v_first_name);
END;
/
```

```sql
DECLARE
	v_sal number := 10000;
	v_comm number;   -- null
	v_total number;
BEGIN
	v_total := v_sal * 12 + v_sal * nvl(v_comm,0) * v_sal;
	dbms_output.put_line(v_total); 
END;
/

-- 120000
```

```sql
DECLARE
	v_sal number := 10000;
	v_comm number; 
	v_total number;
BEGIN
	v_total := coalesce(v_sal * 12 + v_sal * v_comm * 12, v_sal*12);
	dbms_output.put_line(v_total); 
END;
/

-- 120000
```

```sql
-- ë‚ ì§œ 
DECLARE
		v_begin_date date:= to_date('2025-04-18','yyyy-mm-dd');
		v_end_date date := to_date('2025-09-19', 'yyyy-mm-dd');
BEGIN
		dbms_output.put_line(v_begin_date);
		dbms_output.put_line(v_end_date);
		dbms_output.put_line(v_end_date - v_begin_date);
		dbms_output.put_line(trunc(months_between(v_end_date,v_begin_date)));
		dbms_output.put_line(add_months(v_end_date,1));
		dbms_output.put_line(next_day(v_end_date,'ì›”ìš”ì¼'));
		dbms_output.put_line(to_char(last_day(v_end_date), 'yyyy-mm-dd hh24:mi:ss.sssss'));
END;
/

/*
25/04/18
25/09/19
154
5
25/10/19
25/09/22
2025-09-30 00:00:00.00000

*/
```

â–¶ï¸ ì„œë¸Œ ë¸”ë¡ ë§Œë“¤ ìˆ˜ ìˆìŒ

```sql
/* main block, outer block */
DECLARE
	v_outer_variable varchar2(30) := 'outer variable';
BEGIN
	/* sub block, inner block */
	DECLARE
		v_inner_variable varchar2(30) := 'inner variable';
	BEGIN
		dbms_output.put_line(v_inner_variable);
		dbms_output.put_line(v_outer_variable);
	END;
		dbms_output.put_line(v_outer_variable);
		--dbms_output.put_line(v_inner_variable);
		--sub blockì—ì„œ ì„ ì–¸í•œ v_inner_variableëŠ” main blockì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤. ì˜¤ë¥˜ë°œìƒ
END;
/

/*
inner variable
outer variable
outer variable
*/
```

â–¶ï¸ ì•„ë¹  ìƒë…„ì›”ì¼ë„ ì¶œë ¥í•˜ê³  ì‹¶ì€ë° ì´ë„ˆ ë¸”ë¡ë•Œë¬¸ì— ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ë•Œ.

```sql
/* main block, outer block */
DECLARE
		v_father_name      varchar2(20) := 'Patrick';
		v_date_of_birth    date := to_date('1960-01-01','yyyy-mm-dd');
BEGIN
   /* sub block, inner block */
	 **DECLARE
			v_child_name       varchar2(20) := 'Mike';
			v_date_of_birth    date := to_date('1990-01-01','yyyy-mm-dd');
	 BEGIN
			dbms_output.put_line('Father''s Name : '||v_father_name);
			dbms_output.put_line('Date of Birth : '||v_date_of_birth);
			dbms_output.put_line('Child''s Name : '||v_child_name);
			dbms_output.put_line('Date of Birth : '||v_date_of_birth);
	 END;**
	 
			dbms_output.put_line('Father''s Name : '||v_father_name);
			dbms_output.put_line('Date of Birth : '||v_date_of_birth);
END;
/

/*
Father's Name : Patrick
Date of Birth : 90/01/01 -- ì•„ë“¤ ìƒë…„ì›”ì¼ ì¶œë ¥ë¨.
Child's Name : Mike
Date of Birth : 90/01/01 
Father's Name : Patrick
Date of Birth : 60/01/01
*/
```

â–¶ï¸ ë ˆì´ë¸”ì„ ì´ìš©í•˜ì.

```sql
--- <<ë ˆì´ë¸”>> : ë¸”ë¡ì— ì§€ì •ë˜ëŠ” ì´ë¦„

<<outer>>
DECLARE
		v_father_name      varchar2(20) := 'Patrick';
		v_date_of_birth    date := to_date('1960-01-01','yyyy-mm-dd');
BEGIN
   /* sub block, inner block */
	 **DECLARE
			v_child_name       varchar2(20) := 'Mike';
			v_date_of_birth    date := to_date('1990-01-01','yyyy-mm-dd');
	 BEGIN
			dbms_output.put_line('Father''s Name : '||v_father_name);
			dbms_output.put_line('Date of Birth : '||outer.v_date_of_birth);
			dbms_output.put_line('Child''s Name : '||v_child_name);
			dbms_output.put_line('Date of Birth : '||v_date_of_birth);
	 END;**
	 
			dbms_output.put_line('Father''s Name : '||v_father_name);
			dbms_output.put_line('Date of Birth : '||v_date_of_birth);
END;
/

/*

Father's Name : Patrick
Date of Birth : 60/01/01   -- ë ˆì´ë¸” í‘œì‹œí•˜ë‹ˆ ì•„ë¹  ìƒë…„ì›”ì œëŒ€ë¡œ ë‚˜ì™”ë‹¤.
Child's Name : Mike
Date of Birth : 90/01/01
Father's Name : Patrick
Date of Birth : 60/01/01

*/

```

```sql
<<outer>>
DECLARE
		v_sal number(8,2) := 60000;
		v_comm number(8,2) := v_sal *0.2;
		v_message varchar2(60) := 'eligible for commission';
BEGIN
   /* sub block, inner block */
	 **DECLARE
			v_sal number(8,2) := 50000;
			v_comm number(8,2) := 0;
			v_total number(8,2) := v_sal + v_comm;  -- 50000 
	 BEGIN
			v_message := 'Clerk not '||v_message;
			outer.v_comm := v_sal * 0.3; -- 50000 * 0.3 = 15000 
			dbms_output.put_line('******* sub block *******');
			dbms_output.put_line(v_sal); -- 50000
			dbms_output.put_line(v_comm); -- 0
			dbms_output.put_line(v_total); -- 50000
			dbms_output.put_line(v_message); -- Clerk not** eligible for commission
	 **END;**
	 
			dbms_output.put_line('****** main block ******');
			dbms_output.put_line(v_sal); -- 60000
			dbms_output.put_line(v_comm); -- 15000
			dbms_output.put_line('Salesman '||v_message); -- **Salesman Clerk not eligible for commission**
			-- dbms_output.put_line(v_total); 
			-- sub blockì—ì„œ ì„ ì–¸ëœ v_total ë³€ìˆ˜ëŠ” main blockì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
 END;
/

/*

******* sub block *******
50000
0
50000
Clerk not eligible for commission
****** main block ******
60000
15000
Salesman Clerk not eligible for commission
*/
```