---
title: "[36ì¼ì°¨] íŒ¨í‚¤ì§€"
excerpt: "ì•„ì´í‹°ìœŒ 0612_(2) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-12T18:37
---


# íŒ¨í‚¤ì§€

ğŸ“ **íŒ¨í‚¤ì§€ ë“±ì¥ ë°°ê²½**

â†’ ê´€ë ¨ì„± ìˆëŠ” í”„ë¡œê·¸ë¨ì„ í•˜ë‚˜ë¡œ ë¬¶ì–´ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤.

```sql
-- ë“¤ì–´ì˜¨ í˜•ì‹ ë§¤ê°œ ë³€ìˆ˜ì™€ ìµœëŒ“ê°’ ë¹„êµí•´ì„œ ë” í¬ë©´ FALSEë¥¼ ë¦¬í„´, ì•„ë‹ˆë©´ TRUEë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜.
-- boolean, record, ë°°ì—´ íƒ€ì… -> PL/SQL ì „ìš©ì´ë‹¤. RETURNë˜ëŠ” íƒ€ì…ì— ë”°ë¼ SQL ì— ì ìš©í•˜ëŠ” ê²ƒ ìœ ì˜í•˜ì.

CREATE OR REPLACE FUNCTION hr.validate_comm(p_comm IN number)
RETURN boolean
IS
    v_comm number;
BEGIN
    SELECT max(commission_pct)  -- 0.4
    INTO v_comm
    FROM hr.employees;
    
    IF p_comm > v_comm THEN
            RETURN FALSE;
    ELSE
            RETURN TRUE;
    END IF;        
END validate_comm;
/

CREATE OR REPLACE PROCEDURE hr.reset_comm(p_comm IN number)
IS
    v_comm number  := 0.1;
BEGIN
    IF hr.validate_comm(p_comm) THEN
        dbms_output.put_line('OLD : '||v_comm);
        v_comm := p_comm;
        dbms_output.put_line('NEW : '||v_comm);
    ELSE
        raise_application_error(-20000, 'ê¸°ì¡´ ìµœê³ ê°’ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    END IF;
END reset_comm;
/

--
BEGIN
    hr.reset_comm(0.2);
END;
/

BEGIN
    hr.reset_comm(0.3);
END;
/

BEGIN
    hr.reset_comm(0.5); -- ì˜¤ë¥˜ ë°œìƒ.
END;
/         
```

# íŒ¨í‚¤ì§€

- ê´€ë ¨ì„± ìˆëŠ” ì„œë¸Œ í”„ë¡œê·¸ë¨(í”„ë¡œì‹œì €, í•¨ìˆ˜), ë³€ìˆ˜, ë°ì´í„° íƒ€ì…, ì˜ˆì™¸ ì‚¬í•­ì„ ëª¨ì•„ ë†“ì€ í”„ë¡œê·¸ë¨
- Specification (Public, Global) ì€ íŒ¨í‚¤ì§€ì˜ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
    - íŒ¨í‚¤ì§€ ì™¸ë¶€ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” ë³€ìˆ˜, ìƒìˆ˜, ì»¤ì„œ, ì˜ˆì™¸ì‚¬í•­, ë°ì´í„° íƒ€ì…, ì„œë¸Œ í”„ë¡œê·¸ë¨ì„ ì„ ì–¸í•œë‹¤.
- Body (Private) ëŠ” ì„œë¸Œ í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ì½”ë“œë¥¼ ì •ì˜í•œë‹¤.
- Bodyì˜ ìƒì„±ìëŠ” ì„œë¸Œ í”„ë¡œê·¸ë¨ì—ì„œë§Œ (ë¡œì»¬ ì„œë¸Œ í”„ë¡œê·¸ë¨, ë°”ë””) ì‚¬ìš©í•œë‹¤.

## â–¶ï¸ Package Specification

```sql
CREATE OR REPLACE PACKAGE package_name
IS
		ë³€ìˆ˜, ìƒìˆ˜, ì»¤ì„œ, ì˜ˆì™¸ì‚¬í•­, ë°ì´í„° íƒ€ì…, ì„œë¸Œ í”„ë¡œê·¸ë¨
END package_name;
/
```

## â–¶ï¸ Package Body

```sql
CREATE OR REPLACE PACKAGE BODY package_name
IS
		Private ìƒì„±ì(ë³€ìˆ˜, ìƒìˆ˜, ì»¤ì„œ, ì˜ˆì™¸ì‚¬í•­, ë°ì´í„° íƒ€ì…) ì„ ì–¸
		ì„œë¸Œ í”„ë¡œê·¸ë¨ ì½”ë“œ ì •ì˜
[BEGIN] -- Package Bodyì˜ Begin ì ˆì€ optional í•˜ë‹¤. 		
END package_name;
/
```

ğŸ“ **ë§Œë“œëŠ” ìˆœì„œ**

1. **Package Specification (Public, Global), ì„ ì–¸ ë¶€ë¶„**

```sql
CREATE OR REPLACE PACKAGE hr.comm_pkg
IS
		g_comm number := 0.1;     
		-- ì—¬ê¸°ì„œ ì‚¬ìš©í•œ ë³€ìˆ˜ëŠ” global ë³€ìˆ˜ì—¬ì„œ execute hr.comm_pkg.g_comm := 0.2 ì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥ 
		-- ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•´ì•¼ ë˜ëŠ” Public ìƒì„±ì ì„ ì–¸
		PROCEDURE reset_comm(p_comm IN number);  
END comm_pkg;
/
```

ğŸ“ **Global ë³€ìˆ˜ ì‚¬ìš©ë²• (ì„¸ì…˜ì´ ì—´ë ¤ìˆëŠ” ë™ì•ˆ ê³„ì† ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.)**

```sql
execute íŒ¨í‚¤ì§€ ì´ë¦„.ë³€ìˆ˜ì´ë¦„
```

ğŸ“ **Global ë³€ìˆ˜ í˜¸ì¶œí•´ë³´ê¸°**

```sql
execute hr.comm_pkg.g_comm := 0.2 
execute dbms_output.put_line(hr.comm_pkg.g_comm)  -- .2
```

1. **Body(Private),  ì‹¤ì œ ë¡œì§ í”„ë¡œê·¸ë¨ ì‘ì„±**

```sql
CREATE OR REPLACE PACKAGE hr.comm_pkg
IS
		g_comm number := 0.1;     
		-- ì—¬ê¸°ì„œ ì‚¬ìš©í•œ ë³€ìˆ˜ëŠ” global ë³€ìˆ˜ì—¬ì„œ execute hr.comm_pkg.g_comm := 0.2 ì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥ 
		-- ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•´ì•¼ ë˜ëŠ” ìƒì„±ì ì„ ì–¸
		PROCEDURE reset_comm(p_comm IN number);  
END comm_pkg;
/   

execute hr.comm_pkg.g_comm := 0.2 
execute dbms_output.put_line(hr.comm_pkg.g_comm)  -- .2

```

```sql

CREATE OR REPLACE PACKAGE BODY hr.comm_pkg
IS
	FUNCTION validate_comm(p_comm IN number)
    RETURN boolean
  IS
    v_comm number;
 BEGIN
    SELECT max(commission_pct)  -- 0.4
    INTO v_comm
    FROM hr.employees;
    
    IF p_comm > v_comm THEN
            RETURN FALSE;
    ELSE
            RETURN TRUE;
    END IF;        
 END validate_comm;

PROCEDURE reset_comm(p_comm IN number)
IS
		BEGIN
		    IF validate_comm(p_comm) THEN
		        dbms_output.put_line('OLD : '||g_comm);
		        g_comm := p_comm;
		        dbms_output.put_line('NEW : '||g_comm);
		    ELSE
		        raise_application_error(-20000, 'ê¸°ì¡´ ìµœê³ ê°’ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		    END IF;
		END reset_comm;

END comm_pkg;
/
```

â–¶ï¸ **HR ì„¸ì…˜ 1**

```sql
-- SQL PLUS
SQL> execute hr.comm_pkg.reset_comm(0.2)

/*
OLD : .1
NEW : .2
*/

SQL> execute hr.comm_pkg.reset_comm(0.15)

/*
OLD : .2
NEW : .15
*/
```

â–¶ï¸ **HR ì„¸ì…˜2**

```sql
SQL> execute hr.comm_pkg.reset_comm(0.3)

/*
OLD : .1
NEW : .3
*/

SQL> execute hr.comm_pkg.reset_comm(0.5)
BEGIN hr.comm_pkg.reset_comm(0.5); END;

/*
ERROR at line 1:
ORA-20000: ê¸°ì¡´ ìµœê³ ê°’ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ORA-06512: at "HR.COMM_PKG", line 28
ORA-06512: at line 1
*/
```

ğŸ“ ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ  ì •ì˜í•˜ê¸° ìœ„í•´ ìœ„ì¹˜ë¥¼ ë°”ê¿¨ë‹¤. â†’ ì˜¤ë¥˜ë‚¨ 

â†’ package bodyì— ì •ì˜ë˜ëŠ” ìƒì„±ìëŠ” ì „ë°© ì°¸ì¡°ë§Œ ê°€ëŠ¥í•˜ë‹¤.  ex) í´ë˜ìŠ¤.

â†’ ì´ëŸ´ ê²½ìš° header (IS ìœ—ë¶€ë¶„) ë¶€ë¶„ë§Œ ë³µì‚¬ ë¶™ì—¬ ë„£ê¸° í•˜ë©´ ì˜¤ë¥˜ì—†ì´ ì‘ë™ëœë‹¤. 

```sql
CREATE OR REPLACE PACKAGE BODY hr.comm_pkg
IS
 FUNCTION validate_comm(p_comm IN number)
    RETURN boolean;

	PROCEDURE reset_comm(p_comm IN number)
IS
		BEGIN
		    IF validate_comm(p_comm) THEN
		        dbms_output.put_line('OLD : '||g_comm);
		        g_comm := p_comm;
		        dbms_output.put_line('NEW : '||g_comm);
		    ELSE
		        raise_application_error(-20000, 'ê¸°ì¡´ ìµœê³ ê°’ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
		    END IF;
		END reset_comm;
	
	FUNCTION validate_comm(p_comm IN number)
    RETURN boolean
  IS
    v_comm number;
 BEGIN
    SELECT max(commission_pct)  -- 0.4
    INTO v_comm
    FROM hr.employees;
    
    IF p_comm > v_comm THEN
            RETURN FALSE;
    ELSE
            RETURN TRUE;
    END IF;        
 END validate_comm;

END comm_pkg;
/
```

## Package overloading

- ë™ì¼í•œ ì´ë¦„ì˜ ìƒì„±ì(í”„ë¡œì‹œì €, í•¨ìˆ˜) ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- í˜•ì‹ íŒŒë¼ë¯¸í„°ì˜ ê°¯ìˆ˜, ëª¨ë“œ(IN, OUT, IN OUT), ë°ì´í„° ìœ í˜•ì´ ë‹¤ë¥¼ ê²½ìš° ë™ì¼í•œ ì´ë¦„ì˜ ì„œë¸Œ í”„ë¡œê·¸ë¨ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```sql
CREATE OR REPLACE PACKAGE hr.pack_over
IS
		TYPE date_tab_type IS TABLE OF date INDEX BY pls_integer;
		TYPE num_tab_type IS TABLE OF number INDEX BY pls_integer;
		
		PROCEDURE init(tab OUT date_tab_type, n IN number); 
		PROCEDURE init(tab OUT num_tab_type, n IN number);
END pack_over;
/
```

```sql
CREATE OR REPLACE PACKAGE BODY hr.pack_over
IS
	PROCEDURE init(tab OUT date_tab_type, n IN number)
	IS
	BEGIN
			FOR i IN 1..n LOOP
					tab(i) := sysdate;
			END LOOP;
	END;
	
	PROCEDURE init(tab OUT num_tab_type, n IN number)
	IS
	BEGIN
		  FOR i IN 1..n LOOP
					tab(i) := i;
			END LOOP;
	END;
END pack_over;
```

```sql
DECLARE
    date_tab hr.pack_over.date_tab_type;
    num_tab hr.pack_over.num_tab_type;
BEGIN
    hr.pack_over.init(date_tab,5);
    hr.pack_over.init(num_tab,5);
    
    FOR i IN 1..5 LOOP
        dbms_output.put_line(date_tab(i));
        dbms_output.put_line(num_tab(i));
    END LOOP;
END;
/
```

## ìƒìˆ˜ í‘œì¤€í™”

â–¶ï¸ 1  mile = 1.6093 kilo

â–¶ï¸ 1  kilo = 0.6214 mile

â–¶ï¸ 1 yard = 0.9144 meter

â–¶ï¸ 1 meter = 1.0936 yard

```sql
CREATE OR REPLACE PACKAGE hr.global_conts
IS
		c_mile_2_kilo constant number  := 1.6093;
		c_kilo_2_mile constant number  := 0.6214;
		c_yard_2_meter constant number := 0.9144;
		c_meter_2_yard constant number := 1.0936;
END global_conts;
/

BEGIN
	   dbms_output.put_line('20 mile = '||20 * hr.global_conts.c_mile_2_kilo||'km');
END;
/

-- 20 mile = 32.186km

BEGIN
	   dbms_output.put_line('20 kilo = '||20 * hr.global_conts.c_yard_2_meter||'m');
END;
/

-- 20 kilo = 18.288m

BEGIN
	   dbms_output.put_line('20 meter = '||20 * hr.global_conts.c_meter_2_yard||'yd');
END;
/

-- 20 meter = 21.872yd

CREATE OR REPLACE FUNCTION hr.mtr_to_yrd(p_m IN number)
RETURN number
IS
BEGIN
    RETURN(p_m * hr.global_conts.c_meter_2_yard);
END mtr_to_yrd;
/

execute dbms_output.put_line(hr.mtr_to_yrd(100));

BEGIN
	   dbms_output.put_line('20 mile = '||20 * hr.global_conts.c_mile_2_kilo||'km');
END;
/
```

## EXCEPTION ì´ë¦„ í‘œì¤€í™”

```sql
CREATE OR REPLACE PACKAGE hr.err_pkg
IS
    notnull_err exception;
    pragma exception_init(notnull_err, -1400);
END err_pkg;
/

desc hr.departments

BEGIN
    INSERT INTO hr.departments(department_id, department_name) VALUES(300,null);
EXCEPTION
    WHEN hr.err_pkg.notnull_err THEN
        dbms_output.put_line('í•„ìˆ˜ í•­ëª© ê°’ì„ ê¼­ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        dbms_output.put_line(sqlerrm);
END;
/
```