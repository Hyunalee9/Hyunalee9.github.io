---
title: "[34ì¼ì°¨] EXCEPTION(ì˜ˆì™¸ì²˜ë¦¬)"
excerpt: "ì•„ì´í‹°ìœŒ 0610_(2) "
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-06-10T18:06
---

# **EXCEPTION(ì˜ˆì™¸ì²˜ë¦¬)**

- í”„ë¡œê·¸ë¨ ì‹¤í–‰ì¤‘ì— ë°œìƒí•œ PL/SQL ì˜¤ë¥˜ì´ë‹¤.
- **ì˜¤ë¼í´**ì— ì˜í•´ **ì•”ì‹œì ìœ¼ë¡œ ë°œìƒ**í•œë‹¤.
- **í”„ë¡œê·¸ë¨**ì— ì˜í•´ **ëª…ì‹œì ìœ¼ë¡œ ë°œìƒ**ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

â–¶ï¸ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•

1. EXCEPTION í‚¤ì›Œë“œë¡œ ì‹œì‘í•œë‹¤.
2. ì—¬ëŸ¬ ì˜ˆì™¸ì²˜ë¦¬ê¸°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
3. ë¸”ë¡ì„ ì¢…ë£Œí•˜ê¸° ì „ **í•˜ë‚˜ì˜ ì²˜ë¦¬ê¸°ë§Œ ì‹¤í–‰**í•œë‹¤.

```sql
-- ì˜¤ë¥˜ 

DECLARE
    v_rec employees%rowtype;
BEGIN
    SELECT *
    INTO v_rec
    FROM hr.employees
    WHERE employee_id = 300;
    
    dbms_output.put_line(v_rec.last_name);
    
EXCEPTION
 WHEN NO_DATA_FOUND THEN
    dbms_output.put_line('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ì›ì…ë‹ˆë‹¤.');

EXCEPTION
 WHEN TOO_MANY_ROWS THEN
    dbms_output.put_line('ì´ë ‡ê²Œ 2ê°œì˜ exception ì²˜ë¦¬ê¸°ëŠ” ë¶ˆê°€ëŠ¥í•˜ë‹¤.');

END;
/
```

1. WHEN OTHERS THEN ë§ˆì§€ë§‰ ì ˆì´ë‹¤.

```sql
EXCEPTION 
BEGIN
EXCEPTION
		WHEN NO_DATA_FOUND THEN
				ìˆ˜í•´í•  ë¡œì§
		WHEN TOO_MANY_ROWS THEN
				ìˆ˜í–‰í•  ë¡œì§
		WHEN OTHERS THEN
				ìˆ˜í–‰í•  ë¡œì§				
END;
/
```

â–¶ï¸ EXCEPTION ì²˜ë¦¬í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°

â†’ **ORA-01403: no data found ì˜¤ë¥˜ ë°œìƒ**

â–¶ï¸ EXCEPTION ì²˜ë¦¬ 

```sql
DECLARE
    v_rec employees%rowtype;
BEGIN
    SELECT *
    INTO v_rec
    FROM hr.employees
    WHERE employee_id = 300;
    
    dbms_output.put_line(v_rec.last_name);
    
EXCEPTION
 WHEN NO_DATA_FOUND THEN
    dbms_output.put_line('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ì›ì…ë‹ˆë‹¤.');
END;
/
```

â–¶ï¸ í”„ë¡œê·¸ë¨ì´ ë¹„ì •ìƒì ì¸ ì¢…ë£Œê°€ ë°œìƒí•œ ê²½ìš° íŠ¸ëœì­ì…˜ì€ ìë™ ì·¨ì†Œ(rollback)ì´ ìˆ˜í–‰ëœë‹¤.

```sql
DROP TABLE hr.test PURGE;
CREATE TABLE hr.test(id number, name varchar2(30));

DECLARE
    v_rec employees%rowtype;
BEGIN
    INSERT INTO hr.test(id,name) VALUES(1, 'ORACLE'); -- transaction ì‹œì‘
    
    SELECT *
    INTO v_rec
    FROM hr.employees
    WHERE employee_id = 300;  -- ORA-01403: no data found ì˜¤ë¥˜ ë°œìƒ, í”„ë¡œê·¸ë¨ ìë™ ROLLBACK
    dbms_output.put_line(v_rec.last_name);
END;
/
```

â–¶ï¸ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë”ë¼ë„ ì˜ˆì™¸ ì‚¬í•­ ì²˜ë¦¬ë¥¼ í–ˆê¸° ë•Œë¬¸ì— í”„ë¡œê·¸ë¨ì€ ì •ìƒì ì¸ ì¢…ë£Œ, íŠ¸ëœì­ì…˜ì€ ì§„í–‰ì¤‘ì¸ ìƒíƒœë¡œ ì‚´ì•„ ìˆë‹¤. ì´ ê²½ìš° íŠ¸ëœì­ì…˜ì´ ì‚´ì•„ ìˆê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ ì œì–´ë¥¼ ê¼­ í•´ì•¼í•œë‹¤.(commit, rollback) 

```sql
DROP TABLE hr.test PURGE;
CREATE TABLE hr.test(id number, name varchar2(30));

DECLARE
    v_rec employees%rowtype;
BEGIN
    INSERT INTO hr.test(id,name) VALUES(1, 'ORACLE'); -- transaction ì‹œì‘
    SELECT *
    INTO v_rec
    FROM hr.employees
    WHERE employee_id = 300;  -- ORA-01403: no data found ì˜¤ë¥˜ ë°œìƒ, í”„ë¡œê·¸ë¨ ìë™ ROLLBACK
    dbms_output.put_line(v_rec.last_name);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        dbms_output.put_line('ì‚¬ì›ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    WHEN OTHERS THEN
		    dbms_output.put_line('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');    
END;
/

SELECT *
FROM hr.test;
```

![image.png](/assets/20250610/1.png)

## **ë¯¸ë¦¬ ì •ì˜ëœ ì˜¤ë¼í´ ì„œë²„ ì˜¤ë¥˜ (Predefined Exceptions)**

ğŸŒ³ **ì¡°íšŒí•˜ëŠ” ê³³**

â¡ **ì˜¤ë¼í´ ë ˆí¼ëŸ°ìŠ¤**

[https://docs.oracle.com/en/database/oracle/oracle-database/19/lnpls/plsql-error-handling.html#GUID-343E0653-9BCE-48F5-A00A-795D77B96B44](https://docs.oracle.com/en/database/oracle/oracle-database/19/lnpls/plsql-error-handling.html#GUID-343E0653-9BCE-48F5-A00A-795D77B96B44)

â†’  PL/SQL  Error Handling â†’  Predefined exceptions

![image.png](/assets/20250610/2.png)

â¡ **SQL Developer**

DBA â†’ package â†’  STANDARD â†’ 159ë²ˆ ë¼ì¸.

![image.png](/assets/20250610/3.png)

ğŸ“ **SQLCODE : ì˜¤ë¥˜ ë²ˆí˜¸ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜**

- 0 : ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ
- 1 : ìœ ì € ì •ì˜ ì˜ˆì™¸ì‚¬í•­
- +100 : `NO_DATA_FOUND` , -1403
- ìŒìˆ˜ :  ì˜¤ë¼í´ ì„œë²„ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ ë²ˆí˜¸

ğŸ“ **SQLERRM : ì˜¤ë¥˜ ë²ˆí˜¸, ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜.**

## **ë¯¸ë¦¬ ì •ì˜ë˜ì§€ ì•Šì€ ì˜¤ë¼í´ ì„œë²„ ì˜¤ë¥˜ (Non Predefined Exceptions)**

â¡ **ì˜¤ë¼í´ ì˜¤ë¥˜ ë²ˆí˜¸ì— ë”°ë¥¸ ì˜ˆì™¸ ì‚¬í•­ ì´ë¦„ì´ ì—†ëŠ” ê²½ìš°**

FK ì œì•½ì¡°ê±´ ê±¸ë ¤ìˆëŠ” ë°ì´í„°ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ì–´ ì˜¤ë¥˜ ë°œìƒ.  Exception ì²˜ë¦¬ 

```sql
DELETE 
FROM hr.departments
WHERE department_id = 10

--------> Exception ì²˜ë¦¬

DECLARE
	pk_error EXCEPTION; --ì˜ˆì™¸ì‚¬í•­ ì´ë¦„ ì„ ì–¸
	**PRAGMA** EXCEPTION_INIT(pk_error,-2292); -- ë‚´ê°€ ë§Œë“  ì˜ˆì™¸ ì‚¬í•­ ì´ë¦„ê³¼ ì˜¤ë¼í´ ì˜¤ë¥˜ë²ˆí˜¸ë¥¼ ì—°ê²°í•˜ëŠ” í•¨ìˆ˜.
  **----> ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì§€ì‹œí•˜ëŠ” ëª…ë ¹ì–´ í‚¤ì›Œë“œ**
BEGIN
	 DELETE 
	 FROM hr.departments
	 WHERE department_id = 10;
EXCEPTION
		WHEN OTHERS THEN
				dbms_output.put_line(SQLCODE);  --> -2292 : ì˜¤ë¥˜ ë²ˆí˜¸ ë°˜í™˜
				dbms_output.put_line(SQLERRM);  --> ì˜¤ë¥˜ ë²ˆí˜¸, ë©”ì‹œì§€ ë°˜í™˜
	--> ORA-02292: integrity constraint (HR.EMP_DEPT_FK) violated - child record found
END;
/
```

ğŸ“PRAGMA (ì§€ì‹œì–´, ì˜ì‚¬ëª…ë ¹ì–´) : ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì§€ì‹œí•˜ëŠ” ëª…ë ¹ì–´ í‚¤ì›Œë“œ

```sql
BEGIN
	 DELETE FROM hr.departments WHERE department_id = 10;
EXCEPTION
	 WHEN pk_error THEN
			  dbms_output.put_line('PKê°’ì„ ì°¸ì¡°í•˜ê³  ìˆëŠ” ìì‹ í–‰ë“¤ì´ ìˆìŠµë‹ˆë‹¤.');
	 WHEN OTHERS THEN
			 	dbms_output.put_line(SQLCODE);
				dbms_output.put_line(SQLERRM);
END;
/
```

## ìœ ì € ì •ì˜ ì˜ˆì™¸ì‚¬í•­(User Defined Exceptions)

ğŸ“ **RAISE : ìœ ì €ê°€ ì •ì˜í•œ ì˜ˆì™¸ì‚¬í•­ ë°œìƒ**

ğŸ“ RAISE_APPLICATION_ERROR í”„ë¡œì‹œì €

â†’ ìœ ì €ê°€ ì •ì˜í•œ ì˜¤ë¥˜ ë²ˆí˜¸ ë©”ì‹œì§€ë¥¼ ì‹¤í–‰í•˜ëŠ” í”„ë¡œê·¸ë¨

â†’ ì´ í”„ë¡œì‹œì €ë¥¼ ìˆ˜í–‰í•˜ëŠ” ìˆœê°„ í”„ë¡œê·¸ë¨ì€ ë¹„ì •ìƒì ì¸ ì¢…ë£Œ

â†’ ì˜¤ë¥˜ë²ˆí˜¸ : -20000 ~ -20999

â†’ ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” 2048byte

â†’  FALSE (ê¸°ë³¸ê°’) : ì˜¤ë¼í´ì˜ ì˜¤ë¥˜ê°€ ë‚´ê°€ ë§Œë“  ì˜¤ë¥˜ë¡œ ë°”ë€ë‹¤.

â†’  TRUE : ì˜¤ë¼í´ ì˜¤ë¥˜í•˜ê³  ë‚´ê°€ ë§Œë“  ì˜¤ë¥˜ê°€ ê°™ì´ ë°œìƒí•œë‹¤. 

```sql
BEGIN
	UPDATE hr.employees
	   SET salary = salary * 1.1
   WHERE employee_id = 300;
END;
/

-----------> ì˜¤ë¥˜ë¥¼ ë‚´ê³  ì‹¶ë‹¤. raise ë„£ê¸°

DECLARE
    e_invalid EXCEPTION;
BEGIN
    UPDATE hr.employees
    SET salary = salary * 1.1
    WHERE employee_id = 300;
    
    IF SQL%NOTFOUND THEN
        RAISE e_invalid;  -- EXCEPTION ì ˆë¡œ ë“¤ì–´ê°„ë‹¤.
    END IF;
EXCEPTION
    WHEN e_invalid THEN
        dbms_output.put_line('ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); -- ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
        dbms_output.put_line(SQLCODE);   -- 1 : ìœ ì € ì •ì˜ ì˜ˆì™¸ ìƒí™©
END;
/

------------>

BEGIN
    UPDATE hr.employees
    SET salary = salary * 1.1
    WHERE employee_id = 300;
    
    IF SQL%NOTFOUND THEN
        RAISE_APPLICATION_ERROR(-20000,'ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    END IF;
EXCEPTION
    WHEN e_invalid THEN
        dbms_output.put_line('ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        dbms_output.put_line(SQLCODE);
END;
/

```

ğŸ“ **SQL PLUSì—ì„œ ê¹”ë”í•˜ê²Œ ë³´ê¸°**

```sql
SQL> DECLARE
  2      v_rec employees%rowtype;
  3  BEGIN
  4      INSERT INTO hr.test(id,name) VALUES(1, 'ORACLE'); -- transaction ì‹œì‘
  
  5      SELECT *
  6      INTO v_rec
  7      FROM hr.employees
  8      WHERE employee_id = 300;  -- ORA-01403: no data found ì˜¤ë¥˜ ë°œìƒ, í”„ë¡œê·¸ë¨ ìë™ ROLLBACK
  9      dbms_output.put_line(v_rec.last_name);
 10  EXCEPTION
 11      WHEN NO_DATA_FOUND THEN
 12          RAISE_APPLICATION_ERROR(-20000,'ì‚¬ì›ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',TRUE); --ì˜¤ë¼í´ ì˜¤ë¥˜ë‘, ë‚´ê°€ ë§Œë“  ì˜¤ë¥˜ ë©”ì‹œì§€ë‘ ê°™ì´ ë°˜í™˜
 13  END;
 14  /
```

![image.png](/assets/20250610/4.png)

â–¶ï¸ ì¶œë ¥ ì¤‘ê°„ì— EXCEPTION ì´ ë°œìƒí•˜ì—¬ ë’¤ì— ìˆëŠ” ë°ì´í„°ëŠ” ì¡°íšŒí•˜ì§€ ëª»í•˜ì˜€ë‹¤.

```sql
SQL> DECLARE
  2      TYPE id_type IS TABLE OF number;
  3      v_id id_type := id_type(100,300,102,105);
  4      v_rec employees%rowtype;
  5  BEGIN
  6      FOR i IN v_id.first..v_id.last LOOP
  7          SELECT *
  8          INTO v_rec
  9          FROM hr.employees
 10          WHERE employee_id = v_id(i);
 11          dbms_output.put_line(v_rec.last_name);
 12      END LOOP;
 13
 14  EXCEPTION
 15      WHEN NO_DATA_FOUND THEN
 16          dbms_output.put_line('ì‚¬ì›ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
 17
 18  END;
 19  /
```

![image.png](/assets/20250610/5.png)

â†’ ë‹¤ìŒ ì‚¬ì› ë²ˆí˜¸ì— ëŒ€í•œ ë°ì´í„° ì¡°íšŒí•˜ê¸° ìœ„í•´ ì„œë¸Œ ë¸”ë¡ì—ì„œ ì²˜ë¦¬í•´ì£¼ê¸°

```sql
DECLARE
    TYPE id_type IS TABLE OF number;
    v_id id_type := id_type(100,300,102,105);
    v_rec employees%rowtype;
BEGIN
    FOR i IN v_id.first..v_id.last LOOP
    -----------------------> FOR LOOP ì•ˆì— ì„œë¸Œ ë¸”ëŸ­ 
     BEGIN
        SELECT *
        INTO v_rec
        FROM hr.employees
        WHERE employee_id = v_id(i);
        dbms_output.put_line(v_rec.last_name);
        
     **EXCEPTION**
          WHEN NO_DATA_FOUND THEN
             dbms_output.put_line('ì‚¬ì›ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
     **END;** 
    ------------------------  
    END LOOP;

EXCEPTION
    WHEN OTHERS THEN
        dbms_output.put_line(SQLERRM);
    
END;
/
```