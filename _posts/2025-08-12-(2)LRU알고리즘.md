---
title: "[76일차] LRU 알고리즘 "
excerpt: "아이티윌 0812_(2)"
categories:
      - ORACLE11g
tags:
      - ORACLE11g
      - TIL
last-modified-at: 2025-08-12T21:08
---

# LRU 알고리즘

📍 working set : 버퍼 캐시를 관리

▶️ LRU ( Least Recently Used) list

- 가장 최근에 사용되거나 사용하지 않은 버퍼들의 리스트
- free buffer, 사용 중이거나 사용된 버퍼, 아직 LRUW 리스트로 옮겨지지 않은 dirty buffer(변경된 블럭)
- 메인 리스트 : 사용된 버퍼들의 리스트
- 보조 리스트 : free buffer list , 미사용된 buffer, dbwr에 의해 기록된 버퍼들의 대한 리스트

▶️ LRUW (Least Recently Used Write) list 

- 아직 디스크로 기록되지 않은 변경된 buffer(dirty buffer) 들을 관리하는 리스트
- dirty list 라고도 부른다.
- 메인 리스트  : 변경된 buffer 들의 리스트
- 보조 리스트 : 현재 dbwr에 의해 기록중인 버퍼들의 리스

▶️ 물리적 I/O 발생하면 cache buffers lru chain latch 획득해야 한다.

이때 경합이 발생하면 latch : cache buffers lru chain 이벤트 발생한다.

📍 cache buffers lru chain latch tn

```sql
select count(*) from v$latch_children where name = 'cache buffers lru chain';
```

![image.png](/assets/20250812/9.png)

▶️ 36이더라도 실제 수는 다르다.  → hidden 파라미터 : 18개 

```sql
select a.ksppinm parameter, b.ksppstvl value
from x$ksppi a, x$ksppcv b
where a.indx = b.indx
and a.ksppinm = '_db_block_lru_latches';
```

![image.png](/assets/20250812/10.png)

```sql
select a.bp_blksz,       
       c.child#,       
       a.bp_name,       
       c.gets,      
       c.MISSES,      
       c.SLEEPS    
  from x$kcbwbpd a, x$kcbwds b, v$latch_children c 
  where b.set_id between a.bp_lo_sid and a.bp_hi_sid   
  and c.addr = b.set_latch order by 1,2;
```

![image.png](/assets/20250812/11.png)

```sql
-- touch count 증가 주기 시간, touch count 증가는 3초 후에 다시 access를 하게 되면 touch count 1씩 증가
select a.ksppinm parameter, b.ksppstvl value
from x$ksppi a, x$ksppcv b
where a.indx = b.indx
and a.ksppinm = '_db_aging_touch_time';

/*
_db_aging_touch_time	3(초)
*/

-- touch count 값이 2이상인 buffer를 만나면 hot region 제일 앞으로 옮겨지는 기준
select a.ksppinm parameter, b.ksppstvl value
from x$ksppi a, x$ksppcv b
where a.indx = b.indx
and a.ksppinm = '_db_aging_hot_criteria';
```

![image.png](/assets/20250812/12.png)

```sql
select a.ksppinm parameter, b.ksppstvl value
from x$ksppi a, x$ksppcv b
where a.indx = b.indx
and a.ksppinm = '_db_block_max_scan_pct';
```

![image.png](/assets/20250812/13.png)

▶️ LRU LIST에서 free buffer를 40% scan

▶️ LRU LIST에서 free buffer를 40% scan을 하고도 프리 버퍼를 찾지 못하면 DBWR에게 dirty buffer를 파일에 기록하고 free  buffer를 확보해줄 것을 요청한다. 

▶️ DBWR가 free buffer 가 확보될 수 있다 이때까지 free buffer 이벤트가 발생한다.